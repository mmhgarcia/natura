PROYECTO: NATURA
FECHA DE GENERACIÃ“N: 03/02/2026 11:18:06
============================================================
DESCRIPCIÃ“N TÃ‰CNICA DEL STACK:
- Framework: React con Vite (Arquitectura de componentes funcionales) [5, 6]
- Estado/Persistencia: IndexedDB mediante Dexie.js (DB: dbTasaBCV) [7, 8]
- Capacidades: PWA (Progressive Web App) optimizada para Android [9, 10]
- Despliegue: Vercel [7]
- AnalÃ­tica: Business Intelligence local con Recharts y snapshots financieros [11, 12]
============================================================

--- ÃRBOL DE DIRECTORIOS ---
ğŸ“„ README.md
ğŸ“„ eslint.config.js
ğŸ“„ index.html
ğŸ“„ package.json
ğŸ“ public/
  ğŸ“ outputs/
    ğŸ“ small/
  ğŸ“ wasm/
    ğŸ“„ security.js
ğŸ“ src/
  ğŸ“„ App.css
  ğŸ“„ App.jsx
  ğŸ“ assets/
  ğŸ“ components/
    ğŸ“„ Delivery.jsx
    ğŸ“„ Footer.jsx
    ğŸ“ FreezerLayout/
      ğŸ“„ FreezerGrid copy.jsx
      ğŸ“„ FreezerGrid.jsx
      ğŸ“„ FreezerLayout.jsx
      ğŸ“„ FreezerSlot.jsx
    ğŸ“„ GestionPedido.jsx
    ğŸ“„ GestionPedido.module.css
    ğŸ“ GruposCRUD/
      ğŸ“„ GruposCRUD.jsx
      ğŸ“„ ModalGrupo.jsx
    ğŸ“„ Header.jsx
    ğŸ“ Panel/
      ğŸ“„ Panel.jsx
      ğŸ“„ Panel.module.css
      ğŸ“ hooks/
        ğŸ“„ useGrupos.js
        ğŸ“„ useProductos.jsx
    ğŸ“„ Pedidos.jsx
    ğŸ“„ Pedidos.module.css
    ğŸ“ ProductosCRUD/
      ğŸ“„ ModalProducto.jsx
      ğŸ“„ ProductosCRUD.jsx
    ğŸ“„ RegistroGasto.jsx
    ğŸ“„ RegistroGasto.module.css
    ğŸ“„ ResumenInventario.jsx
    ğŸ“„ ResumenInventario.module.css
    ğŸ“„ Sidebar.jsx
    ğŸ“„ TasaImporter.jsx
    ğŸ“„ TasaList.jsx
  ğŸ“ core/
    ğŸ“ finanzas/
      ğŸ“„ calculos.js
      ğŸ“„ cuentas.js
      ğŸ“„ movimientos.js
      ğŸ“„ registrarMovimiento.js
  ğŸ“ data/
    ğŸ“„ data.json
    ğŸ“„ grupos.json
  ğŸ“ hooks/
    ğŸ“„ useLocalStorageList.js
  ğŸ“„ index.css
  ğŸ“ lib/
    ğŸ“„ constants.js
    ğŸ“ db/
      ğŸ“„ database.js
      ğŸ“ hooks/
        ğŸ“„ useDelivery.js
        ğŸ“„ useTasa.js
        ğŸ“„ useTasaBCV.js
      ğŸ“„ index.js
      ğŸ“ repositories/
        ğŸ“„ DeliveryRepository.js
        ğŸ“„ RepoRecommStructure.js
        ğŸ“„ TasaRepository.js
      ğŸ“ schemas/
      ğŸ“ utils/
        ğŸ“„ Importer.js
        ğŸ“„ deliveryUtil.js
        ğŸ“„ exportService.js
        ğŸ“„ migrationService.js
        ğŸ“„ tasaUtil.js
    ğŸ“ types/
    ğŸ“„ utils.js
  ğŸ“„ main.jsx
  ğŸ“ pages/
    ğŸ“„ About.jsx
    ğŸ“„ Admin.module.css
    ğŸ“„ DeliveryPage.jsx
    ğŸ“„ Estadisticas.jsx
    ğŸ“„ Estadisticas.module.css
    ğŸ“„ GruposPage.jsx
    ğŸ“„ Home.jsx
    ğŸ“„ Home.module.css
    ğŸ“„ Lista.jsx
    ğŸ“„ NotFound.jsx
    ğŸ“„ Pedidos.jsx
    ğŸ“„ ProductosPage.jsx
    ğŸ“„ TasaBCV.jsx
    ğŸ“„ TasaBCV.module.css
ğŸ“„ test_db_check.js
ğŸ“„ validacion_resumen_inventario.js
ğŸ“„ vite.config.js

============================================================

--- CONTENIDO DE ARCHIVOS (SANITIZADO) ---

FILE: README.md
------------------------------
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is enabled on this template. See [this documentation](https://react.dev/learn/react-compiler) for more information.

Note: This will impact Vite dev & build performances.

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.

************************************************************

FILE: eslint.config.js
------------------------------
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

************************************************************

FILE: index.html
------------------------------
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>natura</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

************************************************************

FILE: package.json
------------------------------
{
  "name": "natura",
[CONTENIDO SENSIBLE ELIMINADO EN: package.json]
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:wasm": "cd src/security/wasm && ./build.sh",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "dexie": "^4.2.1",
    "dexie-export-import": "^4.1.4",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.10.1",
    "recharts": "^3.6.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "babel-plugin-react-compiler": "^1.0.0",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4",
    "vite-plugin-pwa": "^1.2.0"
  }
}
************************************************************

FILE: public/wasm/security.js
------------------------------
[CONTENIDO SENSIBLE ELIMINADO EN: security.js]
;return moduleRtn}})();if(typeof exports==="object"&&typeof module==="object"){module.exports=createSecurityModule;module.exports.default=createSecurityModule}else if(typeof define==="function"&&define["amd"])define([],()=>createSecurityModule);

************************************************************

FILE: src/App.css
------------------------------
#root {
  width: 100%;         /* Asegura que el root ocupe todo el ancho */
  max-width: 100%;     /* Elimina el lÃ­mite de 1280px si existiera */
  margin: 0;           /* Elimina el margin: 0 auto */
  padding: 0;          /* ELIMINA el padding: 2rem que causa el recorte */
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

[CONTENIDO SENSIBLE ELIMINADO EN: App.css]
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

************************************************************

FILE: src/App.jsx
------------------------------
import { Routes, Route } from "react-router-dom";
import Home from "./pages/Home";
import Lista from "./pages/Lista";
import About from "./pages/About";
import NotFound from "./pages/NotFound";
import Panel from "./components/Panel/Panel";
import TasaBCV from "./pages/TasaBCV";
import Header from "./components/Header";
import Footer from "./components/Footer";
import GruposPage from './pages/GruposPage';
import ProductosPage from './pages/ProductosPage';
// Nueva importaciÃ³n de la pÃ¡gina de Pedidos
import PedidosPage from './pages/Pedidos';
// AsegÃºrate de tener esto:
import DeliveryPage from './pages/DeliveryPage';
import Estadisticas from "./pages/Estadisticas";
import ResumenInventario from "./components/ResumenInventario";
import RegistroGasto from "./components/RegistroGasto";
import FreezerGrid from "./components/FreezerLayout/FreezerGrid";

function App() {
  return (
    <>
      <Header />
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/lista" element={<Lista />} />
        <Route path="/about" element={<About />} />
        <Route path="/Panel" element={<Panel />} />
        <Route path="/tasabcv" element={<TasaBCV />} />
        <Route path="/admingrupos" element={<GruposPage />} />
        <Route path="/adminproductos" element={<ProductosPage />} />
        <Route path="/delivery" element={<DeliveryPage />} />
        <Route path="/estadisticas" element={<Estadisticas />} />
        <Route path="/resumeninventario" element={<ResumenInventario />} />
        <Route path="/registrogasto" element={<RegistroGasto />} />
        <Route path="/freezergrid" element={<FreezerGrid productosSeleccionados={[]} />} />

        {/* Nueva ruta para Pedidos */}
        <Route path="/pedidos" element={<PedidosPage />} />
        <Route path="*" element={<NotFound />} />
      </Routes>
      <Footer />
    </>
  );
}

export default App;
************************************************************

FILE: src/components/Delivery.jsx
------------------------------
// Gestiona el parametro de sistema: Delivery
import React, { useState, useEffect } from 'react';
import { db } from '../lib/db/database';

const Delivery = () => {
  const [costoDelivery, setCostoDelivery] = useState('');
  const [loading, setLoading] = useState(true);
  const [guardando, setGuardando] = useState(false);
  const [mensaje, setMensaje] = useState('');

  // Cargar costo de delivery al inicio
  useEffect(() => {
    cargarDelivery();
  }, []);

  const cargarDelivery = async () => {
    try {
      setLoading(true);
      // Buscar en la tabla 'config' donde clave = 'delivery'
      const config = await db.get('config', 'delivery');
      
      if (config && config.valor !== undefined) {
        setCostoDelivery(String(config.valor));
      } else {
        setCostoDelivery(''); // VacÃ­o si no existe
      }
      setMensaje('');
    } catch (error) {
      console.error('Error cargando delivery:', error);
      setMensaje('âŒ Error al cargar el costo de delivery');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    let valor = e.target.value;
    
    // Permitir solo nÃºmeros y un punto decimal
    valor = valor.replace(/[^0-9.]/g, '');
    
    // Asegurar solo un punto decimal
    const puntos = valor.split('.').length - 1;
    if (puntos > 1) {
      const partes = valor.split('.');
      valor = partes[0] + '.' + partes.slice(1).join('');
    }
    
    setCostoDelivery(valor);
    setMensaje(''); // Limpiar mensaje al cambiar
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!costoDelivery.trim()) {
      setMensaje('âš ï¸ Ingresa un valor para el delivery');
      return;
    }

    // Convertir a nÃºmero para validaciÃ³n
    const valorNumero = parseFloat(costoDelivery.replace(',', '.'));
    
    if (isNaN(valorNumero) || valorNumero < 0) {
      setMensaje('âŒ Ingresa un nÃºmero vÃ¡lido (mayor o igual a 0)');
      return;
    }

    setGuardando(true);
    setMensaje('ğŸ’¾ Guardando...');

    try {
      // Guardar en IndexedDB
      await db.put('config', {
        clave: 'delivery',
        valor: valorNumero,
        tipo: 'costo_servicio',
        moneda: 'USD',
        updatedAt: new Date().toISOString()
      });

      setMensaje(`âœ… Costo de delivery guardado: $${valorNumero.toFixed(2)}`);
      
      // Limpiar mensaje despuÃ©s de 3 segundos
      setTimeout(() => setMensaje(''), 3000);
      
    } catch (error) {
      setMensaje('âŒ Error al guardar: ' + error.message);
      console.error(error);
    } finally {
      setGuardando(false);
    }
  };

  const handleLimpiar = () => {
    setCostoDelivery('');
    setMensaje('');
  };

  // Estilos
  const styles = {
    container: {
      maxWidth: '500px',
      margin: '0 auto',
      padding: '20px'
    },
    titulo: {
      color: '#2c3e50',
      textAlign: 'center',
      marginBottom: '30px',
      fontSize: '24px',
      fontWeight: 'bold'
    },
    formContainer: {
      backgroundColor: 'white',
      borderRadius: '12px',
      padding: '25px',
      boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
    },
    label: {
      display: 'block',
      fontSize: '14px',
      fontWeight: '500',
      marginBottom: '8px',
      color: '#2c3e50'
    },
    input: {
      width: '100%',
      padding: '12px 15px',
      fontSize: '16px',
      border: '2px solid #ddd',
      borderRadius: '8px',
      boxSizing: 'border-box',
      transition: 'border-color 0.3s'
    },
    inputFocus: {
      borderColor: '#3498db',
      outline: 'none',
      boxShadow: '0 0 0 3px rgba(52, 152, 219, 0.2)'
    },
    mensaje: {
      padding: '12px 15px',
      borderRadius: '8px',
      marginBottom: '20px',
      textAlign: 'center',
      fontWeight: '500'
    },
    mensajeExito: {
      backgroundColor: '#d4edda',
      color: '#155724',
      border: '1px solid #c3e6cb'
    },
    mensajeError: {
      backgroundColor: '#f8d7da',
      color: '#721c24',
      border: '1px solid #f5c6cb'
    },
    mensajeInfo: {
      backgroundColor: '#d1ecf1',
      color: '#0c5460',
      border: '1px solid #bee5eb'
    },
    botonesContainer: {
      display: 'flex',
      gap: '12px',
      marginTop: '25px'
    },
    boton: {
      padding: '12px 20px',
      border: 'none',
      borderRadius: '8px',
      fontSize: '14px',
      fontWeight: '600',
      cursor: 'pointer',
      transition: 'all 0.2s',
      flex: 1
    },
    botonLimpiar: {
      backgroundColor: '#95a5a6',
      color: 'white'
    },
    botonGuardar: {
      backgroundColor: '#27ae60',
      color: 'white'
    },
    botonDeshabilitado: {
      backgroundColor: '#bdc3c7',
      cursor: 'not-allowed',
      opacity: 0.7
    },
    loading: {
      textAlign: 'center',
      padding: '40px',
      color: '#7f8c8d',
      fontSize: '16px'
    },
    infoBox: {
      marginTop: '25px',
      padding: '15px',
      backgroundColor: '#f8f9fa',
      borderRadius: '8px',
      fontSize: '13px',
      color: '#6c757d',
      borderLeft: '4px solid #3498db'
    },
    currentValue: {
      textAlign: 'center',
      padding: '15px',
      backgroundColor: '#e8f4fc',
      borderRadius: '8px',
      marginBottom: '20px',
      border: '1px solid #d6e9f9'
    },
    currentValueText: {
      fontSize: '18px',
      fontWeight: 'bold',
      color: '#2c3e50'
    },
    currentValueLabel: {
      fontSize: '12px',
      color: '#7f8c8d',
      marginTop: '5px'
    }
  };

  if (loading) {
    return (
      <div style={styles.container}>
        <div style={styles.loading}>
          <div style={{ 
            border: '4px solid #f3f3f3', 
            borderTop: '4px solid #3498db', 
            borderRadius: '50%', 
            width: '40px', 
            height: '40px', 
            margin: '0 auto 20px',
            animation: 'spin 1s linear infinite' 
          }}></div>
          Cargando costo de delivery...
        </div>
        <style>{`
[CONTENIDO SENSIBLE ELIMINADO EN: Delivery.jsx]
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `}</style>
      </div>
    );
  }

  return (
    <div style={styles.container}>
      <h1 style={styles.titulo}>ğŸšš Costo de Delivery</h1>
      
      {/* Valor actual */}
      <div style={styles.currentValue}>
        <div style={styles.currentValueText}>
          {costoDelivery ? `$${parseFloat(costoDelivery).toFixed(2)}` : 'No configurado'}
        </div>
        <div style={styles.currentValueLabel}>
          Costo actual por servicio de delivery
        </div>
      </div>

      <div style={styles.formContainer}>
        {/* Mensajes */}
        {mensaje && (
          <div style={{
            ...styles.mensaje,
            ...(mensaje.includes('âœ…') ? styles.mensajeExito : 
                 mensaje.includes('âŒ') ? styles.mensajeError : 
                 styles.mensajeInfo)
          }}>
            {mensaje}
          </div>
        )}

        <form onSubmit={handleSubmit}>
          <div style={{ marginBottom: '20px' }}>
            <label style={styles.label}>
              Costo del Delivery (USD) *
            </label>
            <input
              type="text"
              value={costoDelivery}
              onChange={handleChange}
              onFocus={(e) => e.target.style.borderColor = '#3498db'}
              onBlur={(e) => e.target.style.borderColor = '#ddd'}
              placeholder="Ej: 5.00"
              style={styles.input}
              disabled={guardando}
            />
            <div style={{ fontSize: '12px', color: '#6c757d', marginTop: '5px' }}>
              Ingresa el costo del servicio de delivery en dÃ³lares
            </div>
          </div>
          
          {/* Botones */}
          <div style={styles.botonesContainer}>
            <button
              type="button"
              onClick={handleLimpiar}
              style={{
                ...styles.boton,
                ...styles.botonLimpiar,
                opacity: guardando ? 0.5 : 1
              }}
              disabled={guardando}
            >
              Limpiar
            </button>
            
            <button
              type="submit"
              style={{
                ...styles.boton,
                ...styles.botonGuardar,
                ...(guardando ? styles.botonDeshabilitado : {}),
                opacity: guardando ? 0.7 : 1
              }}
              disabled={guardando}
            >
              {guardando ? 'ğŸ’¾ Guardando...' : 'ğŸ’¾ Guardar'}
            </button>
          </div>
        </form>
      </div>

      {/* InformaciÃ³n adicional */}
      <div style={styles.infoBox}>
        <div style={{ fontWeight: '500', marginBottom: '8px' }}>
          ğŸ’¡ InformaciÃ³n:
        </div>
        <div>â€¢ El costo de delivery se almacena en la tabla "config" con clave "delivery"</div>
        <div>â€¢ Se guarda como nÃºmero decimal (ej: 5.00 para $5.00 USD)</div>
        <div>â€¢ Este costo se puede usar para agregar a los totales de los pedidos</div>
        <div>â€¢ Para usarlo: <code>await db.getConfigValue('delivery')</code></div>
      </div>
    </div>
  );
};

export default Delivery;
************************************************************

FILE: src/components/Footer.jsx
------------------------------
export default function Footer() {
  return (
    <footer style={{ textAlign: "center", padding: "16px 0", color: "#555" }}>
      Â© {new Date().getFullYear()} - Natura-Ice
    </footer>
  );
}

************************************************************

FILE: src/components/FreezerLayout/FreezerGrid copy.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database';
import FreezerSlot from './FreezerSlot';

const FreezerGrid = ({ productosSeleccionados = [] }) => {
    const [containers, setContainers] = useState([]);
    const [selectedSlot, setSelectedSlot] = useState(null);
    const [isEditing, setIsEditing] = useState(false);
    const [editForm, setEditForm] = useState({
        name: '',
        rows: [],
        color: '#f8f9fa'
    });
    const [currentRow, setCurrentRow] = useState({ label: '', value: '' });
    const [editingContainerId, setEditingContainerId] = useState(null);
    const [editingContainerName, setEditingContainerName] = useState('');

    // Grid configuration
    const COLS = 2;

    useEffect(() => {
        loadContainers();
    }, []);

    const loadContainers = async () => {
        try {
            await db.init();
            let allContainers = await db.freezer_containers.orderBy('order').toArray();

            // Initialize with one default container if empty
            if (allContainers.length === 0) {
                const defaultContainer = {
                    name: 'Freezer 1',
                    order: 0,
                    color: '#e9ecef'
                };
                const containerId = await db.freezer_containers.add(defaultContainer);

                // Create default slots for this container
                const newSlots = [];
                for (let c = 0; c < COLS; c++) {
                    newSlots.push({
                        id: `${containerId}_${c}`,
                        containerId: containerId,
                        row: 0,
                        col: c,
                        name: `SecciÃ³n ${c + 1}`,
                        rows: [],
                        color: '#f8f9fa'
                    });
                }
                await db.freezer_slots.bulkAdd(newSlots);

                allContainers = [{ ...defaultContainer, id: containerId }];
            }

            // Load slots for each container
            for (let container of allContainers) {
                let slots = await db.freezer_slots.where('containerId').equals(container.id).toArray();

                // Ensure rows array exists
                slots = slots.map(slot => ({
                    ...slot,
                    rows: slot.rows || []
                }));

                slots.sort((a, b) => a.col - b.col);
                container.slots = slots;
            }

            setContainers(allContainers);
        } catch (error) {
            console.error("Error loading containers:", error);
        }
    };

    const addContainer = async () => {
        try {
            const nextOrder = containers.length;
            const newContainer = {
                name: `Freezer ${containers.length + 1}`,
                order: nextOrder,
                color: '#e9ecef'
            };

            const containerId = await db.freezer_containers.add(newContainer);

            // Create slots for new container
            const newSlots = [];
            for (let c = 0; c < COLS; c++) {
                newSlots.push({
                    id: `${containerId}_${c}`,
                    containerId: containerId,
                    row: 0,
                    col: c,
                    name: `SecciÃ³n ${c + 1}`,
                    rows: [],
                    color: '#f8f9fa'
                });
            }
            await db.freezer_slots.bulkAdd(newSlots);

            await loadContainers();
        } catch (error) {
            console.error("Error adding container:", error);
            alert("Error al aÃ±adir contenedor");
        }
    };

    const deleteContainer = async (containerId) => {
        if (!window.confirm('Â¿EstÃ¡s seguro de eliminar este contenedor? Se perderÃ¡n todos sus datos.')) {
            return;
        }

        try {
            // Delete all slots in this container
            await db.freezer_slots.where('containerId').equals(containerId).delete();

            // Delete the container
            await db.freezer_containers.delete(containerId);

            await loadContainers();
        } catch (error) {
            console.error("Error deleting container:", error);
            alert("Error al eliminar contenedor");
        }
    };

    const startEditingContainerName = (container) => {
        setEditingContainerId(container.id);
        setEditingContainerName(container.name);
    };

    const saveContainerName = async (containerId) => {
        if (!editingContainerName.trim()) {
            alert('El nombre no puede estar vacÃ­o');
            return;
        }

        try {
            const container = await db.freezer_containers.get(containerId);
            await db.freezer_containers.put({
                ...container,
                name: editingContainerName
            });

            setEditingContainerId(null);
            setEditingContainerName('');
            await loadContainers();
        } catch (error) {
            console.error("Error saving container name:", error);
            alert("Error al guardar nombre");
        }
    };

    const saveContainerColor = async (containerId, color) => {
        try {
            const container = await db.freezer_containers.get(containerId);
            await db.freezer_containers.put({
                ...container,
                color: color
            });
            await loadContainers();
        } catch (error) {
            console.error("Error saving container color:", error);
            alert("Error al guardar color");
        }
    };

    const handleSlotClick = (slot) => {
        setSelectedSlot(slot);
        setEditForm({
            name: slot.name,
            rows: slot.rows || [],
            color: slot.color || '#f8f9fa'
        });
        setCurrentRow({ label: '', value: '' });
        setIsEditing(true);
    };

    const handleAddRow = () => {
        if (!currentRow.label.trim() || !currentRow.value.trim()) {
            alert('Por favor completa ambos campos (Etiqueta y Valor)');
            return;
        }

        setEditForm({
            ...editForm,
            rows: [...editForm.rows, { ...currentRow }]
        });
        setCurrentRow({ label: '', value: '' });
    };

    const handleDeleteRow = (index) => {
        const newRows = editForm.rows.filter((_, i) => i !== index);
        setEditForm({ ...editForm, rows: newRows });
    };

    const handleSave = async () => {
        if (!selectedSlot) return;

        const updatedSlot = {
            ...selectedSlot,
            name: editForm.name,
            rows: editForm.rows,
            color: editForm.color
        };

        try {
            await db.freezer_slots.put(updatedSlot);
            await loadContainers();
            setIsEditing(false);
            setSelectedSlot(null);
        } catch (error) {
            console.error("Error saving slot:", error);
            alert("Error al guardar cambios");
        }
    };

    const containerStyle = {
        padding: '15px',
        maxWidth: '800px',
        margin: '0 auto',
        display: 'flex',
        flexDirection: 'column',
        gap: '20px'
    };

    const headerStyle = {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: '10px'
    };

    const addBtnStyle = {
        padding: '10px 20px',
        borderRadius: '8px',
        border: 'none',
        backgroundColor: '#007bff',
        color: 'white',
        cursor: 'pointer',
        fontSize: '14px',
        fontWeight: 'bold',
        boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
    };

    const containerHeaderStyle = {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: '10px'
    };

    const containerNameStyle = {
        margin: 0,
        color: '#333',
        cursor: 'pointer',
        padding: '8px 12px',
        borderRadius: '6px',
        transition: 'background-color 0.2s',
        ':hover': {
            backgroundColor: '#f0f0f0'
        }
    };

    const containerNameInputStyle = {
        flex: 1,
        padding: '8px 12px',
        borderRadius: '6px',
        border: '2px solid #007bff',
        fontSize: '16px',
        fontWeight: 'bold'
    };

    const colorSelectStyle = {
        padding: '8px 12px',
        borderRadius: '6px',
        border: '1px solid #ced4da',
        backgroundColor: 'white',
        cursor: 'pointer',
        fontSize: '14px'
    };

    const deleteBtnStyle = {
        padding: '8px 16px',
        borderRadius: '6px',
        border: 'none',
        backgroundColor: '#dc3545',
        color: 'white',
        cursor: 'pointer',
        fontSize: '16px',
        fontWeight: 'bold'
    };

    const gridStyle = {
        display: 'grid',
        gridTemplateColumns: `repeat(${COLS}, 1fr)`,
        gap: '10px',
        padding: '15px',
        borderRadius: '12px',
        border: '3px solid #495057',
        boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
        position: 'relative'
    };

    const editorStyle = {
        backgroundColor: 'white',
        padding: '20px',
        borderRadius: '12px',
        boxShadow: '0 -4px 10px rgba(0,0,0,0.1)',
        position: 'fixed',
        bottom: 0,
        left: 0,
        right: 0,
        zIndex: 1000,
        maxHeight: '80vh',
        overflowY: 'auto'
    };

    const formGroupStyle = {
        marginBottom: '15px'
    };

    const inputStyle = {
        width: '100%',
        padding: '10px',
        borderRadius: '6px',
        border: '1px solid #ced4da',
        boxSizing: 'border-box'
    };

    const rowInputContainerStyle = {
        display: 'flex',
        gap: '8px',
        marginBottom: '10px'
    };

    const rowListStyle = {
        listStyle: 'none',
        padding: 0,
        margin: '10px 0',
        maxHeight: '200px',
        overflowY: 'auto',
        border: '1px solid #e9ecef',
        borderRadius: '6px'
    };

    const rowItemStyle = {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        padding: '8px 12px',
        borderBottom: '1px solid #f1f3f5',
        backgroundColor: '#f8f9fa'
    };

    const buttonRowStyle = {
        display: 'flex',
        gap: '10px',
        justifyContent: 'flex-end',
        marginTop: '15px'
    };

    const btnStyle = {
        padding: '10px 20px',
        borderRadius: '6px',
        border: 'none',
        cursor: 'pointer',
        fontWeight: 'bold'
    };

    const smallBtnStyle = {
        padding: '6px 12px',
        borderRadius: '4px',
        border: 'none',
        cursor: 'pointer',
        fontSize: '12px',
        fontWeight: 'bold'
    };

    return (
        <div style={containerStyle}>
            <div style={headerStyle}>
                <h3 style={{ textAlign: 'center', color: '#0080FF', margin: 0 }}>DistribuciÃ³n del Freezer</h3>
                <button
                    style={addBtnStyle}
                    onClick={addContainer}
                >
                    â• AÃ±adir Contenedor
                </button>
            </div>

            {containers.map(container => (
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid copy.jsx]
                    <div style={containerHeaderStyle}>
                        {editingContainerId === container.id ? (
                            <div style={{ display: 'flex', gap: '8px', alignItems: 'center', flex: 1 }}>
                                <input
                                    style={containerNameInputStyle}
                                    value={editingContainerName}
                                    onChange={(e) => setEditingContainerName(e.target.value)}
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid copy.jsx]
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid copy.jsx]
                                            saveContainerName(container.id);
                                        }
                                    }}
                                    autoFocus
                                />
                                <button
                                    style={{ ...smallBtnStyle, backgroundColor: '#28a745', color: 'white' }}
                                    onClick={() => saveContainerName(container.id)}
                                >
                                    âœ“
                                </button>
                                <button
                                    style={{ ...smallBtnStyle, backgroundColor: '#6c757d', color: 'white' }}
                                    onClick={() => {
                                        setEditingContainerId(null);
                                        setEditingContainerName('');
                                    }}
                                >
                                    âœ—
                                </button>
                            </div>
                        ) : (
                            <h4
                                style={containerNameStyle}
                                onClick={() => startEditingContainerName(container)}
                            >
                                {container.name}
                            </h4>
                        )}

                        <div style={{ display: 'flex', gap: '8px' }}>
                            <select
                                style={colorSelectStyle}
                                value={container.color}
                                onChange={(e) => saveContainerColor(container.id, e.target.value)}
                            >
                                <option value="#e9ecef">Gris</option>
                                <option value="#d1ecf1">Azul Claro</option>
                                <option value="#d4edda">Verde Claro</option>
                                <option value="#fff3cd">Amarillo</option>
                                <option value="#f8d7da">Rosa</option>
                                <option value="#e2e3e5">Gris Oscuro</option>
                                <option value="#cfe2ff">Azul</option>
                            </select>
                            <button
                                style={deleteBtnStyle}
                                onClick={() => deleteContainer(container.id)}
                            >
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>

                    <div style={{ ...gridStyle, backgroundColor: container.color }}>
                        {container.slots && container.slots.map(slot => (
                            <FreezerSlot
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid copy.jsx]
                                slotData={slot}
                                onClick={() => handleSlotClick(slot)}
                                isSelected={selectedSlot && selectedSlot.id === slot.id}
                            />
                        ))}
                    </div>
                </div>
            ))}

            {isEditing && (
                <div style={editorStyle}>
                    <h4 style={{ margin: '0 0 15px 0' }}>Editar SecciÃ³n</h4>

                    <div style={formGroupStyle}>
                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>TÃ­tulo (Sabor):</label>
                        <input
                            style={inputStyle}
                            value={editForm.name}
                            onChange={(e) => setEditForm({ ...editForm, name: e.target.value })}
                            placeholder="Ej. Chocolate"
                        />
                    </div>

                    <div style={formGroupStyle}>
                        <label style={{ display: 'block', marginBottom: '8px', fontWeight: 'bold' }}>
                            Filas de InformaciÃ³n:
                        </label>

                        {/* Add Row Form */}
                        <div style={rowInputContainerStyle}>
                            <input
                                style={{ ...inputStyle, flex: 1 }}
                                value={currentRow.label}
                                onChange={(e) => setCurrentRow({ ...currentRow, label: e.target.value })}
                                placeholder="Etiqueta (ej. Lote)"
                            />
                            <input
                                style={{ ...inputStyle, flex: 1 }}
                                value={currentRow.value}
                                onChange={(e) => setCurrentRow({ ...currentRow, value: e.target.value })}
                                placeholder="Valor (ej. 123)"
                            />
                            <button
                                style={{ ...smallBtnStyle, backgroundColor: '#007bff', color: 'white' }}
                                onClick={handleAddRow}
                            >
                                + AÃ±adir
                            </button>
                        </div>

                        {/* Rows List */}
                        {editForm.rows.length > 0 && (
                            <ul style={rowListStyle}>
                                {editForm.rows.map((row, index) => (
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid copy.jsx]
                                        <span>
                                            <strong>{row.label}:</strong> {row.value}
                                        </span>
                                        <button
                                            style={{ ...smallBtnStyle, backgroundColor: '#dc3545', color: 'white' }}
                                            onClick={() => handleDeleteRow(index)}
                                        >
                                            Eliminar
                                        </button>
                                    </li>
                                ))}
                            </ul>
                        )}
                    </div>

                    <div style={formGroupStyle}>
                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Color:</label>
                        <div style={{ display: 'flex', gap: '10px' }}>
                            {['#f8f9fa', '#ffcccc', '#ccffcc', '#cce5ff', '#fff3cd'].map(c => (
                                <div
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid copy.jsx]
                                    onClick={() => setEditForm({ ...editForm, color: c })}
                                    style={{
                                        width: '30px',
                                        height: '30px',
                                        backgroundColor: c,
                                        borderRadius: '50%',
                                        cursor: 'pointer',
                                        border: editForm.color === c ? '2px solid #333' : '1px solid #ddd'
                                    }}
                                />
                            ))}
                        </div>
                    </div>

                    <div style={buttonRowStyle}>
                        <button
                            style={{ ...btnStyle, backgroundColor: '#6c757d', color: 'white' }}
                            onClick={() => setIsEditing(false)}
                        >
                            Cancelar
                        </button>
                        <button
                            style={{ ...btnStyle, backgroundColor: '#28a745', color: 'white' }}
                            onClick={handleSave}
                        >
                            Guardar
                        </button>
                    </div>
                </div>
            )}
        </div>
    );
};

export default FreezerGrid;

************************************************************

FILE: src/components/FreezerLayout/FreezerGrid.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database';
import FreezerSlot from './FreezerSlot';

const FreezerGrid = ({ productosSeleccionados = [] }) => {
  const [containers, setContainers] = useState([]);
  const [selectedSlot, setSelectedSlot] = useState(null);
  const [isEditing, setIsEditing] = useState(false);
  const [editForm, setEditForm] = useState({
    name: '',
    seccion_code: '', // New field added [User Request]
    rows: [],
    color: '#f8f9fa'
  });

  const [currentRow, setCurrentRow] = useState({ label: '', value: '' });
  const [editingContainerId, setEditingContainerId] = useState(null);
  const [editingContainerName, setEditingContainerName] = useState('');

  // Grid configuration
  const COLS = 2;

  useEffect(() => {
    loadContainers();
  }, []);

  const loadContainers = async () => {
    try {
      await db.init();
      let allContainers = await db.freezer_containers.orderBy('order').toArray();

      if (allContainers.length === 0) {
        const defaultContainer = {
          name: 'Freezer 1',
          order: 0,
          color: '#e9ecef'
        };
        const containerId = await db.freezer_containers.add(defaultContainer);

        const newSlots = [];
        for (let c = 0; c < COLS; c++) {
          newSlots.push({
            id: `${containerId}_${c}`,
            containerId: containerId,
            row: 0,
            col: c,
            name: `SecciÃ³n ${c + 1}`,
            seccion_code: '', // Initialise with empty string
            rows: [],
            color: '#f8f9fa'
          });
        }
        await db.freezer_slots.bulkAdd(newSlots);
        allContainers = [{ ...defaultContainer, id: containerId }];
      }

      for (let container of allContainers) {
        let slots = await db.freezer_slots.where('containerId').equals(container.id).toArray();
        slots = slots.map(slot => ({
          ...slot,
          rows: slot.rows || []
        }));
        slots.sort((a, b) => a.col - b.col);
        container.slots = slots;
      }
      setContainers(allContainers);
    } catch (error) {
      console.error("Error loading containers:", error);
    }
  };

  const addContainer = async () => {
    try {
      const nextOrder = containers.length;
      const newContainer = {
        name: `Freezer ${containers.length + 1}`,
        order: nextOrder,
        color: '#e9ecef'
      };
      const containerId = await db.freezer_containers.add(newContainer);

      const newSlots = [];
      for (let c = 0; c < COLS; c++) {
        newSlots.push({
          id: `${containerId}_${c}`,
          containerId: containerId,
          row: 0,
          col: c,
          name: `SecciÃ³n ${c + 1}`,
          seccion_code: '',
          rows: [],
          color: '#f8f9fa'
        });
      }
      await db.freezer_slots.bulkAdd(newSlots);
      await loadContainers();
    } catch (error) {
      console.error("Error adding container:", error);
      alert("Error al aÃ±adir contenedor");
    }
  };

  const deleteContainer = async (containerId) => {
    if (!window.confirm('Â¿EstÃ¡s seguro de eliminar este contenedor? Se perderÃ¡n todos sus datos.')) {
      return;
    }
    try {
      await db.freezer_slots.where('containerId').equals(containerId).delete();
      await db.freezer_containers.delete(containerId);
      await loadContainers();
    } catch (error) {
      console.error("Error deleting container:", error);
      alert("Error al eliminar contenedor");
    }
  };

  const startEditingContainerName = (container) => {
    setEditingContainerId(container.id);
    setEditingContainerName(container.name);
  };

  const saveContainerName = async (containerId) => {
    if (!editingContainerName.trim()) {
      alert('El nombre no puede estar vacÃ­o');
      return;
    }
    try {
      const container = await db.freezer_containers.get(containerId);
      await db.freezer_containers.put({
        ...container,
        name: editingContainerName
      });
      setEditingContainerId(null);
      setEditingContainerName('');
      await loadContainers();
    } catch (error) {
      console.error("Error saving container name:", error);
      alert("Error al guardar nombre");
    }
  };

  const saveContainerColor = async (containerId, color) => {
    try {
      const container = await db.freezer_containers.get(containerId);
      await db.freezer_containers.put({
        ...container,
        color: color
      });
      await loadContainers();
    } catch (error) {
      console.error("Error saving container color:", error);
      alert("Error al guardar color");
    }
  };

  const handleSlotClick = (slot) => {
    setSelectedSlot(slot);
    setEditForm({
      name: slot.name,
      seccion_code: slot.seccion_code || '', // Load seccion_code [User Request]
      rows: slot.rows || [],
      color: slot.color || '#f8f9fa'
    });
    setCurrentRow({ label: '', value: '' });
    setIsEditing(true);
  };

  const handleAddRow = () => {
    if (!currentRow.label.trim() || !currentRow.value.trim()) {
      alert('Por favor completa ambos campos (Etiqueta y Valor)');
      return;
    }
    setEditForm({
      ...editForm,
      rows: [...editForm.rows, { ...currentRow }]
    });
    setCurrentRow({ label: '', value: '' });
  };

  const handleDeleteRow = (index) => {
    const newRows = editForm.rows.filter((_, i) => i !== index);
    setEditForm({ ...editForm, rows: newRows });
  };

  const handleSave = async () => {
    if (!selectedSlot) return;

    const updatedSlot = {
      ...selectedSlot,
      name: editForm.name,
      seccion_code: editForm.seccion_code, // Save seccion_code to DB [User Request]
      rows: editForm.rows,
      color: editForm.color
    };

    try {
      await db.freezer_slots.put(updatedSlot);
      await loadContainers();
      setIsEditing(false);
      setSelectedSlot(null);
    } catch (error) {
      console.error("Error saving slot:", error);
      alert("Error al guardar cambios");
    }
  };

  // Styles (Kept identical as per instructions)
  const containerStyle = { padding: '15px', maxWidth: '800px', margin: '0 auto', display: 'flex', flexDirection: 'column', gap: '20px' };
  const addBtnStyle = { padding: '10px 20px', borderRadius: '8px', border: 'none', backgroundColor: '#007bff', color: 'white', cursor: 'pointer', fontSize: '14px', fontWeight: 'bold', boxShadow: '0 2px 4px rgba(0,0,0,0.2)' };
  const containerNameStyle = { margin: 0, color: '#333', cursor: 'pointer', padding: '8px 12px', borderRadius: '6px', transition: 'background-color 0.2s' };
  const containerNameInputStyle = { flex: 1, padding: '8px 12px', borderRadius: '6px', border: '2px solid #007bff', fontSize: '16px', fontWeight: 'bold' };
  const colorSelectStyle = { padding: '8px 12px', borderRadius: '6px', border: '1px solid #ced4da', backgroundColor: 'white', cursor: 'pointer', fontSize: '14px' };
  const deleteBtnStyle = { padding: '8px 16px', borderRadius: '6px', border: 'none', backgroundColor: '#dc3545', color: 'white', cursor: 'pointer', fontSize: '16px', fontWeight: 'bold' };
  const gridStyle = { display: 'grid', gridTemplateColumns: `repeat(${COLS}, 1fr)`, gap: '10px', padding: '15px', borderRadius: '12px', border: '3px solid #495057', boxShadow: '0 4px 12px rgba(0,0,0,0.15)', position: 'relative' };
  const editorStyle = { backgroundColor: 'white', padding: '20px', borderRadius: '12px', boxShadow: '0 -4px 10px rgba(0,0,0,0.1)', position: 'fixed', bottom: 0, left: 0, right: 0, zIndex: 1000, maxHeight: '80vh', overflowY: 'auto' };
  const formGroupStyle = { marginBottom: '15px' };
  const inputStyle = { width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ced4da', boxSizing: 'border-box' };
  const rowInputContainerStyle = { display: 'flex', gap: '8px', marginBottom: '10px' };
  const rowListStyle = { listStyle: 'none', padding: 0, margin: '10px 0', maxHeight: '200px', overflowY: 'auto', border: '1px solid #e9ecef', borderRadius: '6px' };
  const rowItemStyle = { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '8px 12px', borderBottom: '1px solid #f1f3f5', backgroundColor: '#f8f9fa' };
  const btnStyle = { padding: '10px 20px', borderRadius: '6px', border: 'none', cursor: 'pointer', fontWeight: 'bold' };
  const smallBtnStyle = { padding: '6px 12px', borderRadius: '4px', border: 'none', cursor: 'pointer', fontSize: '12px', fontWeight: 'bold' };

  return (
    <div style={containerStyle}>
      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>
        <h2 style={{ margin: 0 }}>DistribuciÃ³n del Freezer</h2>
        <button style={addBtnStyle} onClick={addContainer}>â• AÃ±adir Contenedor</button>
      </div>

      {containers.map(container => (
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid.jsx]
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>
            {editingContainerId === container.id ? (
              <div style={{ display: 'flex', gap: '8px', flex: 1 }}>
                <input
                  style={containerNameInputStyle}
                  value={editingContainerName}
                  onChange={(e) => setEditingContainerName(e.target.value)}
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid.jsx]
                  autoFocus
                />
                <button style={{ ...smallBtnStyle, backgroundColor: '#28a745', color: 'white' }} onClick={() => saveContainerName(container.id)}>âœ“</button>
                <button style={{ ...smallBtnStyle, backgroundColor: '#6c757d', color: 'white' }} onClick={() => { setEditingContainerId(null); setEditingContainerName(''); }}>âœ—</button>
              </div>
            ) : (
              <h3 style={containerNameStyle} onClick={() => startEditingContainerName(container)}>{container.name}</h3>
            )}
            
            <div style={{ display: 'flex', gap: '10px', alignItems: 'center' }}>
              <select style={colorSelectStyle} value={container.color} onChange={(e) => saveContainerColor(container.id, e.target.value)}>
                <option value="#e9ecef">Gris</option>
                <option value="#cce5ff">Azul Claro</option>
                <option value="#d4edda">Verde Claro</option>
                <option value="#fff3cd">Amarillo</option>
                <option value="#f8d7da">Rosa</option>
                <option value="#343a40">Gris Oscuro</option>
                <option value="#007bff">Azul</option>
              </select>
              <button style={deleteBtnStyle} onClick={() => deleteContainer(container.id)}>ğŸ—‘ï¸</button>
            </div>
          </div>

          <div style={{ ...gridStyle, backgroundColor: container.color }}>
            {container.slots && container.slots.map(slot => (
              <FreezerSlot
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid.jsx]
                slotData={slot}
                onClick={() => handleSlotClick(slot)}
                isSelected={selectedSlot && selectedSlot.id === slot.id}
              />
            ))}
          </div>
        </div>
      ))}

      {isEditing && (
        <div style={editorStyle}>
          <h3 style={{ marginTop: 0 }}>Editar SecciÃ³n</h3>
          
          {/* New Seccion:Code field added above Titulo [User Request] */}
          <div style={formGroupStyle}>
            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Seccion:Code</label>
            <input
              type="text"
              style={inputStyle}
              value={editForm.seccion_code}
              onChange={(e) => setEditForm({ ...editForm, seccion_code: e.target.value })}
              placeholder="Ingrese cÃ³digo de secciÃ³n"
            />
          </div>

          <div style={formGroupStyle}>
            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>TÃ­tulo (Sabor):</label>
            <input
              type="text"
              style={inputStyle}
              value={editForm.name}
              onChange={(e) => setEditForm({ ...editForm, name: e.target.value })}
              placeholder="Ej. Chocolate"
            />
          </div>

          <div style={formGroupStyle}>
            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Filas de InformaciÃ³n:</label>
            <div style={rowInputContainerStyle}>
              <input
                style={{ ...inputStyle, flex: 1 }}
                value={currentRow.label}
                onChange={(e) => setCurrentRow({ ...currentRow, label: e.target.value })}
                placeholder="Etiqueta (ej. Lote)"
              />
              <input
                style={{ ...inputStyle, flex: 1 }}
                value={currentRow.value}
                onChange={(e) => setCurrentRow({ ...currentRow, value: e.target.value })}
                placeholder="Valor (ej. 123)"
              />
              <button style={{ ...smallBtnStyle, backgroundColor: '#007bff', color: 'white' }} onClick={handleAddRow}>+ AÃ±adir</button>
            </div>

            {editForm.rows.length > 0 && (
              <ul style={rowListStyle}>
                {editForm.rows.map((row, index) => (
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid.jsx]
                    <span><strong>{row.label}:</strong> {row.value}</span>
                    <button style={{ ...smallBtnStyle, backgroundColor: '#dc3545', color: 'white' }} onClick={() => handleDeleteRow(index)}>Eliminar</button>
                  </li>
                ))}
              </ul>
            )}
          </div>

          <div style={formGroupStyle}>
            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Color:</label>
            <div style={{ display: 'flex', gap: '10px' }}>
              {['#f8f9fa', '#ffcccc', '#ccffcc', '#cce5ff', '#fff3cd'].map(c => (
                <div
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerGrid.jsx]
                  onClick={() => setEditForm({ ...editForm, color: c })}
                  style={{
                    width: '30px',
                    height: '30px',
                    backgroundColor: c,
                    borderRadius: '50%',
                    cursor: 'pointer',
                    border: editForm.color === c ? '2px solid #333' : '1px solid #ddd'
                  }}
                />
              ))}
            </div>
          </div>

          <div style={{ display: 'flex', gap: '10px', justifyContent: 'flex-end', marginTop: '15px' }}>
            <button style={{ ...btnStyle, backgroundColor: '#6c757d', color: 'white' }} onClick={() => setIsEditing(false)}>Cancelar</button>
            <button style={{ ...btnStyle, backgroundColor: '#28a745', color: 'white' }} onClick={handleSave}>Guardar</button>
          </div>
        </div>
      )}
    </div>
  );
};

export default FreezerGrid;
************************************************************

FILE: src/components/FreezerLayout/FreezerLayout.jsx
------------------------------
import React from 'react';
import miImagen from './FreezerLayout.png'; // Ruta relativa al componente

const FreezerLayout = ({ productosSeleccionados = [] }) => {
  const containerStyle = {
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    gap: '20px',
    paddingBottom: '20px',
  };

  const cardStyle = {
    backgroundColor: '#fff',
    borderRadius: '12px',
    boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
    padding: '15px',
    width: '100%',
    maxWidth: '600px',
    boxSizing: 'border-box',
    border: '1px solid #e1e4e8',
  };

  const imageContainerStyle = {
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    width: '100%',
  };

  const summaryTitleStyle = {
    fontSize: '18px',
    fontWeight: 'bold',
    marginBottom: '15px',
    color: '#333',
    textAlign: 'center',
    borderBottom: '2px solid #00BFFF',
    paddingBottom: '8px',
  };

  const tableHeaderStyle = {
    display: 'flex',
    justifyContent: 'space-between',
    padding: '10px 15px',
    marginBottom: '8px',
    backgroundColor: '#e9ecef',
    borderRadius: '6px',
    fontWeight: 'bold',
    color: '#495057',
    fontSize: '14px',
  };

  const summaryListStyle = {
    listStyle: 'none',
    padding: 0,
    margin: 0,
  };

  const summaryItemStyle = {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center',
    padding: '10px 15px',
    marginBottom: '8px',
    backgroundColor: '#f8f9fa',
    borderRadius: '6px',
    border: '1px solid #dee2e6',
  };

  const itemInfoStyle = {
    display: 'flex',
    gap: '10px',
    alignItems: 'center',
    flex: 1,
  };

  const idBadgeStyle = {
    backgroundColor: '#007bff',
    color: 'white',
    padding: '4px 8px',
    borderRadius: '4px',
    fontSize: '12px',
    fontWeight: 'bold',
    minWidth: '24px',
    textAlign: 'center',
  };

  const nameStyle = {
    fontWeight: '500',
    color: '#212529',
  };

  const quantityBadgeStyle = {
    backgroundColor: '#28a745',
    color: 'white',
    padding: '4px 12px',
    borderRadius: '4px',
    fontSize: '14px',
    fontWeight: 'bold',
    minWidth: '30px',
    textAlign: 'center',
  };

  // Agrupar productos por ID y sumar cantidades
  const productosSumarizados = productosSeleccionados.reduce((acc, producto) => {
    const existing = acc.find(item => item.id === producto.id);
    if (existing) {
      existing.cantidad += 1;
    } else {
      acc.push({
        id: producto.id,
        nombre: producto.nombre,
        cantidad: 1,
      });
    }
    return acc;
  }, []);

  // Ordenar por ID para mejor visualizaciÃ³n
  productosSumarizados.sort((a, b) => a.id - b.id);

  return (
    <div style={containerStyle}>
      {/* Card de la Imagen */}
      <div style={cardStyle}>
        <div style={imageContainerStyle}>
          <img src={miImagen} alt="UbicaciÃ³n en Freezer" style={{ maxWidth: '100%', borderRadius: '8px' }} />
        </div>
      </div>

      {/* Card del Resumen */}
      {productosSumarizados.length > 0 && (
        <div style={cardStyle}>
          <div style={summaryTitleStyle}>
            Resumen de Productos
          </div>

          <div style={tableHeaderStyle}>
            <span style={{ width: '50px' }}>ID</span>
            <span style={{ flex: 1, textAlign: 'left', paddingLeft: '10px' }}>NOMBRE</span>
            <span style={{ minWidth: '80px', textAlign: 'right' }}>CANTIDAD</span>
          </div>

          <ul style={summaryListStyle}>
            {productosSumarizados.map((item) => (
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerLayout.jsx]
                <div style={itemInfoStyle}>
                  <span style={idBadgeStyle}>{item.id}</span>
                  <span style={nameStyle}>{item.nombre}</span>
                </div>
                <span style={quantityBadgeStyle}>{item.cantidad}</span>
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
};

export default FreezerLayout;
************************************************************

FILE: src/components/FreezerLayout/FreezerSlot.jsx
------------------------------
import React from 'react';

const FreezerSlot = ({ slotData, onClick, isSelected }) => {
    const { id, name, rows = [], color } = slotData || {};

    const containerStyle = {
        border: isSelected ? '2px solid #007bff' : '1px solid #ccc',
        borderRadius: '8px',
        padding: '12px',
        minHeight: '100px',
        backgroundColor: color || '#f8f9fa',
        cursor: 'pointer',
        display: 'flex',
        flexDirection: 'column',
        transition: 'all 0.2s',
        boxShadow: isSelected ? '0 0 8px rgba(0,123,255,0.5)' : 'none',
        position: 'relative'
    };

    const headerStyle = {
        fontSize: '14px',
        color: '#495057',
        marginBottom: '8px',
        fontWeight: 'bold',
        textTransform: 'uppercase',
        textAlign: 'center',
        borderBottom: '1px solid #dee2e6',
        paddingBottom: '6px'
    };

    const rowsContainerStyle = {
        display: 'flex',
        flexDirection: 'column',
        gap: '4px',
        width: '100%'
    };

    const rowStyle = {
        fontSize: '12px',
        color: '#333',
        display: 'flex',
        justifyContent: 'space-between',
        padding: '4px 0'
    };

    const rowLabelStyle = {
        fontWeight: '600',
        color: '#6c757d'
    };

    const rowValueStyle = {
        fontWeight: '500',
        color: '#212529'
    };

    const emptyStyle = {
        fontSize: '12px',
        color: '#adb5bd',
        fontStyle: 'italic',
        textAlign: 'center',
        marginTop: '8px'
    };

    return (
        <div style={containerStyle} onClick={onClick}>
            <div style={headerStyle}>{name || `SecciÃ³n ${id}`}</div>

            {rows && rows.length > 0 ? (
                <div style={rowsContainerStyle}>
                    {rows.map((row, index) => (
[CONTENIDO SENSIBLE ELIMINADO EN: FreezerSlot.jsx]
                            <span style={rowLabelStyle}>{row.label}:</span>
                            <span style={rowValueStyle}>{row.value}</span>
                        </div>
                    ))}
                </div>
            ) : (
                <div style={emptyStyle}>Sin informaciÃ³n</div>
            )}
        </div>
    );
};

export default FreezerSlot;

************************************************************

FILE: src/components/GestionPedido.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../lib/db/database'; // Referencia a la base de datos dbTasaBCV [4, 5]
import styles from './GestionPedido.module.css'; // [4]

const GestionPedido = ({ pedido, onClose, onSave }) => {
    const getLocalToday = () => new Date().toLocaleDateString('en-CA');

    const [formData, setFormData] = useState({
        numero_pedido: '',
        fecha_pedido: getLocalToday(),
        tasa: '',
        estatus: 'Activo',
        delivery_tasa: 0
    });

    const [productos, setProductos] = useState([]);
    const [listaGrupos, setListaGrupos] = useState([]);
    const [cantidades, setCantidades] = useState({});
    const [aplicarDelivery, setAplicarDelivery] = useState(true);
    const [totales, setTotales] = useState({ usd: 0, bs: 0, ventaUsd: 0, ventaBs: 0 });
    const [utilidad, setUtilidad] = useState({ usd: 0, bs: 0 });

    const esVisualizacion = !!pedido && pedido.estatus === 'Cerrado';

    useEffect(() => {
        const cargarDatos = async () => {
            try {
                // ACTUALIZACIÃ“N FASE 2: Prioriza el histÃ³rico de tasas [3]
                const tasaConfig = await db.getUltimaTasaBCV();
                const deliveryValor = await db.getConfigValue('delivery'); // [1, 6]

                const [todosLosProductos, todosLosGrupos] = await Promise.all([
                    db.getAll('productos'),
                    db.getAll('grupos')
                ]); // [1, 7]

                setProductos(todosLosProductos);
                setListaGrupos(todosLosGrupos);

                if (pedido) {
                    setFormData({
                        numero_pedido: pedido.numero_pedido || '',
                        fecha_pedido: pedido.fecha_pedido || '',
                        tasa: pedido.tasa || (tasaConfig ? tasaConfig.toString() : ''),
                        estatus: pedido.estatus || 'Activo',
                        delivery_tasa: pedido.delivery_tasa !== undefined ? pedido.delivery_tasa : (deliveryValor || 0)
                    });

                    // Soporte para ambos formatos (Diccionario antiguo o Array BI nuevo)
                    if (pedido.items) {
                        if (Array.isArray(pedido.items)) {
                            const dict = {};
                            pedido.items.forEach(item => {
                                dict[item.productoId] = item.cantidad;
                            });
                            setCantidades(dict);
                        } else {
                            setCantidades(pedido.items);
                        }
                    }
                    setAplicarDelivery(pedido.delivery_aplicado ?? true);
                } else {
                    const ultimoPedido = await db.pedidos.orderBy('id').last(); // [8]
                    const siguienteNumero = ultimoPedido ? (parseInt(ultimoPedido.numero_pedido) + 1).toString() : "1";

                    setFormData(prev => ({
                        ...prev,
                        numero_pedido: siguienteNumero,
                        tasa: tasaConfig ? tasaConfig.toString() : '',
                        delivery_tasa: deliveryValor || 0
                    }));
                }
            } catch (err) {
                console.error("Error cargando datos:", err);
            }
        };
        cargarDatos();
    }, [pedido]);

    useEffect(() => {
        const calcularFinanzas = () => {
            let costoMercanciaUSD = 0;
            let ventaEstimadaUSD = 0;

            Object.entries(cantidades).forEach(([prodId, qty]) => {
                const producto = productos.find(p => p.id === parseInt(prodId));
                if (producto && qty > 0) {
                    const grupo = listaGrupos.find(g => g.nombre.toLowerCase() === producto.grupo.toLowerCase());
                    if (grupo) {
                        costoMercanciaUSD += qty * (grupo.costo_$ || 0);
                        ventaEstimadaUSD += qty * (grupo.precio || 0);
                    }
                }
            });

            const cargoDelivery = aplicarDelivery ? (parseFloat(formData.delivery_tasa) || 0) : 0;
            const totalInversionUSD = costoMercanciaUSD + cargoDelivery;
            const tasaNum = parseFloat(formData.tasa) || 0;
            const utilidadUSD = ventaEstimadaUSD - totalInversionUSD;

            const ventaEstimadaBS = ventaEstimadaUSD * tasaNum;

            setTotales({
                usd: totalInversionUSD,
                bs: totalInversionUSD * tasaNum,
                ventaUsd: ventaEstimadaUSD,
                ventaBs: ventaEstimadaBS
            });
            setUtilidad({ usd: utilidadUSD, bs: utilidadUSD * tasaNum });
        };

        if (productos.length > 0) calcularFinanzas();
    }, [cantidades, productos, listaGrupos, formData.tasa, formData.delivery_tasa, aplicarDelivery]);

    const handleRecalcular = async () => {
        try {
            // ACTUALIZACIÃ“N FASE 2: Obtiene la tasa mÃ¡s reciente del historial [2, 3]
            const nuevaTasa = await db.getUltimaTasaBCV();
            const nuevoDelivery = await db.getConfigValue('delivery');
            const gruposActualizados = await db.getAll('grupos');

            setListaGrupos(gruposActualizados);
            setFormData(prev => ({
                ...prev,
                tasa: nuevaTasa ? nuevaTasa.toString() : prev.tasa,
                delivery_tasa: nuevoDelivery !== null ? nuevoDelivery : prev.delivery_tasa
            }));
            alert("Totales recalculados con Ã©xito.");
        } catch (err) {
            alert("Error al recalcular.");
        }
    };

    const handleLimpiar = () => {
        if (window.confirm("Â¿EstÃ¡s seguro de que deseas vaciar todas las cantidades seleccionadas?")) {
            setCantidades({});
        }
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (esVisualizacion) return;

        const mensaje = pedido
            ? `Â¿Actualizar cambios en el pedido #${formData.numero_pedido}?`
            : `Â¿Grabar el nuevo pedido #${formData.numero_pedido}?`;

        if (!window.confirm(mensaje)) return;

        // --- TRANSFORMACIÃ“N PARA BI --- [9, 10]
        const itemsBI = Object.entries(cantidades)
            .filter(([_, qty]) => qty > 0)
            .map(([prodId, qty]) => {
                const prod = productos.find(p => p.id === parseInt(prodId));
                const grupo = listaGrupos.find(g => g.nombre.toLowerCase() === prod.grupo.toLowerCase());
                const precioUnit = grupo?.precio || 0;
                const costoUnit = grupo?.costo_$ || 0;

                return {
                    productoId: parseInt(prodId),
                    nombre: prod.nombre,
                    grupo: prod.grupo,
                    cantidad: qty,
                    precioUnitario: precioUnit,
                    costoUnitario: costoUnit,
                    subtotalUsd: qty * precioUnit,
                    utilidadUsd: qty * (precioUnit - costoUnit)
                };
            });

        const pedidoData = {
            ...formData,
            items: itemsBI,
            total_usd: totales.usd,
            total_bs: totales.bs,
            venta_usd: totales.ventaUsd,
            venta_bs: totales.ventaBs,
            utilidad_usd: utilidad.usd,
            utilidad_bs: utilidad.bs,
            delivery_aplicado: aplicarDelivery,
            updatedAt: new Date().toISOString()
        };

        try {
            if (pedido?.id) {
                await db.put('pedidos', { ...pedidoData, id: pedido.id });
            } else {
                await db.add('pedidos', { ...pedidoData, createdAt: new Date().toISOString() });
            }
            onSave();
            onClose();
        } catch (error) {
            console.error("Error al guardar:", error);
            alert("Hubo un error al guardar el pedido.");
        }
    };

    const productosAgrupados = productos.reduce((acc, prod) => {
        const esVisible = prod.visible !== false;
        const tieneCantidad = (cantidades[prod.id] || 0) > 0;
        if (esVisible || tieneCantidad) {
            const grupo = prod.grupo || 'Otros';
            if (!acc[grupo]) acc[grupo] = [];
            acc[grupo].push(prod);
        }
        return acc;
    }, {});

    return (
        <div className={styles.overlay}>
            <div className={styles.modal}>
                <div className={styles.header}>
                    <span className={styles.title}>GESTIÃ“N DE PEDIDOS</span>
                    <button className={styles.closeButton} onClick={onClose}>Ã—</button>
                </div>

                <form onSubmit={handleSubmit} className={styles.content}>
                    <div className={styles.topRow}>
                        <div className={styles.inputGroup}>
                            <label className={styles.label}>Pedido #</label>
                            <input type="text" value={formData.numero_pedido} readOnly className={styles.inputSmall} />
                        </div>
                        <div className={styles.inputGroup}>
                            <label className={styles.label}>Fecha</label>
                            <input
                                type="date"
                                value={formData.fecha_pedido}
                                onChange={(e) => setFormData({ ...formData, fecha_pedido: e.target.value })}
                                className={esVisualizacion ? styles.inputReadOnly : styles.inputSmall}
                                disabled={esVisualizacion}
                            />
                        </div>
                    </div>

                    <div className={styles.totalsBar}>
                        <div className={styles.totalBox}>
                            <span className={styles.totalLabel}>INVERSIÃ“N TOTAL $</span>
                            <span className={styles.totalValue}>{totales.usd.toFixed(2)}</span>
                        </div>
                        <div className={styles.totalBox}>
                            <span className={styles.totalLabel}>VENTA ESTIMADA $</span>
                            <span className={styles.ventaValue}>{totales.ventaUsd.toFixed(2)}</span>
                        </div>
                    </div>

                    <div className={styles.totalsBar}>
                        <div className={styles.totalBox}>
                            <span className={styles.totalLabel}>INVERSIÃ“N TOTAL BS</span>
                            <span className={styles.totalValue}>{totales.bs.toFixed(2)}</span>
                        </div>
                        <div className={styles.totalBox}>
                            <span className={styles.totalLabel}>VENTA ESTIMADA BS</span>
                            <span className={styles.ventaValue}>{totales.ventaBs.toFixed(2)}</span>
                        </div>
                    </div>

                    <div className={styles.infoBar}>
                        <span>Tasa: {formData.tasa || '---'}</span>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                            <input
                                type="checkbox"
                                checked={aplicarDelivery}
                                onChange={(e) => setAplicarDelivery(e.target.checked)}
                                className={styles.checkbox}
                                disabled={esVisualizacion}
                            />
                            <span>Delivery: ${formData.delivery_tasa}</span>
                        </div>
                    </div>

                    <div className={styles.productListContainer}>
                        <div className={styles.productListHeader}>SelecciÃ³n de Productos</div>
                        <div className={styles.productList}>
                            {Object.entries(productosAgrupados).map(([grupo, items]) => (
[CONTENIDO SENSIBLE ELIMINADO EN: GestionPedido.jsx]
                                    <div className={styles.groupTitle}>{grupo.toUpperCase()}</div>
                                    {items.map((prod) => {
                                        const badgeColor = prod.stock === 0 ? '#ff4d4d' : (prod.stock <= 5 ? '#ffa500' : '#28a745');
                                        return (
[CONTENIDO SENSIBLE ELIMINADO EN: GestionPedido.jsx]
                                                <div className={styles.stockBadgeSmall} style={{ backgroundColor: badgeColor }}>{prod.stock}</div>
                                                <div className={styles.productName}>{prod.nombre}</div>
                                                <div className={styles.quantityControl}>
                                                    <button
                                                        type="button"
                                                        className={styles.qtyBtn}
                                                        onClick={() => setCantidades({ ...cantidades, [prod.id]: Math.max(0, (cantidades[prod.id] || 0) - 1) })}
                                                        disabled={esVisualizacion}
                                                    >-</button>
                                                    <span>{cantidades[prod.id] || 0}</span>
                                                    <button
                                                        type="button"
                                                        className={styles.qtyBtn}
                                                        onClick={() => setCantidades({ ...cantidades, [prod.id]: (cantidades[prod.id] || 0) + 1 })}
                                                        disabled={esVisualizacion}
                                                    >+</button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className={styles.utilidadBar}>
                        <div className={styles.utilidadBox}>
                            <span className={styles.utilidadLabel}>UTILIDAD EST. $</span>
                            <span style={{ fontWeight: 'bold', color: utilidad.usd >= 0 ? '#28a745' : '#f44336' }}>
                                ${utilidad.usd.toFixed(2)}
                            </span>
                        </div>
                        <div className={styles.utilidadBox}>
                            <span className={styles.utilidadLabel}>UTILIDAD EST. BS</span>
                            <span style={{ fontWeight: 'bold', color: utilidad.bs >= 0 ? '#28a745' : '#f44336' }}>
                                Bs. {utilidad.bs.toFixed(2)}
                            </span>
                        </div>
                    </div>

                    <div className={styles.footer}>
                        <button type="button" className={styles.limpiarBtn} onClick={handleLimpiar} disabled={esVisualizacion}>Limpiar</button>
                        <button type="button" className={styles.recalcularBtn} onClick={handleRecalcular} disabled={esVisualizacion}>Recalcular</button>
                        {!esVisualizacion && (
                            <button type="submit" className={styles.grabarBtn}>{pedido ? "Actualizar" : "Grabar"}</button>
                        )}
                    </div>
                </form>
            </div>
        </div>
    );
};

export default GestionPedido;
************************************************************

FILE: src/components/GestionPedido.module.css
------------------------------
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 11000;
}

.modal {
  background-color: #fff;
  width: 95%;
  max-width: 500px;
  max-height: 95vh;
  padding: 0px 15px 15px 15px;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid #00BFFF;
}

.title {
  font-size: 16px;
  font-weight: bold;
  color: #000;
}

.closeButton {
  background: none;
  border: none;
  font-size: 32px;
  cursor: pointer;
  color: #000;
}

.content {
  display: flex;
  flex-direction: column;
  gap: 8px;
  overflow-y: auto;
}

.topRow {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.inputGroup {
  display: flex;
  flex-direction: column;
  flex: 1;
}

.label {
  font-size: 14px;
  font-weight: bold;
  color: #000;
}

.totalsBar {
  display: flex;
  gap: 8px;
  justify-content: space-between;
}

.totalBox {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: #e1f5fe;
  padding: 6px;
  border: 1px solid #00BFFF;
  border-radius: 4px;
}

.totalLabel {
  font-size: 11px;
  font-weight: bold;
  color: #000;
  /* Se agrega color negro para cumplir con la solicitud */
}

.totalValue {
  font-size: 14px;
  font-weight: bold;
  color: #007bff;
}

.ventaValue {
  font-size: 14px;
  font-weight: bold;
  color: #9c27b0;
  /* Un color purpura para diferenciar de la inversiÃ³n */
}

.infoBar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  font-weight: bold;
  color: #000;
  /* Se agrega color negro para cumplir con la solicitud */
}

.productListContainer {
  border: 1px solid #aaa;
  border-radius: 4px;
  overflow: hidden;
}

.productListHeader {
  text-align: center;
  background-color: #00BFFF;
  color: white;
  padding: 4px;
  font-weight: bold;
}

.productList {
  height: 250px;
  overflow-y: auto;
}

.groupTitle {
  font-size: 14px;
  font-weight: bold;
  background-color: #f1f1f1;
  padding: 6px 10px;
  color: #000;
  /* Se agrega para que el texto del grupo sea negro */
}

.productItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  border-bottom: 1px solid #eee;
}

.stockBadgeSmall {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
}

.quantityControl {
  display: flex;
  align-items: center;
  gap: 8px;
  /* Aumentado ligeramente para mejor separaciÃ³n */

  /* Propiedades para hacer visible la cantidad */
  color: #000;
  /* Color negro para el nÃºmero */
  font-weight: bold;
  /* Resalta la cantidad */
  font-size: 16px;
  /* TamaÃ±o de fuente legible */
  min-width: 25px;
  /* Espacio mÃ­nimo para que el nÃºmero no se mueva */
  justify-content: center;
}

.qtyBtnOld {
  width: 32px;
  height: 32px;
  background-color: #eee;
  border: 1px solid #ccc;
  font-weight: bold;
  color: #000;
  /* Se aÃ±ade color negro para los signos + y - */
}

.qtyBtn {
  width: 32px;
  height: 32px;
  background-color: #eee;
  border: 1px solid #ccc;
  font-weight: bold;
  color: #000;
  /* Signos en color negro (solicitud anterior) */

  /* Nuevas propiedades para centrado */
  display: flex;
  align-items: center;
  /* Centrado vertical */
  justify-content: center;
  /* Centrado horizontal */
  padding: 0;
  /* Elimina paddings por defecto que puedan desviar el signo */
  line-height: normal;
  /* Asegura que el interlineado no afecte la posiciÃ³n */
}

.utilidadBar {
  display: flex;
  gap: 8px;
  padding: 8px;
  background-color: #f9f9f9;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.utilidadBox {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* --- ESTILOS DE LA BOTONERA INFERIOR --- */

.footer {
  display: flex;
  gap: 8px;
  margin-top: 15px;
  width: 100%;
}

.limpiarBtn,
.recalcularBtn,
.grabarBtn {
  flex: 1;
  /* Esto asegura que los 3 botones tengan el mismo ancho */
  padding: 12px 5px;
  border: none;
  border-radius: 4px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  text-align: center;
}

.limpiarBtn {
  background-color: #f44336;
  color: white;
}

.recalcularBtn {
  background-color: #007bff;
  color: white;
}

.grabarBtn {
  background-color: #28a745;
  color: white;
}

.grabarBtn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.inputSmall {
  padding: 8px;
  border-radius: 4px;
  width: 100%;
  box-sizing: border-box;
  font-size: 16px;
  background-color: #00BFFF;
  color: white;
  font-weight: bold;
  text-align: center;
  border: 1px solid #aaa;
}

.productName {
  color: #666;
  flex: 1;
  margin-left: 10px;
  font-size: 14px;
  /* Se reduce la fuente a 14px (2px menos que el estÃ¡ndar de 16px del componente) */
}

.utilidadLabel {
  font-size: 11px;
  font-weight: bold;
  color: #000;
  /* Negro solicitado */
  /* AquÃ­ podrÃ­as aÃ±adir un estilo diferente, como otro color o margen */
}
************************************************************

FILE: src/components/GruposCRUD/GruposCRUD.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database'; // Acceso a la instancia dbTasaBCV [4]
import ModalGrupo from './ModalGrupo';

const GruposCRUD = () => {
  const [grupos, setGrupos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [modalOpen, setModalOpen] = useState(false);
  const [grupoEditando, setGrupoEditando] = useState(null);

  // Carga inicial de los grupos desde IndexedDB [5, 6]
  useEffect(() => {
    cargarGrupos();
  }, []);

  const cargarGrupos = async () => {
    try {
      setLoading(true);
      // Obtiene todos los registros de la tabla 'grupos' [7, 8]
      const datos = await db.getAll('grupos');
      setGrupos(datos);
    } catch (err) {
      setError('Error al cargar los grupos: ' + err.message);
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  const handleEditar = (grupo) => {
    setGrupoEditando(grupo);
    setModalOpen(true); // Abre el modal para ediciÃ³n [7, 8]
  };

  const handleEliminar = async (grupo) => {
    if (window.confirm(`Â¿EstÃ¡s seguro de eliminar el grupo "${grupo.nombre}"?`)) {
      try {
        // Verifica integridad referencial antes de eliminar [8, 9]
        const productosConGrupo = await db.getAll('productos', { grupo: grupo.nombre });
        if (productosConGrupo.length > 0) {
          alert(`No se puede eliminar. Hay ${productosConGrupo.length} producto(s) usando este grupo.`);
          return;
        }
        await db.del('grupos', grupo.id);
        cargarGrupos(); // Refresca la lista tras eliminar [1, 9]
      } catch (err) {
        setError('Error al eliminar: ' + err.message);
      }
    }
  };

  const handleNuevoGrupo = () => {
    setGrupoEditando(null);
    setModalOpen(true); // Abre el modal para nuevo registro [1, 9]
  };

  if (loading) return <div style={styles.loading}>Cargando grupos...</div>;

  return (
    <div style={styles.container}>
      {/* TÃ­tulo actualizado y color blanco para visibilidad [1, 2] */}
      <h1 style={styles.title}>Panel de Grupos</h1>

      {error && <div style={styles.errorAlert}>{error}</div>}

      <button onClick={handleNuevoGrupo} style={styles.nuevoButton}>
        + Agregar Nuevo Grupo
      </button>

      <div style={styles.lista}>
        {grupos.length === 0 ? (
          <div style={styles.vacio}>No hay grupos registrados.</div>
        ) : (
          grupos.map(grupo => (
[CONTENIDO SENSIBLE ELIMINADO EN: GruposCRUD.jsx]
              <div style={styles.itemInfo}>
                <div style={styles.itemNombre}>{grupo.nombre}</div>
                {/* VisualizaciÃ³n de Precio y nuevo campo Costo [10, 11] */}
                <div style={styles.itemPrecio}>Precio: ${grupo.precio.toFixed(2)}</div>
                <div style={styles.itemCosto}>
                  Costo: ${grupo.costo_$ ? grupo.costo_$.toFixed(2) : "0.00"}
                </div>
                <div style={styles.itemId}>ID: {grupo.id}</div>
              </div>
              <div style={styles.itemActions}>
                <button onClick={() => handleEditar(grupo)} style={styles.btnEditar}>Editar</button>
                <button onClick={() => handleEliminar(grupo)} style={styles.btnEliminar}>Eliminar</button>
              </div>
            </div>
          ))
        )}
      </div>

      <div style={styles.resumen}>
        Total: {grupos.length} grupo{grupos.length !== 1 ? 's' : ''}
      </div>

      {/* Renderizado condicional del Modal para evitar duplicidad [10, 12] */}
      {modalOpen && (
        <ModalGrupo 
          grupo={grupoEditando} 
          onClose={() => setModalOpen(false)} 
          onSave={cargarGrupos} 
        />
      )}
    </div>
  );
};

const styles = {
  container: { padding: '20px', maxWidth: '800px', margin: '0 auto' },
  // Estilo corregido: Blanco para contrastar con el fondo oscuro #242424 [2, 13]
  title: { marginBottom: '20px', color: '#ffffff', fontWeight: 'bold', textAlign: 'center' },
  loading: { padding: '40px', textAlign: 'center', color: '#fff' },
  errorAlert: { backgroundColor: '#fee', color: '#c33', padding: '10px', borderRadius: '4px', marginBottom: '20px' },
  nuevoButton: { marginBottom: '20px', padding: '10px 15px', backgroundColor: '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: '500' },
  lista: { border: '1px solid #ddd', borderRadius: '4px', overflow: 'hidden', marginBottom: '20px' },
  vacio: { padding: '40px', textAlign: 'center', color: '#666' },
  item: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '15px', borderBottom: '1px solid #eee', backgroundColor: 'white' },
  itemInfo: { flex: 1 },
  itemNombre: { fontWeight: 'bold', fontSize: '18px', marginBottom: '5px', color: '#333' },
  itemPrecio: { color: '#007bff', marginBottom: '3px', fontWeight: '500' },
  // Estilo especÃ­fico para el campo de costo en rojo [11]
  itemCosto: { color: '#dc3545', marginBottom: '3px', fontWeight: '500' },
  itemId: { fontSize: '12px', color: '#999' },
  itemActions: { display: 'flex', gap: '10px' },
  btnEditar: { padding: '8px 12px', backgroundColor: '#2196F3', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' },
  btnEliminar: { padding: '8px 12px', backgroundColor: '#f44336', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' },
  resumen: { marginTop: '20px', padding: '10px', backgroundColor: '#f5f5f5', borderRadius: '4px', fontSize: '14px', textAlign: 'center', color: '#333' }
};

export default GruposCRUD;
************************************************************

FILE: src/components/GruposCRUD/ModalGrupo.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database';

const ModalGrupo = ({ grupo, onClose, onSave }) => {
  const [formData, setFormData] = useState({
    nombre: '',
    precio: 0,
    costo_$: 0
  });

  useEffect(() => {
    if (grupo) {
      setFormData({
        nombre: grupo.nombre || '',
        precio: grupo.precio || 0,
        costo_$: grupo.costo_$ || 0
      });
    }
  }, [grupo]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      if (grupo) {
        await db.put('grupos', { id: grupo.id, ...formData });
      } else {
        await db.add('grupos', formData);
      }
      onSave();
      onClose();
    } catch (err) {
      alert('Error al guardar: ' + err.message);
    }
  };

  return (
    <div style={modalStyles.overlay}>
      <div style={modalStyles.modal}>
        <h2 style={{color: '#000'}}>GESTIÃ“N DE GRUPO</h2>
        <form onSubmit={handleSubmit}>
          <div style={modalStyles.field}>
            <label style={{color: '#000'}}>Nombre:</label>
            <input 
              type="text" 
              value={formData.nombre} 
              onChange={e => setFormData({...formData, nombre: e.target.value})}
              required 
            />
          </div>
          <div style={modalStyles.field}>
            <label style={{color: '#000'}}>Precio ($):</label>
            <input 
              type="number" 
              step="0.01"
              value={formData.precio} 
              onChange={e => setFormData({...formData, precio: parseFloat(e.target.value)})}
            />
          </div>
          <div style={modalStyles.field}>
            <label style={{color: '#000'}}>Costo ($):</label>
            <input 
              type="number" 
              step="0.01"
              value={formData.costo_$} 
              onChange={e => setFormData({...formData, costo_$: parseFloat(e.target.value)})}
            />
          </div>
          <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
            <button type="submit" style={{backgroundColor: '#28a745', color: '#fff'}}>Guardar</button>
            <button type="button" onClick={onClose} style={{backgroundColor: '#ccc'}}>Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  );
};

const modalStyles = {
  overlay: { position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 3000 },
  modal: { backgroundColor: '#fff', padding: '20px', borderRadius: '8px', width: '90%', maxWidth: '400px' },
  field: { display: 'flex', flexDirection: 'column', marginBottom: '10px' }
};

export default ModalGrupo;
************************************************************

FILE: src/components/Header.jsx
------------------------------
import React, { useState } from 'react';
import Sidebar from './Sidebar';

export default function Header() {
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    return (
        <header style={styles.header}>
            <div style={styles.nav}>
                {/* BotÃ³n Tipo Side Menu (Hamburguesa) */}
                <button
                    onClick={() => setIsMenuOpen(true)}
                    style={styles.menuBtn}
                >
                    â˜°
                </button>

                <h1 style={styles.brand}>
                    Natura App 
                </h1>
                <div style={{ width: '40px' }} /> {/* Espaciador para centrar tÃ­tulo */}
            </div>

            <Sidebar
                isOpen={isMenuOpen}
                onClose={() => setIsMenuOpen(false)}
            />
        </header>
    );
}

const styles = {
    header: {
        padding: '0.5rem 1rem',
        backgroundColor: '#f8f9fa',
        borderBottom: '1px solid #dee2e6',
        position: 'sticky',
        top: 0,
        zIndex: 10000
    },
    nav: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center'
    },
    menuBtn: {
        fontSize: '1.8rem',
        background: 'none',
        border: 'none',
        color: '#007bff',
        cursor: 'pointer',
        marginLeft: '0px'
    },
    brand: {
        fontSize: '1.8rem',
        margin: 0,
        color: '#333',
        fontWeight: 'bold'
    }
};
************************************************************

FILE: src/components/Panel/Panel.jsx
------------------------------
// src/components/Panel/Panel.jsx
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { db } from "../../lib/db/database";
import { useGrupos } from "./hooks/useGrupos";
import { useProductos } from "./hooks/useProductos";
import { exportDatabase } from "../../lib/db/utils/exportService";
import {
  migrateOrdersToBI,
  migrateSalesToBI // Fase 2: Nueva importaciÃ³n para transformaciÃ³n de ventas
} from "../../lib/db/utils/migrationService";
import styles from "./Panel.module.css";

export default function Panel() {
  const navigate = useNavigate();
  const { importarGrupos } = useGrupos();
  const { importarProductos } = useProductos();

  // Estados para control de procesos
  const [isExporting, setIsExporting] = useState(false);
  const [isMigrating, setIsMigrating] = useState(false); // Pedidos
  const [isMigratingSales, setIsMigratingSales] = useState(false); // Fase 2: Ventas
  const [isLoadingHistory, setIsLoadingHistory] = useState(false);

  /**
   * Maneja la exportaciÃ³n de la base de datos a un archivo JSON [4, 5]
   */
  const handleExport = async () => {
    setIsExporting(true);
    const result = await exportDatabase();
    if (result.success) {
      alert("âœ… Copia de seguridad guardada en Descargas");
    } else {
      alert("âŒ Error al exportar: " + (result.error?.message || "Error desconocido"));
    }
    setIsExporting(false);
  };

  /**
   * Fase 2: Ejecuta la migraciÃ³n de ventas antiguas al formato BI [Plan de Mejoras]
   * Agrega costos y utilidades retroactivas a la tabla 'ventas'.
   */
  const handleMigrateSalesBI = async () => {
    const mensajeConfirmacion = "ğŸ“ˆ Â¿Deseas normalizar el historial de VENTAS para BI?\n\n" +
      "Se asignarÃ¡n costos y utilidades a las ventas pasadas basÃ¡ndose en los grupos actuales.";

    if (!window.confirm(mensajeConfirmacion)) return;

    setIsMigratingSales(true);
    try {
      const result = await migrateSalesToBI();
      if (result.success) {
        alert(result.message);
      } else {
        alert("âŒ Error: " + result.error);
      }
    } catch (error) {
      alert("âŒ Error crÃ­tico: " + error.message);
    } finally {
      setIsMigratingSales(false);
    }
  };

  /**
   * Ejecuta la migraciÃ³n de pedidos antiguos al formato BI detallado [6, 7]
   */
  const handleMigrateBI = async () => {
    const mensajeConfirmacion = "âš ï¸ Â¿Deseas iniciar la migraciÃ³n de pedidos al formato BI?\n\n" +
      "Esta acciÃ³n transformarÃ¡ los pedidos antiguos para habilitar la analÃ­tica financiera.";

    if (!window.confirm(mensajeConfirmacion)) return;

    setIsMigrating(true);
    try {
      const result = await migrateOrdersToBI();
      if (result.success) {
        alert(result.message);
      } else {
        alert("âŒ Error en la migraciÃ³n: " + result.error);
      }
    } catch (error) {
      alert("âŒ Error crÃ­tico: " + error.message);
    } finally {
      setIsMigrating(false);
    }
  };

  /**
   * Carga masiva de los dÃ­as de histÃ³rico de tasas BCV recolectados [8, 9]
   */
  const handleLoadHistory = async () => {
    if (!window.confirm("Â¿Deseas cargar el histÃ³rico de tasas BCV?")) return;
    setIsLoadingHistory(true);
    try {
      const result = await db.cargarDatosInicialesHistorico();
      if (result.success) {
        alert(result.message);
      } else {
        alert("âŒ Error: " + result.error);
      }
    } catch (err) {
      alert("âŒ Error crÃ­tico: " + err.message);
    } finally {
      setIsLoadingHistory(false);
    }
  };

  /**
   * ImportaciÃ³n masiva de grupos y productos iniciales [10, 11]
   */
  const handleImportInitialData = async () => {
    if (!window.confirm("Â¿Importar datos iniciales (Grupos y Productos)? Se sobrescribirÃ¡n los datos existentes.")) return;

    const resultGrupos = await importarGrupos();
    const resultProductos = await importarProductos();

    let mensaje = "";

    if (resultGrupos.success) {
      mensaje += `âœ… ${resultGrupos.message}\n`;
    } else {
      mensaje += `âŒ Error Grupos: ${resultGrupos.error}\n`;
    }

    if (resultProductos.success) {
      mensaje += `âœ… ${resultProductos.message}\n`;
    } else {
      mensaje += `âŒ Error Productos: ${resultProductos.error}\n`;
    }

    alert(mensaje);
  };

  return (
    <div className={styles.container}>
      <h1 className={styles.title}>PANEL DE CONTROL</h1>

      <div className={styles.buttons}>

        {/* ImportaciÃ³n de ConfiguraciÃ³n Inicial [12] */}
        <button className={styles.button} onClick={handleImportInitialData}>
          ğŸ“¥ Cargar Datos Iniciales (Grupos y Productos)
        </button>

        {/* GestiÃ³n de Datos y Backups [4] */}
        <button
          className={styles.button}
          onClick={handleExport}
          disabled={isExporting}
        >
          {isExporting ? "âŒ› Exportando..." : "ğŸ“¤ Exportar DB"}
        </button>

        {/* Fase 2: MigraciÃ³n AnalÃ­tica de Ventas (Snapshot Financiero) */}
        <button
          className={styles.button}
          onClick={handleMigrateSalesBI}
          disabled={isMigratingSales}
          style={{ backgroundColor: '#4a148c' }} // PÃºrpura oscuro para diferenciar
        >
          {isMigratingSales ? "âš™ï¸ Transformando..." : "ğŸ“ˆ Migrar Ventas a BI"}
        </button>

        {/* MigraciÃ³n AnalÃ­tica de Pedidos [3] */}
        <button
          className={styles.button}
          onClick={handleMigrateBI}
          disabled={isMigrating}
          style={{ backgroundColor: '#6a1b9a' }}
        >
          {isMigrating ? "âš™ï¸ Migrando..." : "ğŸ“Š Migrar Pedidos a BI"}
        </button>

        {/* Carga de HistÃ³rico de Tasas [3] */}
        <button
          className={styles.button}
          onClick={handleLoadHistory}
          disabled={isLoadingHistory}
          style={{ backgroundColor: '#f39c12' }}
        >
          {isLoadingHistory ? "âš™ï¸ Cargando..." : "ğŸ“‰ Cargar HistÃ³rico BCV"}
        </button>

        
        <hr style={{ width: '80%', margin: '20px 0', opacity: 0.2 }} />


        {/* BotÃ³n Regresar [12] */}
        <button
          className={`${styles.button} ${styles.back}`}
          onClick={() => navigate("/")}
        >
          â†©ï¸ Regresar
        </button>
      </div>
    </div>
  );
}
************************************************************

FILE: src/components/Panel/Panel.module.css
------------------------------
/* Ocupa todo el ancho y alto de la pantalla */
.container {
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;   /* centra verticalmente */
  align-items: center;       /* centra horizontalmente */
  background: #fafafa;
}

/* TÃ­tulo */
.title {
  font-size: 2rem;
  margin-bottom: 40px;
  font-weight: bold;
  color: #333;
}

/* Contenedor de los botones para mantenerlos centrados */
.buttons {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Botones */
.button {
  width: 75%;
  max-width: 300px;
  padding: 14px 0;
  margin: 10px 0;
  font-size: 1.1rem;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #007bff;
  color: white;
  transition: background 0.25s;
}

.button:hover {
  background: #005fcc;
}

/* BotÃ³n Regresar */
.back {
  background: #555;
}

.back:hover {
  background: #333;
}

************************************************************

FILE: src/components/Panel/hooks/useGrupos.js
------------------------------
// src/components/Panel/hooks/useGrupos.js
import { useState } from 'react';
import gruposData from '../../../data/grupos.json';
import { db } from '../../../lib/db/database.js'; 

export function useGrupos() {
  
  const [error, setError] = useState(null);

  const importarGrupos = async () => { 
          
    try {
              
      // 1. CONVERTIR {clave:valor} a [{nombre, precio}]
      const gruposArray = Object.entries(gruposData).map(([nombre, precio]) => ({
        nombre: nombre,
        precio: Number(precio)
      }));
  
      // 2. LIMPIAR TABLA
      await db.grupos.clear();
 
      // 3. INSERTAR NUEVOS DATOS
      await db.grupos.bulkAdd(gruposArray);
  
      return {
        success: true,
        count: gruposArray.length,
        message: `${gruposArray.length} grupos importados`
      };
  
    } catch (error) {
      console.error('Error en importaciÃ³n:', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  

  const verificarGrupos = async () => {
    try {
      const { db } = await import('../../../lib/db/database.js');
      const grupos = await db.grupos.toArray();
      
      return {
        success: true,
        data: grupos,
        count: grupos.length,
        message: `${grupos.length} grupos encontrados`
      };
    } catch (err) {
      console.error('Error verificando grupos:', err);
      return {
        success: false,
        error: err.message,
        data: []
      };
    }
  };

  return {
    importarGrupos,
    verificarGrupos,    
    error,
    clearError: () => setError(null)
  };
}
************************************************************

FILE: src/components/Panel/hooks/useProductos.jsx
------------------------------
// src/components/Panel/hooks/useProductos.js
import { useState } from 'react';
import productosData from '../../../data/data.json';
import { db } from '../../../lib/db/database.js'; // Import normal

export function useProductos() {
  const [error, setError] = useState(null);

const importarProductos = async () => {
  try {
    // 1. OBTENER EL ARRAY DE PRODUCTOS
    // Accedemos a la propiedad "productos" del objeto
    const productosArray = productosData.productos;
    
    // Si necesitas asegurar que cada producto tenga un campo createdAt
    const productosConFecha = productosArray.map(producto => ({
      ...producto,
      createdAt: producto.createdAt || new Date().toISOString() // Fecha actual si no existe
    }));

    // 2. LIMPIAR TABLA
    await db.productos.clear();

    // 3. INSERTAR NUEVOS DATOS
    await db.productos.bulkAdd(productosConFecha);

    console.log(`Importando ${productosConFecha.length} productos...`);

    return {
      success: true,
      count: productosConFecha.length,
      total: productosConFecha.length,
      message: `${productosConFecha.length} productos importados exitosamente.`
    };

  } catch (error) {
    console.error('Error en importaciÃ³n de productos:', error);
    return {
      success: false,
      error: error.message
    };
  }
};

  const verificarProductos = async () => {
  };

  return {
    importarProductos,
    verificarProductos,
    error
  };
}
************************************************************

FILE: src/components/Pedidos.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { db } from '../lib/db/database';
import GestionPedido from './GestionPedido';
import { formatDate } from '../lib/utils.js';
import { ORDER_STATUS } from '../lib/constants';
import styles from './Pedidos.module.css';


const PedidosComponente = () => {
  const navigate = useNavigate();
  const [listaPedidos, setListaPedidos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [modalOpen, setModalOpen] = useState(false);
  const [pedidoSeleccionado, setPedidoSeleccionado] = useState(null);
  const [isProcessing, setIsProcessing] = useState(false);
  const [stats, setStats] = useState({ pedidosActivos: 0, pedidosCerrados: 0 });

  const cargarRegistros = async () => {
    try {
      setLoading(true);

      // OPTIMIZACIÃ“N: Usar el Ã­ndice de Dexie para traer los pedidos ya ordenados por ID (o nÃºmero)
      // Como el ID es autoincremental, el orden inverso del ID suele coincidir con el tiempo.
      // Si queremos exactitud por numero_pedido, usamos ese Ã­ndice.
      const datosOrdenados = await db.db.pedidos
        .orderBy('id')
        .reverse()
        .toArray();

      setListaPedidos(datosOrdenados);

      const activos = datosOrdenados.filter(p => !p.estatus || p.estatus === ORDER_STATUS.ACTIVE).length;
      const cerrados = datosOrdenados.filter(p => p.estatus === ORDER_STATUS.CLOSED).length;

      setStats({ pedidosActivos: activos, pedidosCerrados: cerrados });
    } catch (error) {
      console.error("Error al cargar pedidos:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    cargarRegistros();
  }, []);

  // --- ACTUALIZACIÃ“N FASE 5: LÃ³gica para Array de Items (BI) ---
  const handleExportTxt = async (pedido, e) => {
    e.stopPropagation();
    try {
      let contenido = `PEDIDO NATURA ICE\n`;
      contenido += `==============================\n\n`;
      contenido += `Numero: #${pedido.numero_pedido}\n`;
      contenido += `Fecha: ${formatDate(pedido.fecha_pedido)}\n`;
      contenido += `Tasa BCV: ${pedido.tasa}\n`;
      contenido += `==============================\n`;
      contenido += `PRODUCTOS SOLICITADOS:\n`;
      contenido += `==============================\n\n`;

      let totalUnidades = 0;

      // CAMBIO CLAVE: Recorremos directamente el array de BI [Snapshot histÃ³rico]
      pedido.items.forEach((item) => {
        if (item.cantidad > 0) {
          // El nombre ya viene en el item, no hace falta buscar en la tabla 'productos'
          contenido += `${item.cantidad} x ${item.nombre}\n`;
          totalUnidades += item.cantidad;
        }
      });

      const costoDelivery = pedido.delivery_aplicado ? (parseFloat(pedido.delivery_tasa) || 0) : 0;

      contenido += `\n==============================\n`;
      contenido += `RESUMEN:\n`;
      contenido += `==============================\n\n`;
      contenido += `Total Unidades: ${totalUnidades}\n`;
      contenido += `Delivery: ${costoDelivery.toFixed(2)}\n`;
      contenido += `----------------------------\n`;
      contenido += `Total USD + Deliv: $${(pedido.total_usd).toFixed(2)}\n`;
      contenido += `Total Bs: Bs. ${pedido.total_bs.toFixed(2)}\n\n`;

      contenido += `==============================\n`;
      contenido += `INFORMACION:\n`;
      contenido += `==============================\n\n`;
      contenido += `Distribuidor: Natura Ice\n`;
      contenido += `Generado: ${new Date().toLocaleDateString('es-ES')}\n`;
      contenido += `==============================\n`;

      const blob = new Blob([contenido], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `Pedido_${pedido.numero_pedido}.txt`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

    } catch (error) {
      console.error("Error exportando pedido:", error);
      alert("No se pudo generar el archivo de texto.");
    }
  };

  // --- ACTUALIZACIÃ“N FASE 5: RecepciÃ³n de pedido con items detallados ---
  const handleRecibirPedido = async (pedido, e) => {
    e.stopPropagation();
    if (pedido.estatus === ORDER_STATUS.CLOSED || isProcessing) return;

    const confirmar = window.confirm(`Â¿Marcar Pedido #${pedido.numero_pedido} como RECIBIDO?\nSe actualizarÃ¡ el stock.`);
    if (!confirmar) return;

    setIsProcessing(true);
    try {
      await db.db.transaction('rw', [db.productos, db.pedidos], async () => {
        // CAMBIO CLAVE: IteraciÃ³n sobre el array de objetos detallados
        for (const item of pedido.items) {
          // Usamos el productoId guardado en el snapshot del item [2, 7]
          await db.updateStock(item.productoId, item.cantidad);
        }

        await db.pedidos.update(pedido.id, {
          estatus: ORDER_STATUS.CLOSED,
          updatedAt: new Date().toISOString()
        });
      });

      alert("âœ… Inventario actualizado exitosamente.");
      await cargarRegistros();
    } catch (error) {
      console.error("Error al recibir pedido:", error);
      alert(`âŒ Error: ${error.message}`);
    } finally {
      setIsProcessing(false);
    }
  };

  const handleEliminar = async (pedido, e) => {
    e.stopPropagation();
    if (pedido.estatus === ORDER_STATUS.CLOSED || isProcessing) return;
    if (window.confirm(`Â¿Eliminar pedido #${pedido.numero_pedido}?`)) {
      await db.del('pedidos', pedido.id);
      cargarRegistros();
    }
  };

  return (
    <div className={styles.container}>
      <header className={styles.header}>
        <button onClick={() => navigate(-1)} className={styles.backArrow}>â†</button>
        <span className={styles.title}>Pedidos Natura</span>
        <button className={styles.addBtnCircle} onClick={() => { setPedidoSeleccionado(null); setModalOpen(true); }}>+</button>
      </header>

      <div className={styles.statsBar}>
        <div className={styles.statCard}>
          <span className={styles.statNumber}>{listaPedidos.length}</span>
          <span className={styles.statLabel}>TOTAL</span>
        </div>
        <div className={styles.statCard}>
          <span className={styles.statNumber}>{stats.pedidosActivos}</span>
          <span className={styles.statLabel}>PENDIENTES</span>
        </div>
        <div className={styles.statCard}>
          <span className={styles.statNumber}>{stats.pedidosCerrados}</span>
          <span className={styles.statLabel}>RECIBIDOS</span>
        </div>
      </div>

      <div className={styles.listaCards}>
        {loading ? (
          <p className={styles.loading}>Cargando registros...</p>
        ) : (
          listaPedidos.map((p) => (
            <div
[CONTENIDO SENSIBLE ELIMINADO EN: Pedidos.jsx]
              className={styles.pedidoCard}
              onClick={() => { if (!isProcessing) { setPedidoSeleccionado(p); setModalOpen(true); } }}
              style={{ '--status-color': p.estatus === ORDER_STATUS.CLOSED ? '#4f46e5' : '#f39c12' }}
            >
              <div className={styles.cardHeader}>
                <span className={styles.orderNumber}>#{p.numero_pedido}</span>
                <span className={`${styles.statusBadge} ${p.estatus === ORDER_STATUS.CLOSED ? styles.statusCerrado : styles.statusPendiente}`}>
                  {p.estatus === ORDER_STATUS.CLOSED ? 'Recibido' : 'Pendiente'}
                </span>
              </div>

              <div className={styles.tasaRow}>
                <span>Tasa BCV:</span>
                <span>{p.tasa || '---'}</span>
              </div>

              <div className={styles.cardBody}>
                <span className={styles.cardDate}>{formatDate(p.fecha_pedido)}</span>
                <div className={styles.totalSection}>
                  <span className={styles.totalUsd}>${p.total_usd?.toFixed(2)}</span>
                  <div className={styles.utilidadUsdCard}>+${p.utilidad_usd?.toFixed(2)} UTIL.</div>
                </div>
              </div>

              <div className={styles.cardActions}>
                <button
                  className={styles.actionBtn}
                  onClick={(e) => { e.stopPropagation(); setPedidoSeleccionado(p); setModalOpen(true); }}
                  disabled={p.estatus === ORDER_STATUS.CLOSED}
                  title="Editar"
                >âœï¸</button>
                <button
                  className={styles.actionBtn}
                  onClick={(e) => handleExportTxt(p, e)}
                  title="Exportar TXT"
                >ğŸ“„</button>
                <button
                  className={styles.actionBtn}
                  onClick={(e) => handleRecibirPedido(p, e)}
                  disabled={p.id === pedidoSeleccionado?.id && isProcessing}
                  title="Recibir Pedido"
                >
                  {isProcessing && p.id === pedidoSeleccionado?.id ? 'âŒ›' : 'ğŸ“¥'}
                </button>
                <button
                  className={styles.actionBtn}
                  onClick={(e) => handleEliminar(p, e)}
                  disabled={p.estatus === ORDER_STATUS.CLOSED}
                  title="Eliminar"
                >ğŸ—‘ï¸</button>
              </div>
            </div>
          ))
        )}
      </div>

      {modalOpen && (
        <GestionPedido
          pedido={pedidoSeleccionado}
          onClose={() => { setModalOpen(false); cargarRegistros(); }}
          onSave={cargarRegistros}
        />
      )}
    </div>
  );
};

export default PedidosComponente;
************************************************************

FILE: src/components/Pedidos.module.css
------------------------------
.container {
    display: flex;
    flex-direction: column;
    width: 100vw;
    min-height: 100vh;
    background: #f8fafc;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    overflow-x: hidden;
    font-family: 'Inter', sans-serif;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px 32px;
    background: white;
    border-bottom: 1px solid #e2e8f0;
    position: sticky;
    top: 0;
    z-index: 100;
}

.backArrow {
    background: #f1f5f9;
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    color: #64748b;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    margin-right: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    flex-shrink: 0;
    padding: 0;
}

.backArrow:hover {
    background: #e2e8f0;
    color: #0f172a;
}

.title {
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
    letter-spacing: -0.5px;
    flex: 1;
}

.addBtnCircle {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: #27ae60;
    color: white;
    border: none;
    font-size: 28px;
    font-weight: 900;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 15px -3px rgba(39, 174, 96, 0.3);
    flex-shrink: 0;
    padding: 0;
}

.addBtnCircle:hover {
    background: #2ecc71;
    transform: translateY(-2px) scale(1.1);
    box-shadow: 0 15px 20px -3px rgba(39, 174, 96, 0.4);
}

.statsBar {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding: 24px 32px;
}

.statCard {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
    border: 1px solid #f1f5f9;
}

.statNumber {
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
}

.statLabel {
    font-size: 0.65rem;
    font-weight: 700;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 4px;
}

.listaCards {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 0 32px 32px 32px;
}

.pedidoCard {
    background: white;
    border-radius: 32px;
    padding: 24px 32px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
    display: flex;
    flex-direction: column;
    gap: 20px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.pedidoCard:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 35px rgba(0, 0, 0, 0.08);
    border-color: #cbd5e1;
}

.cardHeader {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.orderNumber {
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
}

.statusBadge {
    font-size: 0.7rem;
    padding: 6px 16px;
    border-radius: 30px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.statusPendiente {
    background: #fff4e5;
    color: #f39c12;
}

.statusCerrado {
    background: #eef2ff;
    color: #4f46e5;
}

.tasaRow {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: #eef2ff;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    color: #4338ca;
}



.cardBody {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 16px;
    align-items: center;
}

.cardDate {
    font-size: 0.9rem;
    color: #64748b;
    font-weight: 500;
}

.totalSection {
    background: #f0fdf4;
    padding: 12px 20px;
    border-radius: 20px;
    border: 1px solid #dcfce7;
    text-align: center;
}

.totalUsd {
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    font-weight: 800;
    color: #166534;
    display: block;
}

.utilidadUsdCard {
    font-size: 0.65rem;
    font-weight: 700;
    color: #15803d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 2px;
}

.cardActions {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    padding-top: 16px;
    border-top: 1px solid #f1f5f9;
}

.actionBtn {
    height: 44px;
    border-radius: 14px;
    border: 1px solid #e2e8f0;
    background: white;
    font-size: 1.1rem;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.actionBtn:hover:not(:disabled) {
    background: #f8fafc;
    border-color: #cbd5e1;
    transform: translateY(-2px);
}

.actionBtn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}
************************************************************

FILE: src/components/ProductosCRUD/ModalProducto.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database'; // Acceso a dbTasaBCV [4]

const ModalProducto = ({ producto, grupos, onClose, onSave }) => {
  // Estado inicial incluyendo el campo 'visible' soportado en la versiÃ³n 8 de la DB [1, 2]
  const [formData, setFormData] = useState({
    id: '',
    nombre: '',
    grupo: '',
    stock: 0,
    imagen: '',
    visible: true 
  });

  const [error, setError] = useState('');
  const [validando, setValidando] = useState(false);

  // Efecto para cargar los datos del producto al editar [2, 5]
  useEffect(() => {
    if (producto) {
      setFormData({
        id: producto.id.toString(),
        nombre: producto.nombre || '',
        grupo: producto.grupo || '',
        stock: producto.stock || 0,
        imagen: producto.imagen || '',
        // Se asegura la carga del campo visible (predeterminado a true si no existe) [1]
        visible: producto.visible !== undefined ? producto.visible : true 
      });
    } else {
      setFormData({
        id: '',
        nombre: '',
        grupo: grupos.length > 0 ? grupos.nombre : '',
        stock: 0,
        imagen: '',
        visible: true
      });
    }
  }, [producto, grupos]);

  // Valida que el ID no estÃ© duplicado en IndexedDB [5]
  const validarIdExistente = async (id) => {
    try {
      const existe = await db.get('productos', parseInt(id));
      return !!existe;
    } catch (err) {
      console.error('Error validando ID:', err);
      return false;
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    
    // Manejo especÃ­fico para el campo booleano 'visible'
    if (name === 'visible') {
      setFormData(prev => ({ ...prev, visible: value === 'true' }));
      return;
    }

    setFormData(prev => ({
      ...prev,
      [name]: name === 'stock' || name === 'id' ?
        (value === '' ? '' : value.replace(/\D/g, '')) :
        value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setValidando(true);

    // Validaciones bÃ¡sicas de integridad [3, 5]
    if (!formData.id.trim()) {
      setError('El ID es requerido');
      setValidando(false);
      return;
    }

    const idNumero = parseInt(formData.id);
    if (isNaN(idNumero) || idNumero <= 0) {
      setError('El ID debe ser un nÃºmero positivo');
      setValidando(false);
      return;
    }

    if (!formData.nombre.trim()) {
      setError('El nombre es requerido');
      setValidando(false);
      return;
    }

    try {
      const dataToSave = {
        id: idNumero,
        nombre: formData.nombre,
        grupo: formData.grupo,
        stock: parseInt(formData.stock),
        imagen: formData.imagen,
        visible: formData.visible, // Persistencia del estado de visibilidad [1]
        createdAt: producto ? producto.createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };

      if (producto) {
        const idCambiado = idNumero !== producto.id;
        if (idCambiado) {
          const idExiste = await validarIdExistente(idNumero);
          if (idExiste) {
            setError(`El ID ${idNumero} ya estÃ¡ en uso`);
            setValidando(false);
            return;
          }
          await db.del('productos', producto.id);
          await db.add('productos', dataToSave);
        } else {
          await db.put('productos', dataToSave); // Actualiza registro existente [6]
        }
      } else {
        const idExiste = await validarIdExistente(idNumero);
        if (idExiste) {
          setError(`El ID ${idNumero} ya estÃ¡ en uso`);
          setValidando(false);
          return;
        }
        await db.add('productos', dataToSave); // Crea nuevo registro [7]
      }

      onSave(); // Refresca la lista en el componente padre [8]
      onClose();
    } catch (err) {
      setError('Error al guardar: ' + err.message);
    } finally {
      setValidando(false);
    }
  };

  return (
    <div style={modalStyles.overlay}>
      <div style={modalStyles.modal}>
        <div style={modalStyles.header}>
          <h3 style={{ margin: 0, color: '#333' }}>
            {producto ? 'âœï¸ Editar Producto' : 'â• Nuevo Producto'}
          </h3>
          <button onClick={onClose} style={modalStyles.closeBtn}>Ã—</button>
        </div>

        <form onSubmit={handleSubmit} style={{ padding: '20px' }}>
          {error && (
            <div style={modalStyles.errorBox}>
              âš ï¸ {error}
            </div>
          )}

          {/* Fila: ID y Stock [9] */}
          <div style={{ display: 'flex', gap: '15px', marginBottom: '15px' }}>
            <div style={{ flex: 1 }}>
              <label style={modalStyles.label}>ID *</label>
              <input 
                type="text" 
                name="id" 
                value={formData.id} 
                onChange={handleChange} 
                disabled={validando || !!producto} 
                style={inputStyle(validando)} 
              />
            </div>
            <div style={{ flex: 1 }}>
              <label style={modalStyles.label}>Stock</label>
              <input 
                type="text" 
                name="stock" 
                value={formData.stock} 
                onChange={handleChange} 
                disabled={validando} 
                style={inputStyle(validando)} 
              />
            </div>
          </div>

          {/* Campo: Nombre [9] */}
          <div style={{ marginBottom: '15px' }}>
            <label style={modalStyles.label}>Nombre del Producto *</label>
            <input 
              type="text" 
              name="nombre" 
              value={formData.nombre} 
              onChange={handleChange} 
              disabled={validando} 
              style={inputStyle(validando)} 
            />
          </div>

          {/* Campo: Ruta de la Imagen [10] */}
          <div style={{ marginBottom: '15px' }}>
            <label style={modalStyles.label}>Ruta de la Imagen</label>
            <input 
              type="text" 
              name="imagen" 
              value={formData.imagen} 
              onChange={handleChange} 
              disabled={validando} 
              placeholder="/outputs/small/nombre_400.webp" 
              style={inputStyle(validando)} 
            />
          </div>

          {/* Campo: Visibilidad (Nuevo control basado en esquema v8) [1] */}
          <div style={{ marginBottom: '15px' }}>
            <label style={modalStyles.label}>Estado en CatÃ¡logo</label>
            <select
              name="visible"
              value={formData.visible.toString()}
              onChange={handleChange}
              disabled={validando}
              style={{ ...inputStyle(validando), cursor: 'pointer' }}
            >
              <option value="true">ğŸŸ¢ Visible (Disponible en Home)</option>
              <option value="false">âšª Oculto (Solo visible en Admin)</option>
            </select>
          </div>

          {/* Campo: Grupo [10] */}
          <div style={{ marginBottom: '20px' }}>
            <label style={modalStyles.label}>Grupo *</label>
            <select 
              name="grupo" 
              value={formData.grupo} 
              onChange={handleChange} 
              disabled={validando} 
              style={{ ...inputStyle(validando), cursor: 'pointer' }}
            >
              <option value="">Seleccionar grupo...</option>
              {grupos.map(grupo => (
[CONTENIDO SENSIBLE ELIMINADO EN: ModalProducto.jsx]
                  {grupo.nombre} {grupo.precio > 0 ? `(+$${grupo.precio.toFixed(2)})` : ''}
                </option>
              ))}
            </select>
          </div>

          <div style={modalStyles.footer}>
            <button 
              type="button" 
              onClick={onClose} 
              disabled={validando} 
              style={modalStyles.btnCancel}
            >
              Cancelar
            </button>
            <button 
              type="submit" 
              disabled={validando} 
              style={modalStyles.btnSave}
            >
              {validando ? 'âŒ› Grabando...' : producto ? 'ğŸ’¾ Guardar Cambios' : 'âœ… Grabar Producto'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

// Estilos basados en la estructura del proyecto [11, 12]
const modalStyles = {
  overlay: {
    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
    alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: '20px'
  },
  modal: {
    backgroundColor: 'white', borderRadius: '8px', width: '100%',
    maxWidth: '500px', maxHeight: '90vh', display: 'flex',
    flexDirection: 'column', boxShadow: '0 4px 20px rgba(0, 0, 0, 0.15)',
    overflowY: 'auto'
  },
  header: {
    display: 'flex', justifyContent: 'space-between', alignItems: 'center',
    padding: '20px', borderBottom: '1px solid #eee', backgroundColor: '#f8f9fa'
  },
  closeBtn: { background: 'none', border: 'none', fontSize: '24px', cursor: 'pointer', color: '#666' },
  label: { display: 'block', fontWeight: 'bold', marginBottom: '5px', fontSize: '14px', color: '#333' },
  errorBox: {
    backgroundColor: '#fee', color: '#c33', padding: '12px',
    borderRadius: '4px', marginBottom: '20px', fontSize: '14px', border: '1px solid #fcc'
  },
  footer: { display: 'flex', justifyContent: 'flex-end', gap: '10px', paddingTop: '10px', borderTop: '1px solid #eee', padding: '20px' },
  btnCancel: { padding: '10px 24px', backgroundColor: '#6c757d', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' },
  btnSave: { padding: '10px 24px', backgroundColor: '#28a745', color: 'white', border: 'none', borderRadius: '4px', fontWeight: 'bold', cursor: 'pointer' }
};

const inputStyle = (validando) => ({
  width: '100%', padding: '10px', border: '1px solid #ddd',
  borderRadius: '4px', fontSize: '14px', boxSizing: 'border-box',
  backgroundColor: validando ? '#f8f9fa' : 'white',
  color: '#333', cursor: validando ? 'not-allowed' : 'text'
});

export default ModalProducto;
************************************************************

FILE: src/components/ProductosCRUD/ProductosCRUD.jsx
------------------------------
// src/components/ProductosCRUD/ProductosCRUD.jsx
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database';
import ModalProducto from './ModalProducto';

const ProductosCRUD = () => {
  const [productos, setProductos] = useState([]);
  const [grupos, setGrupos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [modalOpen, setModalOpen] = useState(false);
  const [productoEditando, setProductoEditando] = useState(null);
  const [filtroGrupo, setFiltroGrupo] = useState('todos');

  // Cargar datos al montar el componente
  useEffect(() => {
    cargarDatos();
  }, []);

  const cargarDatos = async () => {
    try {
      setLoading(true);
      
      // Cargar productos y grupos en paralelo
      const [productosData, gruposData] = await Promise.all([
        db.getAll('productos'),
        db.getAll('grupos')
      ]);
      
      setProductos(productosData);
      setGrupos(gruposData);
    } catch (err) {
      setError('Error al cargar los datos: ' + err.message);
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  // Filtrar productos por grupo
  const productosFiltrados = filtroGrupo === 'todos' 
    ? productos 
    : productos.filter(p => p.grupo === filtroGrupo);

  const handleEditar = (producto) => {
    setProductoEditando(producto);
    setModalOpen(true);
  };

  const handleEliminar = async (producto) => {
    if (window.confirm(`Â¿EstÃ¡s seguro de eliminar el producto "${producto.nombre}"?`)) {
      try {
        await db.del('productos', producto.id);
        cargarDatos(); // Recargar la lista
      } catch (err) {
        setError('Error al eliminar: ' + err.message);
      }
    }
  };

  const handleNuevoProducto = () => {
    setProductoEditando(null);
    setModalOpen(true);
  };

  const handleGuardarExitoso = () => {
    cargarDatos(); // Recargar lista despuÃ©s de guardar
  };

  const getNombreGrupo = (grupoId) => {
    const grupo = grupos.find(g => g.nombre === grupoId);
    return grupo ? grupo.nombre : grupoId;
  };

  const getPrecioGrupo = (grupoId) => {
    const grupo = grupos.find(g => g.nombre === grupoId);
    return grupo ? grupo.precio : 0;
  };

  if (loading) {
    return <div style={styles.loading}>Cargando productos...</div>;
  }

  return (
    <div style={styles.container}>
      <h1 style={styles.title}>AdministraciÃ³n de Productos</h1>
      
      {error && (
        <div style={styles.errorAlert}>
          {error}
        </div>
      )}

      {/* Controles */}
      <div style={styles.controles}>
        <div style={styles.filtros}>
          <div style={styles.filtroGrupo}>
            <label htmlFor="filtro-grupo" style={styles.filtroLabel}>
              Filtrar por grupo:
            </label>
            <select
              id="filtro-grupo"
              value={filtroGrupo}
              onChange={(e) => setFiltroGrupo(e.target.value)}
              style={styles.select}
            >
              <option value="todos">Todos los grupos</option>
              {grupos.map(grupo => (
[CONTENIDO SENSIBLE ELIMINADO EN: ProductosCRUD.jsx]
                  {grupo.nombre}
                </option>
              ))}
            </select>
          </div>
        </div>

        <button 
          onClick={handleNuevoProducto}
          style={styles.nuevoButton}
        >
          + Nuevo Producto
        </button>
      </div>

      {/* Lista de productos */}
      <div style={styles.lista}>
        {productosFiltrados.length === 0 ? (
          <div style={styles.vacio}>
            {filtroGrupo === 'todos' 
              ? 'No hay productos registrados. Â¡Crea el primero!' 
              : `No hay productos en el grupo "${filtroGrupo}"`}
          </div>
        ) : (
          productosFiltrados.map(producto => (
[CONTENIDO SENSIBLE ELIMINADO EN: ProductosCRUD.jsx]
              <div style={styles.itemImagen}>
                {producto.imagen ? (
                  <img 
                    src={producto.imagen} 
                    alt={producto.nombre}
                    style={styles.imagen}
                    onError={(e) => e.target.style.display = 'none'}
                  />
                ) : (
                  <div style={styles.imagenPlaceholder}>
                    ğŸ“·
                  </div>
                )}
              </div>

              <div style={styles.itemInfo}>
                <div style={styles.itemNombre}>{producto.nombre}</div>
                
                <div style={styles.itemDetalles}>
                  <div style={styles.detalle}>
                    <span style={styles.detalleLabel}>Grupo:</span>
                    <span style={styles.detalleValor}>
                      {getNombreGrupo(producto.grupo)}
                      {getPrecioGrupo(producto.grupo) > 0 && 
                        ` (+$${getPrecioGrupo(producto.grupo).toFixed(2)})`}
                    </span>
                  </div>
                  
                  <div style={styles.detalle}>
                    <span style={styles.detalleLabel}>Stock:</span>
                    <span style={{
                      ...styles.detalleValor,
                      color: producto.stock > 0 ? '#2e7d32' : '#c62828',
                      fontWeight: 'bold'
                    }}>
                      {producto.stock} unidad{producto.stock !== 1 ? 'es' : ''}
                    </span>
                  </div>
                  
                  <div style={styles.detalle}>
                    <span style={styles.detalleLabel}>ID:</span>
                    <span style={styles.detalleValor}>{producto.id}</span>
                  </div>
                  
                  {producto.createdAt && (
                    <div style={styles.detalle}>
                      <span style={styles.detalleLabel}>Creado:</span>
                      <span style={styles.detalleValor}>
                        {new Date(producto.createdAt).toLocaleDateString()}
                      </span>
                    </div>
                  )}
                </div>
              </div>

              <div style={styles.itemActions}>
                <button
                  onClick={() => handleEditar(producto)}
                  style={styles.btnEditar}
                >
                  Editar
                </button>
                <button
                  onClick={() => handleEliminar(producto)}
                  style={styles.btnEliminar}
                >
                  Eliminar
                </button>
              </div>
            </div>
          ))
        )}
      </div>

      {/* Resumen */}
      <div style={styles.resumen}>
        <div>
          Mostrando: <strong>{productosFiltrados.length}</strong> de <strong>{productos.length}</strong> productos
          {filtroGrupo !== 'todos' && ` (filtrado por: ${filtroGrupo})`}
        </div>
        <div style={styles.stockTotal}>
          Stock total: <strong>{productos.reduce((sum, p) => sum + p.stock, 0)}</strong> unidades
        </div>
      </div>

      {/* Modal */}
      {modalOpen && (
        <ModalProducto
          producto={productoEditando}
          grupos={grupos}
          onClose={() => setModalOpen(false)}
          onSave={handleGuardarExitoso}
        />
      )}
    </div>
  );
};

const styles = {
  container: { 
    padding: '20px', 
    maxWidth: '1000px', 
    margin: '0 auto',
    minHeight: '100vh',
    fontFamily: 'system-ui, -apple-system, sans-serif'
  },
  title: { 
    marginBottom: '20px', 
    color: '#1a1a1a',
    fontSize: '26px',
    fontWeight: '700'
  },
  loading: { 
    padding: '40px', 
    textAlign: 'center',
    fontSize: '18px',
    color: '#666'
  },
  errorAlert: { 
    backgroundColor: '#fff5f5', 
    color: '#c53030', 
    padding: '12px 16px', 
    borderRadius: '6px',
    marginBottom: '20px',
    border: '1px solid #feb2b2',
    display: 'flex',
    alignItems: 'center',
    gap: '10px'
  },
  controles: {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'flex-end',
    marginBottom: '25px',
    flexWrap: 'wrap',
    gap: '15px',
    backgroundColor: '#fff',
    padding: '15px',
    borderRadius: '8px',
    boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
  },
  filtros: {
    flex: 1
  },
  filtroGrupo: {
    display: 'flex',
    flexDirection: 'column',
    gap: '8px'
  },
  filtroLabel: {
    fontSize: '13px',
    color: '#666',
    fontWeight: '600',
    textTransform: 'uppercase',
    letterSpacing: '0.5px'
  },
  select: {
    padding: '10px 12px',
    border: '1px solid #e2e8f0',
    borderRadius: '6px',
    fontSize: '14px',
    maxWidth: '240px',
    backgroundColor: '#f8fafc',
    cursor: 'pointer',
    outline: 'none',
    transition: 'border-color 0.2s'
  },
  nuevoButton: {
    padding: '11px 22px',
    backgroundColor: '#2563eb', // Azul moderno
    color: 'white',
    border: 'none',
    borderRadius: '6px',
    cursor: 'pointer',
    fontSize: '14px',
    fontWeight: '600',
    whiteSpace: 'nowrap',
    transition: 'background 0.2s',
    boxShadow: '0 2px 4px rgba(37, 99, 235, 0.2)'
  },
  lista: { 
    border: '1px solid #e2e8f0',
    borderRadius: '10px',
    overflow: 'hidden',
    marginBottom: '20px',
    backgroundColor: 'white',
    boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)'
  },
  vacio: { 
    padding: '60px 20px', 
    textAlign: 'center', 
    color: '#94a3b8',
    fontSize: '16px'
  },
  item: {
    display: 'flex',
    alignItems: 'center',
    padding: '16px 20px',
    borderBottom: '1px solid #f1f5f9',
    backgroundColor: 'white',
    gap: '20px',
    transition: 'background 0.2s'
  },
  itemImagen: {
    width: '64px',
    height: '64px',
    flexShrink: 0,
    position: 'relative' // Para indicadores sobre la imagen
  },
  imagen: {
    width: '100%',
    height: '100%',
    objectFit: 'cover',
    borderRadius: '8px',
    border: '1px solid #e2e8f0'
  },
  imagenPlaceholder: {
    width: '100%',
    height: '100%',
    backgroundColor: '#f1f5f9',
    borderRadius: '8px',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    fontSize: '24px',
    color: '#94a3b8',
    border: '1px dashed #cbd5e1'
  },
  itemInfo: {
    flex: 1,
    minWidth: 0
  },
  itemHeader: {
    display: 'flex',
    alignItems: 'center',
    gap: '10px',
    marginBottom: '6px'
  },
  itemNombre: { 
    fontWeight: '600', 
    fontSize: '16px', 
    color: '#1e293b'
  },
  badgeVisible: {
    fontSize: '10px',
    padding: '2px 8px',
    borderRadius: '12px',
    fontWeight: '700',
    textTransform: 'uppercase'
  },
  visibleTrue: { backgroundColor: '#dcfce7', color: '#15803d' },
  visibleFalse: { backgroundColor: '#fee2e2', color: '#b91c1c' },

  itemDetalles: {
    display: 'flex',
    gap: '20px',
    fontSize: '13px'
  },
  detalle: {
    display: 'flex',
    gap: '5px'
  },
  detalleLabel: {
    color: '#64748b',
    fontWeight: '400'
  },
  detalleValor: {
    color: '#334155',
    fontWeight: '600'
  },
  itemActions: { 
    display: 'flex', 
    gap: '8px',
    flexShrink: 0
  },
  btnEditar: {
    padding: '8px 14px',
    backgroundColor: '#f1f5f9',
    color: '#475569',
    border: '1px solid #e2e8f0',
    borderRadius: '6px',
    cursor: 'pointer',
    fontSize: '13px',
    fontWeight: '600',
    transition: 'all 0.2s'
  },
  btnEliminar: {
    padding: '8px 14px',
    backgroundColor: '#fff',
    color: '#ef4444',
    border: '1px solid #fee2e2',
    borderRadius: '6px',
    cursor: 'pointer',
    fontSize: '13px',
    fontWeight: '600',
    transition: 'all 0.2s'
  },
  resumen: {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center',
    padding: '20px',
    backgroundColor: '#f8fafc',
    borderRadius: '10px',
    fontSize: '14px',
    color: '#475569',
    border: '1px solid #e2e8f0'
  },
  stockTotal: {
    fontWeight: '700',
    color: '#2563eb',
    fontSize: '16px'
  },
};

export default ProductosCRUD;
************************************************************

FILE: src/components/RegistroGasto.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { db } from '../lib/db/database';
import { getTasaBCV } from '../lib/db/utils/tasaUtil';
import styles from './RegistroGasto.module.css';

// Componente para el registro de gastos y retiros con interfaz premium refinada
const RegistroGasto = ({ onClose }) => {
  const navigate = useNavigate();
  const getLocalToday = () => new Date().toLocaleDateString('en-CA');

  const [gastos, setGastos] = useState([]);
  const [showForm, setShowForm] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [showDeleteConfirm, setShowDeleteConfirm] = useState(null);

  const [gasto, setGasto] = useState({
    descripcion: '',
    montoUsd: '',
    montoBs: '',
    categoria: 'Operativo',
    fecha: getLocalToday(),
    metodoPago: 'Efectivo',
    tasa: 0
  });

  const [tasaActual, setTasaActual] = useState(0);

  const fetchGastos = async () => {
    try {
      const allGastos = await db.gastos.orderBy('fecha').reverse().toArray();
      setGastos(allGastos);
    } catch (error) {
      console.error("Error fetching gastos:", error);
    }
  };

  useEffect(() => {
    const cargarDatos = async () => {
      const tasa = await getTasaBCV();
      setTasaActual(tasa || 1); // Evitar divisiÃ³n por cero
      setGasto(prev => ({ ...prev, tasa: tasa || 1 }));
      await fetchGastos();
    };
    cargarDatos();
  }, []);

  const resetForm = () => {
    setGasto({
      descripcion: '',
      montoUsd: '',
      montoBs: '',
      categoria: 'Operativo',
      fecha: getLocalToday(),
      metodoPago: 'Efectivo',
      tasa: tasaActual
    });
    setEditingId(null);
    setShowForm(false);
  };

  const handleMontoBsChange = (e) => {
    const bsValue = e.target.value;
    const usdCalc = bsValue && tasaActual > 0 ? (parseFloat(bsValue) / tasaActual).toFixed(2) : '';
    setGasto({ ...gasto, montoBs: bsValue, montoUsd: usdCalc });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!gasto.descripcion || !gasto.montoBs) return;

    const montoBsNum = parseFloat(gasto.montoBs);
    const montoUsdNum = parseFloat(gasto.montoUsd);

    const gastoData = {
      ...gasto,
      montoBs: montoBsNum,
      montoUsd: montoUsdNum,
      fecha: new Date(gasto.fecha).toISOString()
    };

    try {
      if (editingId) {
        await db.gastos.put({ ...gastoData, id: editingId });
        alert('âœ… Gasto actualizado con Ã©xito');
      } else {
        await db.gastos.add(gastoData);
        alert('âœ… Gasto registrado con Ã©xito');
      }
      await fetchGastos();
      resetForm();
    } catch (error) {
      console.error("Error saving gasto:", error);
      alert('âŒ Error al guardar el gasto');
    }
  };

  const handleEdit = (item) => {
    setGasto({
      ...item,
      fecha: item.fecha.split('T')[0], // Ajustar fecha para input type="date"
      montoUsd: item.montoUsd.toString(),
      montoBs: item.montoBs.toString()
    });
    setEditingId(item.id);
    setShowForm(true);
  };

  const handleDeleteClick = (id) => {
    setShowDeleteConfirm(id);
  };

  const confirmDelete = async () => {
    if (showDeleteConfirm) {
      await db.gastos.delete(showDeleteConfirm);
      await fetchGastos();
      setShowDeleteConfirm(null);
    }
  };

  return (
    <div className={styles.container}>
      {/* Header Fijo */}
      <div className={styles.mainHeader}>
        <span className={styles.mainTitle}>ğŸ’¸ Registro de Gastos</span>
        <button className={styles.closeMainButton} onClick={() => onClose ? onClose() : navigate(-1)}>Ã—</button>
      </div>

      {/* Lista de Gastos */}
      <div className={styles.listContainer}>
        {gastos.length === 0 ? (
          <div className={styles.emptyState}>No hay gastos registrados.</div>
        ) : (
          gastos.map((item) => (
[CONTENIDO SENSIBLE ELIMINADO EN: RegistroGasto.jsx]
              <div className={styles.expenseInfo}>
                <span className={styles.expenseDesc}>{item.descripcion}</span>
                <span className={styles.expenseMeta}>
                  {new Date(item.fecha).toLocaleDateString()} â€¢ {item.categoria}
                </span>
              </div>
              <div className={styles.expenseActions}>
                <div className={styles.expenseAmount}>
                  ${item.montoUsd?.toFixed(2)}
                  <span className={styles.amountBs}>Bs. {item.montoBs?.toFixed(2)}</span>
                </div>
                <div className={styles.actionButtons}>
                  <button onClick={() => handleEdit(item)} className={styles.btnIconEdit}>âœï¸</button>
                  <button onClick={() => handleDeleteClick(item.id)} className={styles.btnIconDelete}>ğŸ—‘ï¸</button>
                </div>
              </div>
            </div>
          ))
        )}
      </div>

      {/* FAB Button */}
      <button className={styles.fab} onClick={() => { resetForm(); setShowForm(true); }}>
        +
      </button>

      {/* Modal Formulario */}
      {showForm && (
        <div className={styles.overlay}>
          <div className={styles.modal}>
            <div className={styles.header}>
              <span className={styles.title}>{editingId ? 'EDITAR GASTO' : 'NUEVO GASTO'}</span>
              <button className={styles.closeButton} onClick={resetForm}>Ã—</button>
            </div>

            <form onSubmit={handleSubmit} className={styles.content}>
              <div className={styles.inputRow}>
                <div className={styles.inputGroup}>
                  <label className={styles.label}>Fecha</label>
                  <input
                    type="date"
                    className={styles.inputField}
                    value={gasto.fecha}
                    onChange={(e) => setGasto({ ...gasto, fecha: e.target.value })}
                    required
                  />
                </div>
                <div className={styles.inputGroup}>
                  <label className={styles.label}>Tasa BCV</label>
                  <div className={styles.tasaHighlight}>
                    Bs. {tasaActual.toFixed(2)}
                  </div>
                </div>
              </div>

              <div className={styles.inputGroup}>
                <label className={styles.label}>DescripciÃ³n</label>
                <input
                  type="text"
                  placeholder="Ej: Pago de transporte, Almuerzo..."
                  className={styles.inputField}
                  value={gasto.descripcion}
                  onChange={(e) => setGasto({ ...gasto, descripcion: e.target.value })}
                  required
                />
              </div>

              <div className={styles.inputRow}>
                <div className={styles.inputGroup}>
                  <label className={styles.label}>Monto (Bs.)</label>
                  <input
                    type="number"
                    step="0.01"
                    placeholder="0.00"
                    className={styles.inputField}
                    value={gasto.montoBs}
                    onChange={handleMontoBsChange}
                    required
                  />
                </div>
                <div className={styles.inputGroup}>
                  <label className={styles.label}>Monto ($)</label>
                  <div className={styles.montoBsDisplay} style={{ color: '#007bff', backgroundColor: '#e1f5fe', border: '1px solid #b3e5fc' }}>
                    ${parseFloat(gasto.montoUsd || 0).toFixed(2)}
                  </div>
                </div>
              </div>

              <div className={styles.inputRow}>
                <div className={styles.inputGroup}>
                  <label className={styles.label}>CategorÃ­a</label>
                  <select
                    className={styles.selectField}
                    value={gasto.categoria}
                    onChange={(e) => setGasto({ ...gasto, categoria: e.target.value })}
                  >
                    <option value="Operativo">ğŸ¢ Operativo</option>
                    <option value="Personal">ğŸ‘¤ Personal</option>
                    <option value="InversiÃ³n">ğŸ“ˆ InversiÃ³n</option>
                    <option value="Otros">â“ Otros</option>
                  </select>
                </div>
                <div className={styles.inputGroup}>
                  <label className={styles.label}>MÃ©todo</label>
                  <select
                    className={styles.selectField}
                    value={gasto.metodoPago}
                    onChange={(e) => setGasto({ ...gasto, metodoPago: e.target.value })}
                  >
                    <option value="Efectivo">ğŸ’µ Efectivo</option>
                    <option value="Transferencia">ğŸ¦ Transf.</option>
                    <option value="Pago MÃ³vil">ğŸ“± Pago MÃ³vil</option>
                    <option value="Zelle">ğŸ’³ Zelle</option>
                  </select>
                </div>
              </div>

              <div className={styles.footer}>
                <button type="button" className={styles.btnCancelar} onClick={resetForm}>Cancelar</button>
                <button type="submit" className={styles.btnGuardar}>Guardar</button>
              </div>
            </form>
          </div>
        </div>
      )}

      {/* Modal Confirmacion Eliminar */}
      {showDeleteConfirm && (
        <div className={styles.overlay} style={{ zIndex: 12000 }}>
          <div className={styles.confirmModal}>
            <h3>Â¿Eliminar gasto?</h3>
            <p>Esta acciÃ³n no se puede deshacer.</p>
            <div className={styles.confirmActions}>
              <button className={styles.btnCancelar} onClick={() => setShowDeleteConfirm(null)}>Cancelar</button>
              <button className={styles.btnEliminar} onClick={confirmDelete}>Eliminar</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default RegistroGasto;
************************************************************

FILE: src/components/RegistroGasto.module.css
------------------------------
/* RegistroGasto.module.css - Refined UI */

.container {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #f4f6f9;
  z-index: 10000;
  display: flex;
  flex-direction: column;
}

.mainHeader {
  background-color: #ffffff;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  z-index: 10;
}

.mainTitle {
  font-size: 20px;
  font-weight: 800;
  color: #2c3e50;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.closeMainButton {
  background: none;
  border: none;
  font-size: 32px;
  cursor: pointer;
  color: #7f8c8d;
  line-height: 1;
}

/* List Styles */
.listContainer {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.emptyState {
  text-align: center;
  color: #bdc3c7;
  font-size: 16px;
  margin-top: 40px;
  font-weight: 500;
}

.expenseItem {
  background-color: #ffffff;
  border-radius: 12px;
  padding: 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
  transition: transform 0.2s, box-shadow 0.2s;
  border-left: 4px solid #3498db;
  /* Default accent */
}

/* Categorize colors if possible, else generic blue */
.expenseItem:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.expenseInfo {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.expenseDesc {
  font-weight: 700;
  font-size: 15px;
  color: #2c3e50;
}

.expenseMeta {
  font-size: 12px;
  color: #95a5a6;
  text-transform: uppercase;
  font-weight: 600;
}

.expenseActions {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
}

.expenseAmount {
  font-size: 16px;
  font-weight: 800;
  color: #e74c3c;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

.amountBs {
  font-size: 11px;
  color: #95a5a6;
  font-weight: 600;
}

.actionButtons {
  display: flex;
  gap: 10px;
}

.btnIconEdit,
.btnIconDelete {
  background: none;
  border: none;
  font-size: 16px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  padding: 0;
}

.btnIconEdit:hover,
.btnIconDelete:hover {
  opacity: 1;
}

/* FAB */
.fab {
  position: absolute;
  bottom: 25px;
  right: 25px;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background-color: #2ecc71;
  color: white;
  border: none;
  font-size: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  /* Ensure no padding affects dimensions */
  line-height: 1;
  /* Normalize line height */
  box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
  cursor: pointer;
  transition: transform 0.2s;
  z-index: 100;
}

.fab:hover {
  transform: scale(1.05);
  background-color: #27ae60;
}

/* Modal Overlay & Form (Reusing updated styles) */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 11000;
  backdrop-filter: blur(2px);
  animation: fadeIn 0.2s ease-out;
}

[CONTENIDO SENSIBLE ELIMINADO EN: RegistroGasto.module.css]
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

.modal {
  background-color: #ffffff;
  width: 95%;
  max-width: 480px;
  padding: 25px;
  border-radius: 16px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
  animation: slideUp 0.3s ease-out;
}

[CONTENIDO SENSIBLE ELIMINADO EN: RegistroGasto.module.css]
  from {
    transform: translateY(20px);
    opacity: 0;
  }

  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid #f1f2f6;
  margin-bottom: 20px;
  padding-bottom: 15px;
}

.title {
  font-size: 18px;
  font-weight: 800;
  color: #2c3e50;
  text-transform: uppercase;
}

.closeButton {
  background: none;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: #95a5a6;
  transition: color 0.2s;
}

.closeButton:hover {
  color: #e74c3c;
}

.content {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.inputRow {
  display: flex;
  gap: 15px;
}

.inputGroup {
  display: flex;
  flex-direction: column;
  gap: 6px;
  flex: 1;
}

.label {
  font-size: 12px;
  font-weight: 700;
  color: #7f8c8d;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.inputField,
.selectField {
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #dfe6e9;
  background-color: #fdfdfd;
  font-size: 15px;
  width: 100%;
  box-sizing: border-box;
  color: #2d3436;
  transition: border-color 0.2s;
}

.inputField:focus,
.selectField:focus {
  outline: none;
  border-color: #3498db;
  background-color: #fff;
}

.tasaHighlight {
  background-color: #ecf0f1;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #bdc3c7;
  font-size: 15px;
  color: #2c3e50;
  font-weight: 600;
  text-align: center;
}

.montoBsDisplay {
  font-size: 18px;
  font-weight: 800;
  color: #2980b9;
  text-align: center;
  padding: 10px;
  background-color: #ebf5fb;
  border-radius: 8px;
  border: 1px solid #d6eaf8;
}

.footer {
  display: flex;
  gap: 15px;
  margin-top: 25px;
}

.btnGuardar,
.btnCancelar,
.btnEliminar {
  padding: 14px;
  border: none;
  border-radius: 8px;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  text-transform: uppercase;
  transition: background-color 0.2s, transform 0.1s;
}

.btnGuardar {
  flex: 2;
  background-color: #2ecc71;
  color: white;
}

.btnGuardar:hover {
  background-color: #27ae60;
  transform: scale(1.02);
}

.btnCancelar {
  flex: 1;
  background-color: #ecf0f1;
  color: #7f8c8d;
}

.btnCancelar:hover {
  background-color: #bdc3c7;
  color: white;
}

.btnEliminar {
  background-color: #e74c3c;
  color: white;
  flex: 1;
}

.btnEliminar:hover {
  background-color: #c0392b;
}

/* Confirm Modal Specifics */
.confirmModal {
  background-color: white;
  padding: 30px;
  border-radius: 12px;
  text-align: center;
  width: 85%;
  max-width: 320px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

[CONTENIDO SENSIBLE ELIMINADO EN: RegistroGasto.module.css]
  from {
    transform: scale(0.8);
    opacity: 0;
  }

  to {
    transform: scale(1);
    opacity: 1;
  }
}

.confirmModal h3 {
  margin: 0 0 10px 0;
  color: #2c3e50;
}

.confirmModal p {
  color: #7f8c8d;
  margin-bottom: 25px;
}

.confirmActions {
  display: flex;
  gap: 15px;
}
************************************************************

FILE: src/components/ResumenInventario.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../lib/db/database';
import styles from './ResumenInventario.module.css';

const ResumenInventario = () => {
    const [metricas, setMetricas] = useState({
        totalCosto: 0,
        totalVenta: 0,
        ganancia: 0,
        gananciaBs: 0,
        productosHuerfanos: 0,
        productosOcultos: 0,
        advertencias: []
    });

    const [tasa, setTasa] = useState(0);
    const [fechaTasa, setFechaTasa] = useState('');

    useEffect(() => {
        const cargarDatosYCalcular = async () => {
            try {
                // 1. Obtener datos base de productos y grupos
                const todosProductos = await db.productos.toArray();
                const grupos = await db.grupos.toArray();

                // OPCIÃ“N B: Filtrar solo productos visibles (inventario vendible)
                const productosOcultos = todosProductos.filter(p => p.visible === false).length;
                const productos = todosProductos.filter(p => p.visible !== false);

                // Obtener tasa y fecha del histÃ³rico
                const ultimaEntrada = await db.historico_tasas.orderBy('fecha_tasa').last();
                const valorTasa = ultimaEntrada ? ultimaEntrada.tasa : await db.getUltimaTasaBCV();
                const fecha = ultimaEntrada ? ultimaEntrada.fecha_tasa : 'Config';

                setTasa(valorTasa);
                setFechaTasa(fecha);

                // 2. Mapeo de grupos para acceso rÃ¡pido a costos y precios
                const gruposMap = grupos.reduce((acc, g) => {
                    acc[g.nombre] = {
                        costo: parseFloat(g.costo_$) || 0,
                        precio: parseFloat(g.precio) || 0
                    };
                    return acc;
                }, {});

                // 3. Arrays para validaciones
                const advertencias = [];
                let productosHuerfanos = 0;

                // 4. CÃ¡lculo de totales basado en el stock actual de cada producto
                const totales = productos.reduce((acc, p) => {
                    const info = gruposMap[p.grupo];
                    if (info) {
                        acc.totalCosto += (p.stock || 0) * info.costo;
                        acc.totalVenta += (p.stock || 0) * info.precio;
                    } else if (p.stock > 0) {
                        // Producto con stock pero sin grupo vÃ¡lido
                        productosHuerfanos++;
                        console.warn(`âš ï¸ Producto huÃ©rfano: ${p.id} - ${p.nombre} (Grupo: ${p.grupo}, Stock: ${p.stock})`);
                        advertencias.push(`${p.nombre} (Stock: ${p.stock}) no tiene grupo vÃ¡lido`);
                    }
                    return acc;
                }, { totalCosto: 0, totalVenta: 0 });

                // 5. Validar grupos con margen negativo
                grupos.forEach(g => {
                    if (g.costo_$ > g.precio) {
                        advertencias.push(`Grupo "${g.nombre}" tiene margen negativo (Costo: $${g.costo_$}, Precio: $${g.precio})`);
                    }
                });

                const gananciaUsd = totales.totalVenta - totales.totalCosto;

                setMetricas({
                    ...totales,
                    ganancia: gananciaUsd,
                    gananciaBs: gananciaUsd * valorTasa,
                    productosHuerfanos,
                    productosOcultos,
                    advertencias
                });
            } catch (error) {
                console.error("Error al calcular resumen de inventario:", error);
            }
        };

        cargarDatosYCalcular();
    }, []);

    return (
        <div className={styles.container}>
            <h2 className={styles.titulo}>AnÃ¡lisis de Inventario Actual</h2>

            {/* Advertencias de calidad de datos */}
            {metricas.advertencias.length > 0 && (
                <div className={styles.advertencias}>
                    <strong>âš ï¸ Advertencias de Datos:</strong>
                    <ul>
                        {metricas.advertencias.slice(0, 3).map((adv, idx) => (
[CONTENIDO SENSIBLE ELIMINADO EN: ResumenInventario.jsx]
                        ))}
                        {metricas.advertencias.length > 3 && (
                            <li>... y {metricas.advertencias.length - 3} mÃ¡s</li>
                        )}
                    </ul>
                </div>
            )}

            {/* InformaciÃ³n sobre productos excluidos */}
            {metricas.productosOcultos > 0 && (
                <div className={styles.infoBox}>
                    â„¹ï¸ Se excluyeron {metricas.productosOcultos} producto(s) oculto(s) del anÃ¡lisis (solo inventario vendible)
                </div>
            )}

            <div className={styles.grid}>
                <div className={styles.card}>
                    <label>InversiÃ³n (Costo $)</label>
                    <span className={styles.valorCosto}>${metricas.totalCosto.toFixed(2)}</span>
                    {metricas.productosHuerfanos > 0 && (
                        <small className={styles.warning}>
                            âš ï¸ {metricas.productosHuerfanos} producto(s) sin grupo
                        </small>
                    )}
                </div>

                <div className={styles.card}>
                    <label>Venta Estimada ($)</label>
                    <span className={styles.valorVenta}>${metricas.totalVenta.toFixed(2)}</span>
                </div>

                <div className={styles.card}>
                    <label>Ganancia Potencial ($)</label>
                    <span className={styles.valorGanancia}>${metricas.ganancia.toFixed(2)}</span>
                </div>

                {/* CORRECCIÃ“N: Error tipogrÃ¡fico en className */}
                <div className={`${styles.card} ${styles.highlightBs}`}>
                    <label>Ganancia Potencial (Bs)</label>
                    <span className={styles.valorBs}>
                        Bs. {metricas.gananciaBs.toLocaleString('es-VE', {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        })}
                    </span>
                    <span className={styles.tasaInfo}>
                        Tasa: {tasa.toFixed(2)} ({fechaTasa})
                    </span>
                </div>
            </div>
        </div>
    );
};

export default ResumenInventario;
************************************************************

FILE: src/components/ResumenInventario.module.css
------------------------------
.container {
  padding: 20px;
}

.grid {
  display: grid;
  grid-template-columns: 1fr;
  /* Una columna en mÃ³vil */
  gap: 15px;
}

.card {
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
}

.valorCosto {
  color: #e74c3c;
  font-size: 1.5rem;
  font-weight: bold;
}

.valorVenta {
  color: #3498db;
  font-size: 1.5rem;
  font-weight: bold;
}

.valorGanancia {
  color: #2ecc71;
  font-size: 1.8rem;
  font-weight: bold;
}

label {
  color: black;
}

.highlightBs {
  background-color: #f8f9fa;
  border-left: 5px solid #ff9800;
  /* Color naranja para resaltar moneda local */
}

.valorBs {
  color: #ff9800;
  font-size: 1.8rem;
  font-weight: 800;
}

.tasaInfo {
  margin-top: 5px;
  color: #6c757d;
  font-style: italic;
  font-size: 0.8rem;
}

.sidebar {
  position: fixed;
  /* Crucial para que no se mueva al hacer scroll */
  top: 0;
  left: 0;
  height: 100vh;
  width: 280px;
  /* O el ancho que prefieras */
  background-color: #ffffff;

  /* ElevaciÃ³n mÃ¡xima */
  z-index: 9999;

  /* Sombra para dar profundidad y separar visualmente del fondo */
  box-shadow: 4px 0 10px rgba(0, 0, 0, 0.3);

  transition: transform 0.3s ease-in-out;
}

/* Advertencias de calidad de datos */
.advertencias {
  background-color: #fff3cd;
  border: 1px solid #ffc107;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
  color: #856404;
}

.advertencias ul {
  margin: 10px 0 0 20px;
  padding: 0;
}

.advertencias li {
  margin: 5px 0;
  font-size: 14px;
}

/* Info box para productos excluidos */
.infoBox {
  background-color: #d1ecf1;
  border: 1px solid #bee5eb;
  border-radius: 8px;
  padding: 12px 15px;
  margin-bottom: 20px;
  color: #0c5460;
  font-size: 14px;
}

/* Warning badge para productos huÃ©rfanos */
.warning {
  display: block;
  color: #ff6b6b;
  font-size: 12px;
  margin-top: 8px;
  font-weight: 500;
}

.titulo {
  color: #fff;
  margin-bottom: 20px;
}
************************************************************

FILE: src/components/Sidebar.jsx
------------------------------
import React from 'react';
import { Link, useNavigate } from "react-router-dom";

export default function Sidebar({ isOpen, onClose }) {
    const navigate = useNavigate();

    const handleAdminAccess = (e) => {
        e.preventDefault();
        const pin = window.prompt("Ingrese el PIN de acceso:");
        if (pin === "aaaaa") {
            navigate("/Panel");
            onClose();
        } else {
            alert("Acceso denegado: PIN incorrecto.");
        }
    };

    // FunciÃ³n para manejar hover
    const handleMouseEnter = (e) => {
        e.target.style.backgroundColor = '#f0f8ff';
    };

    const handleMouseLeave = (e) => {
        e.target.style.backgroundColor = 'transparent';
    };

    // Estilos definidos como objeto
    const styles = {
        sidebar: {
            position: 'fixed',
            top: 0,
            left: 0,
            height: '100vh',
            width: '250px',
            backgroundColor: '#ffffff',
            boxShadow: '2px 0 10px rgba(0,0,0,0.2)',
            zIndex: 9999,
            transition: 'transform 0.3s ease-in-out',
            display: 'flex',
            flexDirection: 'column',
            // Asegura que el sidebar no se mueva si el contenido es largo
            overflow: 'hidden'
        },
        overlay: {
            position: 'fixed',
            top: 0,
            left: 0,
            width: '100vw',
            height: '100vh',
            backgroundColor: 'rgba(0,0,0,0.5)',
            // Subimos el zIndex para que bloquee botones o modales de la UI principal
            zIndex: 9998,
            backdropFilter: 'blur(2px)', // Toque estÃ©tico moderno
        },
        header: {
            padding: '20px',
            borderBottom: '1px solid #eee',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            backgroundColor: '#00BFFF',
            // El header se queda fijo arriba
            flexShrink: 0,

        },
        nav: {
            display: 'flex',
            flexDirection: 'column',
            padding: '10px',
            // ESTO HACE QUE LA LISTA SEA DESPLAZABLE
            overflowY: 'auto',
            flexGrow: 1,
            minHeight: 0, // Importante para que flex-grow funcione con overflow
            WebkitOverflowScrolling: 'touch', // Scroll suave en mÃ³viles
        },
        // ... tus otros estilos (title, closeBtn, icon se mantienen igual)
        link: {
            padding: '15px',
            textDecoration: 'none',
            color: '#333',
            fontSize: '1.1rem',
            borderBottom: '1px solid #f5f5f5',
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            gap: '10px',
            transition: 'background-color 0.2s',
            // Evita que el texto se rompa en varias lÃ­neas si es largo
            whiteSpace: 'nowrap',
        },
        separator: {
            border: 'none',
            borderTop: '1px solid lightgray',
            margin: '0px 10px',
            flexShrink: 0,
            opacity: 1,
            display: 'block',
        },
    };

    return (
        <>
            {/* Overlay para cerrar al tocar fuera */}
            {isOpen && (
                <div onClick={onClose} style={styles.overlay} />
            )}

            {/* Contenedor del MenÃº Lateral */}
            <div style={{
                ...styles.sidebar,
                transform: isOpen ? 'translateX(0)' : 'translateX(-100%)'
            }}>
                <div style={styles.header}>
                    <h3 style={styles.title}>Natura Menu</h3>
                    <button onClick={onClose} style={styles.closeBtn}>Ã—</button>
                </div>

                <nav style={styles.nav}>
                    {/* OpciÃ³n Inicio */}
                    <Link
                        to="/"
                        onClick={onClose}
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>ğŸ </span>
                        <span>Inicio</span>
                    </Link>

                    {/* OpciÃ³n Pedidos */}
                    <Link
                        to="/pedidos"
                        onClick={onClose}
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>ğŸ“‹</span>
                        <span>Pedidos</span>
                    </Link>

                    <Link
                        to="/registrogasto"
                        onClick={onClose}
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>ğŸ’¸</span>
                        <span>Registrar Gastos</span>
                    </Link>

                    {/* Separador visual horizontal */}
                    <hr style={styles.separator} />

                    <Link to="/estadisticas" onClick={onClose} style={styles.link}>
                        <span style={styles.icon}>ğŸ“Š</span> EstadÃ­sticas
                    </Link>

                    <Link to="/resumeninventario" onClick={onClose} style={styles.link}>
                        <span style={styles.icon}>ğŸ“Š</span> Resumen de Inventario
                    </Link>

                    {/* Segundo separador visual */}
                    <hr style={styles.separator} />

                    {/* OpciÃ³n Tasa BCV */}
                    <Link
                        to="/tasabcv"
                        onClick={onClose}
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>ğŸ’°</span>
                        <span>Tasa BCV</span>
                    </Link>

                    {/* OpciÃ³n Tasa Delivery */}
                    <Link
                        to="/delivery"
                        onClick={onClose}
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>ğŸšš</span>
                        <span>Tasa Delivery</span>
                    </Link>

                    {/* Tercer separador visual */}
                    <hr style={styles.separator} />

                    {/* Grupos */}
                    <Link to="/admingrupos" onClick={onClose} style={styles.link}>
                        <span style={styles.icon}>ğŸ“Š</span> Grupos de Producto
                    </Link>

                    {/* Productos */}
                    <Link to="/adminproductos" onClick={onClose} style={styles.link}>
                        <span style={styles.icon}>ğŸ¦</span> Productos
                    </Link>

                    {/* Acceso Administrativo */}
                    <a
                        onClick={handleAdminAccess}
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>ğŸ›¡ï¸</span>
                        <span>Panel de Control</span>
                    </a>

                    {/* FreezerGrid */}
                    <Link to="/freezergrid" onClick={onClose} style={styles.link}>
                        <span style={styles.icon}>ğŸ§Š</span>Freezer Grid
                    </Link>

                </nav>
            </div>
        </>
    );
}
************************************************************

FILE: src/components/TasaImporter.jsx
------------------------------
// src/components/TasaImporter.jsx
import React, { useRef } from 'react';
import { useDataImport } from '../lib/db/hooks/useDataImport.js';
import tasaRepository from '../lib/db/repositories/TasaRepository.js';

const TasaImporter = ({ onImportComplete }) => {
  const fileInputRef = useRef(null);
  const { importing, result, importFromFile } = useDataImport();
  const [demoJson, setDemoJson] = useState('');

  const handleFileSelect = async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const result = await importFromFile(file);
    if (result.success && onImportComplete) {
      onImportComplete();
    }
  };

  const handleDemoImport = async () => {
    try {
      const tasasDemo = [
        {
          nombre: "Tasa de Cambio USD/EUR",
          valor: 0.92,
          moneda: "EUR",
          descripcion: "Tasa de cambio dÃ³lar a euro",
          activo: true
        },
        {
          nombre: "Tasa de Cambio USD/GBP",
          valor: 0.79,
          moneda: "GBP",
          descripcion: "Tasa de cambio dÃ³lar a libra",
          activo: true
        },
        {
          nombre: "Tasa de InterÃ©s Referencial",
          valor: 4.25,
          moneda: "USD",
          descripcion: "Tasa de interÃ©s anual",
          activo: true
        }
      ];

      const count = await tasaRepository.bulkImport(tasasDemo, { clearBeforeImport: false });
      
      if (onImportComplete) {
        onImportComplete();
      }
      
      alert(`âœ… ${count} tasas de demostraciÃ³n importadas`);
    } catch (error) {
      alert(`âŒ Error: ${error.message}`);
    }
  };

  const handleExport = async () => {
    try {
      const tasas = await tasaRepository.getAll(false);
      const dataStr = JSON.stringify(tasas, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      
      const link = document.createElement('a');
      link.href = URL.createObjectURL(dataBlob);
      link.download = `tasas_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
    } catch (error) {
      alert(`Error al exportar: ${error.message}`);
    }
  };

  return (
    <div className="p-4 border rounded-lg space-y-4">
      <h3 className="font-bold">Importar/Exportar Tasas</h3>
      
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {/* Importar desde archivo */}
        <div className="space-y-2">
          <label className="block text-sm font-medium">
            Importar desde JSON
          </label>
          <input
            ref={fileInputRef}
            type="file"
            accept=".json"
            onChange={handleFileSelect}
            disabled={importing}
            className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
          />
        </div>
        
        {/* Datos de demostraciÃ³n */}
        <div className="space-y-2">
          <label className="block text-sm font-medium">
            Datos de demostraciÃ³n
          </label>
          <button
            onClick={handleDemoImport}
            disabled={importing}
            className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-400"
          >
            Cargar Datos Demo
          </button>
        </div>
        
        {/* Exportar */}
        <div className="space-y-2">
          <label className="block text-sm font-medium">
            Exportar datos
          </label>
          <button
            onClick={handleExport}
            className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
          >
            Exportar JSON
          </button>
        </div>
      </div>
      
      {/* Resultado de importaciÃ³n */}
      {importing && (
        <div className="p-2 bg-blue-50 rounded text-center">
          <div className="inline-block animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-blue-500 mr-2"></div>
          Importando...
        </div>
      )}
      
      {result && (
        <div className={`p-3 rounded ${result.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
          {result.success 
            ? `âœ… ${result.count} tasas importadas exitosamente`
            : `âŒ Error: ${result.error}`
          }
        </div>
      )}
    </div>
  );
};
export default TasaImporter;
************************************************************

FILE: src/components/TasaList.jsx
------------------------------
// src/components/TasaList.jsx
import React, { useState } from 'react';
import { useTasa } from '../lib/db/hooks/useTasa.js';

const TasaList = () => {
  const { 
    tasas, 
    tasaActiva, 
    loading, 
    error, 
    eliminarTasa, 
    loadHistorial,
    historial,
    stats 
  } = useTasa();
  
  const [busqueda, setBusqueda] = useState('');
  const [tasaSeleccionada, setTasaSeleccionada] = useState(null);

  const handleEliminar = async (id) => {
    if (window.confirm('Â¿EstÃ¡s seguro de desactivar esta tasa?')) {
      const result = await eliminarTasa(id);
      if (result.success) {
        alert('Tasa desactivada');
      } else {
        alert(`Error: ${result.error}`);
      }
    }
  };

  const handleVerHistorial = async (tasa) => {
    setTasaSeleccionada(tasa);
    await loadHistorial(tasa.id);
  };

  if (loading && tasas.length === 0) {
    return (
      <div className="p-4 text-center">
        <div className="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div>
        <p className="mt-2">Cargando tasas...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-4 bg-red-100 border border-red-400 text-red-700 rounded">
        Error: {error}
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* EstadÃ­sticas */}
      {stats && (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div className="p-4 bg-blue-50 rounded">
            <p className="text-sm text-gray-600">Total Tasas</p>
            <p className="text-2xl font-bold">{stats.total}</p>
          </div>
          <div className="p-4 bg-green-50 rounded">
            <p className="text-sm text-gray-600">Activas</p>
            <p className="text-2xl font-bold">{stats.activas}</p>
          </div>
          <div className="p-4 bg-yellow-50 rounded">
            <p className="text-sm text-gray-600">Promedio</p>
            <p className="text-2xl font-bold">{stats.promedio.toFixed(4)}</p>
          </div>
          <div className="p-4 bg-purple-50 rounded">
            <p className="text-sm text-gray-600">Rango</p>
            <p className="text-lg font-bold">
              {stats.minima.toFixed(4)} - {stats.maxima.toFixed(4)}
            </p>
          </div>
        </div>
      )}

      {/* Tasa Activa */}
      {tasaActiva && (
        <div className="p-4 bg-green-50 border border-green-200 rounded">
          <h3 className="font-bold text-green-800 mb-2">â­ Tasa Activa Actual</h3>
          <div className="flex justify-between items-center">
            <div>
              <p className="text-lg font-semibold">{tasaActiva.nombre}</p>
              <p className="text-2xl font-bold">{tasaActiva.valor} {tasaActiva.moneda}</p>
            </div>
            <button
              onClick={() => handleVerHistorial(tasaActiva)}
              className="px-3 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200"
            >
              Ver Historial
            </button>
          </div>
        </div>
      )}

      {/* Buscador */}
      <div className="relative">
        <input
          type="text"
          placeholder="Buscar tasas..."
          value={busqueda}
          onChange={(e) => setBusqueda(e.target.value)}
          className="w-full p-2 pl-10 border rounded"
        />
        <span className="absolute left-3 top-2.5">ğŸ”</span>
      </div>

      {/* Lista de Tasas */}
      <div className="space-y-3">
        <h3 className="text-lg font-semibold">
          Todas las Tasas ({tasas.length})
        </h3>
        
        {tasas.length === 0 ? (
          <p className="text-gray-500 text-center py-8">
            No hay tasas registradas
          </p>
        ) : (
          tasas.map(tasa => (
            <div 
[CONTENIDO SENSIBLE ELIMINADO EN: TasaList.jsx]
              className={`p-4 border rounded flex justify-between items-center ${
                !tasa.activo ? 'bg-gray-50 opacity-75' : ''
              }`}
            >
              <div>
                <div className="flex items-center space-x-2">
                  <h4 className="font-medium">{tasa.nombre}</h4>
                  {!tasa.activo && (
                    <span className="text-xs bg-gray-200 px-2 py-1 rounded">INACTIVA</span>
                  )}
                  {tasa.id === tasaActiva?.id && (
                    <span className="text-xs bg-green-200 px-2 py-1 rounded">ACTUAL</span>
                  )}
                </div>
                <p className="text-2xl font-bold my-1">{tasa.valor} {tasa.moneda}</p>
                {tasa.descripcion && (
                  <p className="text-sm text-gray-600">{tasa.descripcion}</p>
                )}
                <p className="text-xs text-gray-500">
                  Creada: {new Date(tasa.fechaCreacion).toLocaleDateString()}
                </p>
              </div>
              
              <div className="flex space-x-2">
                <button
                  onClick={() => handleVerHistorial(tasa)}
                  className="px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200"
                >
                  Historial
                </button>
                <button
                  onClick={() => handleEliminar(tasa.id)}
                  className="px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200"
                >
                  {tasa.activo ? 'Desactivar' : 'Eliminar'}
                </button>
              </div>
            </div>
          ))
        )}
      </div>

      {/* Modal de Historial */}
      {tasaSeleccionada && historial.length > 0 && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-auto">
            <div className="p-4 border-b flex justify-between items-center">
              <h3 className="text-lg font-bold">
                Historial: {tasaSeleccionada.nombre}
              </h3>
              <button
                onClick={() => setTasaSeleccionada(null)}
                className="text-gray-500 hover:text-gray-700"
              >
                âœ•
              </button>
            </div>
            
            <div className="p-4">
              <div className="space-y-3">
                {historial.map((item, index) => (
[CONTENIDO SENSIBLE ELIMINADO EN: TasaList.jsx]
                    <div className="flex justify-between">
                      <span className="font-medium">{item.tipo}</span>
                      <span className="text-sm text-gray-500">
                        {new Date(item.fechaCambio).toLocaleString()}
                      </span>
                    </div>
                    {item.valorAnterior !== null && (
                      <div className="mt-2 text-sm">
                        <span className="text-gray-600">De: </span>
                        <span className="line-through">{item.valorAnterior}</span>
                        <span className="mx-2">â†’</span>
                        <span className="text-green-600 font-semibold">{item.valorNuevo}</span>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default TasaList;
************************************************************

FILE: src/core/finanzas/calculos.js
------------------------------
import { movimientos } from './movimientos.js'
import { cuentas } from './cuentas.js'

export function calcularSaldoCuenta(cuentaId) {
  const cuenta = cuentas.find(c => c.id === cuentaId)
  if (!cuenta) return 0

  const saldoMov = movimientos.reduce((acc, m) => {
    if (m.cuentaId !== cuentaId) return acc
    return m.tipo === 'ingreso'
      ? acc + m.monto
      : acc - m.monto
  }, 0)

  return cuenta.saldoInicial + saldoMov
}

************************************************************

FILE: src/core/finanzas/cuentas.js
------------------------------
export const cuentas = [
  {
    id: 'caja',
    nombre: 'Caja',
    tipo: 'efectivo',
    saldoInicial: 0
  },
  {
    id: 'banco',
    nombre: 'Banco',
    tipo: 'bancario',
    saldoInicial: 0
  }
]
************************************************************

FILE: src/core/finanzas/movimientos.js
------------------------------
export const movimientos = []

************************************************************

FILE: src/core/finanzas/registrarMovimiento.js
------------------------------
import { movimientos } from './movimientos.js'

export function registrarMovimiento({
  fecha = new Date(),
  tipo, // 'ingreso' | 'egreso'
  monto,
  cuentaId,
  origen,       // 'venta' | 'gasto'
  referenciaId, // id de venta o gasto
  descripcion = ''
}) {
  if (!tipo || !monto || !cuentaId) {
    throw new Error('Movimiento incompleto')
  }

  const movimiento = {
    id: crypto.randomUUID(),
    fecha,
    tipo,
    monto,
    cuentaId,
    origen,
    referenciaId,
    descripcion
  }

  movimientos.push(movimiento)
  return movimiento
}

************************************************************

FILE: src/data/data.json
------------------------------
{
  "productos": [
    {
      "id": 1,
      "nombre": "PARCHITA CREMOSA",
      "grupo": "cremoso",
      "stock": 0,
      "imagen": "/outputs/small/parchitacremosa_400.webp"
    },
    {
      "id": 2,
      "nombre": "PINA CREMOSA",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/pinacremosa_400.webp"
    },
    {
      "id": 3,
      "nombre": "DURAZNO cremoso",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/duraznocremoso_400.webp"
    },
    {
      "id": 4,
      "nombre": "FRESA CREMOSA",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/fresa_400.webp"
    },
    {
      "id": 5,
      "nombre": "GUANA-GUANA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/guanaguana_400.webp"
    },
    {
      "id": 6,
      "nombre": "OREO CREMITA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/oreocremita_400.webp"
    },
    {
      "id": 7,
      "nombre": "PIE PARCHITA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/pieparchita_400.webp"
    },
    {
      "id": 8,
      "nombre": "PIE NARANJA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/pienaranja_400.webp"
    },
    {
      "id": 9,
      "nombre": "CHOCO OREO",
      "grupo": "premium",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 10,
      "nombre": "DALMATA",
      "grupo": "premium",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 11,
      "nombre": "VAINILLA",
      "grupo": "premium",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 12,
      "nombre": "COCO",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/coco_400.webp"
    },
    {
      "id": 13,
      "nombre": "PIE LIMON",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/pielimon_400.webp"
    },
    {
      "id": 14,
      "nombre": "CHOKO MILK",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/chokomilk_400.webp"
    },
    {
      "id": 15,
      "nombre": "AGUACATE",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/aguacate_400.webp"
    },
    {
      "id": 16,
      "nombre": "MANI",
      "grupo": "fullcremoso",
      "stock": 0,
      "imagen": "/outputs/small/manicremoso_400.webp"
    },
    {
      "id": 17,
      "nombre": "FRESA BLANCO",
      "grupo": "premium",
      "stock": 1,
      "imagen": "/outputs/small/fresablanco_400.webp"
    },
    {
      "id": 26,
      "nombre": "CHOCO SUSY",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/chocosussy_400.webp"
    },
        {
      "id": 27,
      "nombre": "DURAZNO CITRICO",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 28,
      "nombre": "FRESA CITRICO",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 29,
      "nombre": "TAMARINDO",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 30,
      "nombre": "NATUGOMITAS",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 31,
      "nombre": "RON CON PASAS",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 32,
      "nombre": "MANGO BICHE",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
        {
      "id": 33,
      "nombre": "GUAYABA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 34,
      "nombre": "MORA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    }

  ]
}



************************************************************

FILE: src/data/grupos.json
------------------------------
{
  "cremoso": 0.5,
  "fullcremoso": 0.7,
  "premium": 1.05,
  "citrico": 0.4,
  "ninguno": 0.0
}
************************************************************

FILE: src/hooks/useLocalStorageList.js
------------------------------
import { useState, useEffect } from "react";

[CONTENIDO SENSIBLE ELIMINADO EN: useLocalStorageList.js]
  const [data, setData] = useState(() => {
[CONTENIDO SENSIBLE ELIMINADO EN: useLocalStorageList.js]
    return stored ? JSON.parse(stored) : initialValue;
  });

  useEffect(() => {
[CONTENIDO SENSIBLE ELIMINADO EN: useLocalStorageList.js]
[CONTENIDO SENSIBLE ELIMINADO EN: useLocalStorageList.js]

  return { data, setData };
}

************************************************************

FILE: src/index.css
------------------------------
:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  display: block;      /* Cambia flex por block para evitar centrados forzados */
  min-width: 100%;     /* Asegura que ocupe el 100% */
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}

************************************************************

FILE: src/lib/constants.js
------------------------------
export const ORDER_STATUS = {
    ACTIVE: 'Activo',
    CLOSED: 'Cerrado'
};

************************************************************

FILE: src/lib/db/database.js
------------------------------
import Dexie from 'dexie';
import 'dexie-export-import'; // Required for database backup functionality [1, 4]

export class NaturaDBClass {

    constructor() {
        // The database is named dbTasaBCV as per project requirements [1, 5]
        this.db = new Dexie('dbTasaBCV');

        // Version 1 - Initial schema [1]
        this.db.version(1).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio'
        });

        // Version 2 - Added configuration table [2]
        this.db.version(2).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio',
            config: 'clave'
        });

        // Version 3 - Added sales table for real-time tracking [2]
        this.db.version(3).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad'
        });

        // Version 4 - Added orders table with autoincremental ID [3]
        this.db.version(4).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa'
        });

        // Version 5 - Added cost field (costo_$) to groups for price management [3]
        this.db.version(5).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa'
        });

        // NEW Version 6 - Added status field (estatus) to orders for workflow management
        // Note: 'items' and totals are stored in the object but not indexed [History]
        this.db.version(6).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus'
        });

        this.db.version(7).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago'
        });

        this.db.version(8).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt, visible',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago'
        });

        this.db.version(9).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt, visible',
            grupos: '++id, nombre, precio, costo_$', config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad, utilidadUsd, tasaVenta, costoUnitarioUsd',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago',
            historico_tasas: '++id, fecha_tasa, tasa' // Nueva tabla indexada por fecha y valor
        });

        this.db.version(10).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt, visible',
            grupos: '++id, nombre, precio, costo_$', config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad, utilidadUsd, tasaVenta, costoUnitarioUsd',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago',
            historico_tasas: '++id, fecha_tasa, tasa',
            freezer_slots: 'id, row, col' // [id=row_col]
        });

        this.db.version(11).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt, visible',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad, utilidadUsd, tasaVenta, costoUnitarioUsd',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago',
            historico_tasas: '++id, fecha_tasa, tasa',
            freezer_containers: '++id, order',
            freezer_slots: 'id, containerId, row, col'
        });

        // Direct access references for components [6]
        this.productos = this.db.productos;
        this.grupos = this.db.grupos;
        this.config = this.db.config;
        this.ventas = this.db.ventas;
        this.pedidos = this.db.pedidos;
        this.gastos = this.db.gastos;
        this.gastos = this.db.gastos;
        this.historico_tasas = this.db.historico_tasas;
        this.freezer_containers = this.db.freezer_containers;
        this.freezer_slots = this.db.freezer_slots;

    }

    // Initialisation method called by the app entry points [6]
    async init() {
        if (!this.db.isOpen()) {
            await this.db.open();
            console.log("Database dbTasaBCV opened successfully.");
        }
        return this;
    }

    // Transaction helper to ensure atomicity [BI/Production Readiness]
    async transaction(mode, tables, callback) {
        return await this.db.transaction(mode, tables, callback);
    }

    // Generic CRUD methods used across the application [6, 7]
    async add(table, data) {
        return await this.db[table].add(data);
    }

    async get(table, id) {
        return await this.db[table].get(id);
    }

    async getAll(table, filters = {}) {
        let query = this.db[table];
[CONTENIDO SENSIBLE ELIMINADO EN: database.js]
[CONTENIDO SENSIBLE ELIMINADO EN: database.js]
        }
        return await query.toArray();
    }

    async getUltimaTasaBCV() {
        try {
            // Buscamos en el histÃ³rico ordenando por fecha_tasa
            const ultimaEntrada = await this.db.historico_tasas
                .orderBy('fecha_tasa')
                .last(); // Obtiene el registro con la fecha mÃ¡s reciente

            if (ultimaEntrada) {
                return ultimaEntrada.tasa;
            }

            // Fallback: Intentar config antigua, si no existe usar Ãºltima tasa conocida
            const configTasa = await this.getConfigValue('tasa');
            if (configTasa && configTasa > 0) {
                return configTasa;
            }

            // Ãšltimo fallback: Usar Ãºltima tasa conocida del histÃ³rico hardcoded
            console.warn('âš ï¸ No hay tasa BCV en BD. Usando tasa por defecto.');
            return 355.11; // Ãšltima tasa conocida del histÃ³rico inicial
        } catch (error) {
            console.error("Error obteniendo tasa reciente:", error);
            return 355.11; // Fallback seguro en caso de error
        }
    }

    async put(table, data) {
        return await this.db[table].put(data);
    }

    async del(table, id) {
        await this.db[table].delete(id);
    }

    // Business specific logic for inventory management [7, 8]
    async updateStock(productoId, cantidad) {
        const producto = await this.get('productos', productoId);
        if (producto) {
            const nuevoStock = Math.max(0, producto.stock + cantidad);
            return await this.put('productos', {
                ...producto,
                stock: nuevoStock
            });
        }
        return null;
    }

    // Configuration helpers for BCV rate and settings [8, 9]
    async getConfigValue(clave) {
        const config = await this.get('config', clave);
        return config ? config.valor : null;
    }

    async setConfigValue(clave, valor) {
        return await this.put('config', {
            clave,
            valor,
            updatedAt: new Date().toISOString()
        });
    }

    // One shott function para buld data de tasas bcv
    async cargarDatosInicialesHistorico() {
        const dataRecaudada = [
            { fecha_tasa: '2026-01-15', tasa: 344.08 },
            { fecha_tasa: '2026-01-16', tasa: 344.08 },
            { fecha_tasa: '2026-01-17', tasa: 341.32 },
            { fecha_tasa: '2026-01-18', tasa: 341.32 },
            { fecha_tasa: '2026-01-19', tasa: 344.08 },
            { fecha_tasa: '2026-01-20', tasa: 346.83 },
            { fecha_tasa: '2026-01-21', tasa: 349.49 },
            { fecha_tasa: '2026-01-22', tasa: 352.27 },
            { fecha_tasa: '2026-01-23', tasa: 355.11 },
            { fecha_tasa: '2026-01-24', tasa: 355.11 },
            { fecha_tasa: '2026-01-25', tasa: 355.11 }
        ];

        try {
            await this.db.historico_tasas.clear();
            await this.db.historico_tasas.bulkAdd(dataRecaudada);
            // Retornamos 'message' para que el Panel lo reconozca
            return {
                success: true,
                message: `âœ… Se cargaron ${dataRecaudada.length} dÃ­as al histÃ³rico.`
            };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }
}

export const db = new NaturaDBClass();
************************************************************

FILE: src/lib/db/hooks/useDelivery.js
------------------------------
// src/lib/db/hooks/useDelivery.js
import { useState, useEffect } from 'react';
import { db } from '../database.js';

export function useDelivery() {
  const [delivery, setDelivery] = useState(0);
  const [loading, setLoading] = useState(true);

  // Cargar delivery al inicio
  useEffect(() => {
    async function loadDelivery() {
      try {
        // Buscar en la tabla 'config' donde clave = 'delivery'
        const config = await db.config.get('delivery');
        
        if (config && config.valor) {
          const valor = String(config.valor).replace(',', '.');
          setDelivery(valor);
        } else {
          setDelivery('0'); // Cero si no existe
        }
      } catch (error) {
        console.error('Error cargando delivery:', error);
        setDelivery('0');
      } finally {
        setLoading(false);
      }
    }

    loadDelivery();
  }, []);

  // Guardar delivery
  const saveDelivery = async (valor) => {
    try {
      const deliveryNormalizado = String(valor).replace(',', '.');
      const deliveryNumero = parseFloat(deliveryNormalizado);
      
      if (isNaN(deliveryNumero)) {
        console.error('Valor no es un nÃºmero:', valor);
        return false;
      }

      await db.config.put({
        clave: 'delivery',
        valor: deliveryNumero,
        fechaActualizacion: new Date(),
        tipo: 'decimal'
      });

      console.log('Delivery guardado:', deliveryNumero);
      setDelivery(deliveryNormalizado);
      return true;

    } catch (error) {
      console.error('Error guardando delivery:', error);
      return false;
    }
  };

  return {
    delivery,
    setDelivery,
    saveDelivery,
    loading
  };
}
************************************************************

FILE: src/lib/db/hooks/useTasa.js
------------------------------
// src/lib/db/hooks/useTasa.js
import { useState, useEffect, useCallback } from 'react';
import tasaRepository from '../repositories/TasaRepository.js';

export function useTasa() {
  const [tasas, setTasas] = useState([]);
  const [tasaActiva, setTasaActiva] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [historial, setHistorial] = useState([]);
  const [stats, setStats] = useState(null);

  // Cargar todas las tasas
  const loadTasas = useCallback(async () => {
    try {
      setLoading(true);
      const [tasasData, tasaActivaData, statsData] = await Promise.all([
        tasaRepository.getAll(),
        tasaRepository.getActive(),
        tasaRepository.getStats()
      ]);
      
      setTasas(tasasData);
      setTasaActiva(tasaActivaData);
      setStats(statsData);
      setError(null);
    } catch (err) {
      setError(err.message || 'Error al cargar tasas');
      console.error('Error en loadTasas:', err);
    } finally {
      setLoading(false);
    }
  }, []);

  // Cargar historial de una tasa
  const loadHistorial = useCallback(async (tasaId) => {
    try {
      const historialData = await tasaRepository.getHistorial(tasaId);
      setHistorial(historialData);
    } catch (err) {
      setError(err.message || 'Error al cargar historial');
    }
  }, []);

  // Crear nueva tasa
  const crearTasa = useCallback(async (tasaData) => {
    try {
      const id = await tasaRepository.create(tasaData);
      await loadTasas(); // Refrescar lista
      return { success: true, id };
    } catch (err) {
      const errorMsg = err.message || 'Error al crear tasa';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    }
  }, [loadTasas]);

  // Actualizar tasa
  const actualizarTasa = useCallback(async (id, updates) => {
    try {
      await tasaRepository.update(id, updates);
      await loadTasas(); // Refrescar lista
      return { success: true };
    } catch (err) {
      const errorMsg = err.message || 'Error al actualizar tasa';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    }
  }, [loadTasas]);

  // Eliminar tasa (soft delete)
  const eliminarTasa = useCallback(async (id) => {
    try {
      await tasaRepository.delete(id);
      await loadTasas(); // Refrescar lista
      return { success: true };
    } catch (err) {
      const errorMsg = err.message || 'Error al eliminar tasa';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    }
  }, [loadTasas]);

  // Buscar tasas
  const buscarTasas = useCallback(async (query) => {
    try {
      setLoading(true);
      const resultados = await tasaRepository.search(query);
      setTasas(resultados);
      setError(null);
    } catch (err) {
      setError(err.message || 'Error en bÃºsqueda');
    } finally {
      setLoading(false);
    }
  }, []);

  // Cargar datos al inicio
  useEffect(() => {
    loadTasas();
  }, [loadTasas]);

  return {
    // Datos
    tasas,
    tasaActiva,
    historial,
    stats,
    
    // Estados
    loading,
    error,
    
    // Acciones CRUD
    crearTasa,
    actualizarTasa,
    eliminarTasa,
    buscarTasas,
    loadHistorial,
    
    // Utilidades
    refresh: loadTasas,
    resetError: () => setError(null),
    resetHistorial: () => setHistorial([])
  };
  
}

************************************************************

FILE: src/lib/db/hooks/useTasaBCV.js
------------------------------
// src/lib/db/hooks/useTasaBCV.js
import { useState, useEffect } from 'react';
import { db } from '../database.js'; // Referencia a la instancia dbTasaBCV [2]

/**
 * Hook personalizado para gestionar la Tasa BCV en la aplicaciÃ³n Natura.
 * Actualizado para priorizar la obtenciÃ³n desde la tabla historico_tasas.
 */
export function useTasaBCV() {
    const [tasa, setTasa] = useState('');
    const [loading, setLoading] = useState(true);

    // Cargar tasa al inicio mediante el nuevo mÃ©todo dinÃ¡mico
    useEffect(() => {
        async function loadTasa() {
            try {
                // CAMBIO FASE 2: Ya no consulta solo la tabla 'config'.
                // Llama al mÃ©todo que busca la tasa mÃ¡s reciente en el histÃ³rico [1, 3].
                const valorTasa = await db.getUltimaTasaBCV();

                if (valorTasa) {
                    // Asegurar formato de string con punto decimal para consistencia en la UI [2]
                    const valor = String(valorTasa).replace(',', '.');
                    setTasa(valor);
                } else {
                    setTasa(''); // VacÃ­o si no existe registro en ninguna tabla [2]
                }
            } catch (error) {
                console.error('Error cargando tasa desde el historial:', error);
                setTasa('');
            } finally {
                setLoading(false);
            }
        }
        loadTasa();
    }, []);

    return { 
        tasa, 
        setTasa, 
        loading 
    };
}
************************************************************

FILE: src/lib/db/index.js
------------------------------
//export {default as db} from './db';
// export * from './hooks';
// export * from './repositories';

export { db } from './database.js';
************************************************************

FILE: src/lib/db/repositories/DeliveryRepository.js
------------------------------
// src/lib/db/repositories/DeliveryRepository.js
import { db } from "../database";

[CONTENIDO SENSIBLE ELIMINADO EN: DeliveryRepository.js]

export const DeliveryRepository = {
  async getDelivery() {
[CONTENIDO SENSIBLE ELIMINADO EN: DeliveryRepository.js]
  },

  async saveDelivery(valor) {
[CONTENIDO SENSIBLE ELIMINADO EN: DeliveryRepository.js]
  },

  async calcularTotalConDelivery(subtotal) {
[CONTENIDO SENSIBLE ELIMINADO EN: DeliveryRepository.js]
    
    if (!delivery || typeof delivery !== "number") {
      console.warn("Delivery no configurado. Retornando solo subtotal.");
      return subtotal;
    }
    
    return Number(subtotal || 0) + delivery;
  }
};
************************************************************

FILE: src/lib/db/repositories/RepoRecommStructure.js
------------------------------
// Ejemplo de repositorio completo para Tasa
class TasaRepository {
  // === CRUD BÃSICO ===
  async create(data) { /* ... */ }
  async getById(id) { /* ... */ }
  async getAll() { /* ... */ }
  async update(id, data) { /* ... */ }
  async delete(id) { /* ... */ }
  
  // === CONSULTAS ESPECÃFICAS ===
  async getActivas() { /* ... */ }
  async getByMoneda(moneda) { /* ... */ }
  async getByRangoValor(min, max) { /* ... */ }
  
  // === BÃšSQUEDAS ===
  async search(term) { /* ... */ }
  async getFiltradas(filtros) { /* ... */ }
  
  // === AGREGACIONES ===
  async getEstadisticas() { /* ... */ }
  async getConteoPorMoneda() { /* ... */ }
  
  // === VALIDACIONES ===
  async validarTasa(data) { /* ... */ }
  async existeTasaSimilar(data) { /* ... */ }
  
  // === OPERACIONES MASIVAS ===
  async bulkInsert(tasas) { /* ... */ }
  async bulkUpdate(ids, updates) { /* ... */ }
  
  // === HISTORIAL/AUDITORÃA ===
  async getHistorial(tasaId) { /* ... */ }
  async registrarCambio(tasaId, cambios) { /* ... */ }
  
  // === SINCRONIZACIÃ“N ===
  async getCambiosPendientes() { /* ... */ }
  async marcarComoSincronizado(id) { /* ... */ }
  
  // === UTILIDADES ===
  async hacerBackup() { /* ... */ }
  async compactar() { /* ... */ }
  async getInfo() { /* ... */ }
}
************************************************************

FILE: src/lib/db/repositories/TasaRepository.js
------------------------------
// src/lib/db/repositories/TasaRepository.js
import { db } from "../database";

[CONTENIDO SENSIBLE ELIMINADO EN: TasaRepository.js]

export const TasaRepository = {
    async getTasa() {
        // CAMBIO: Ya no busca solo en la tabla 'config' [8]
        // Ahora obtiene la mÃ¡s reciente del histÃ³rico [5]
        return await db.getUltimaTasaBCV();
    },

    async saveTasa(valor) {
        // Mantenemos la escritura en config para compatibilidad con versiones previas [9]
        return 0;   // await db.setConfigValue('tasa', Number(valor));
    },

    async convertirABs(valorenDolar) {
        const valor = await this.getTasa(); // Usa el nuevo mÃ©todo dinÃ¡mico
        if (!valor || typeof valor !== "number") {
            console.warn("Tasa no encontrada. Retornando 0.");
            return 0;
        }
        return valor * Number(valorenDolar || 0);
    }
};
************************************************************

FILE: src/lib/db/utils/Importer.js
------------------------------
// src/lib/db/utils/Importer.js
import { db } from '../database.js';

const Importer = {
    async ImportGrupos(jsonData) {
        try {
            // 1. CONVERTIR {clave:valor} a [{nombre, precio}]
            const gruposArray = Object.entries(jsonData).map(([nombre, precio]) => ({
                nombre: nombre,
                precio: Number(precio)
            }));

            // 2. LIMPIAR TABLA
            await db.grupos.clear();

            // 3. INSERTAR NUEVOS DATOS
            await db.grupos.bulkAdd(gruposArray);

            return {
                success: true,
                count: gruposArray.length,
                message: `${gruposArray.length} grupos importados`
            };

        } catch (error) {
            console.error('Error en importaciÃ³n:', error);
            return {
                success: false,
                error: error.message
            };
        }
    },

    async ImportProductos(jsonData) {
        try {
            // Â¡CORRECCIÃ“N! - jsonData ya es el array de productos
            // No necesitas Object.entries, ya viene como array
            const productosArray = jsonData.productos || jsonData;

            console.log('Productos a importar:', productosArray.length);
            console.log('Primer producto:', productosArray[0]);

            // 1. LIMPIAR TABLA
            await db.TBPRODUCTOS.clear();

            // 2. INSERTAR NUEVOS DATOS UNO POR UNO
            let importados = 0;
            for (const producto of productosArray) {
                try {
                    await db.productos.add({
                        id: producto.id,
                        nombre: producto.nombre,
                        grupo: producto.grupo,
                        stock: Number(producto.stock),
                        imagen: producto.imagen,
                        visible: producto.visible ?? true, // <--- AGREGA ESTA LÃNEA
                        createdAt: new Date()
                    });
                    importados++;
                } catch (error) {
                    console.error(`Error insertando producto ${producto.id}:`, error);
                }
            }

            return {
                success: true,
                count: importados,
                total: productosArray.length,
                message: `${importados} de ${productosArray.length} productos importados`
            };

        } catch (error) {
            console.error('Error en importaciÃ³n de productos:', error);
            return {
                success: false,
                error: error.message
            };
        }
    }
};

export default Importer;
************************************************************

FILE: src/lib/db/utils/deliveryUtil.js
------------------------------
// src/lib/db/utils/deliveryUtil.js
import { db } from '../database.js';

export async function getDeliveryCost() {
  try {
    const valor = await db.getConfigValue('delivery');
    return valor ? parseFloat(valor) : 0;
  } catch (error) {
    console.error('Error obteniendo delivery desde utils:', error);
    return 0;
  }
}

export async function calcularConDelivery(subtotal, delivery = null) {
  try {
    if (!delivery) {
      delivery = await getDeliveryCost();
    }

    if (!delivery || delivery <= 0) {
      return subtotal; // Sin cargo de delivery
    }

    const total = parseFloat(subtotal) + parseFloat(delivery);
    return Math.round(total * 100) / 100;
  } catch (error) {
    console.error('Error calculando con delivery:', error);
    return subtotal;
  }
}
************************************************************

FILE: src/lib/db/utils/exportService.js
------------------------------
import { db } from '../database';
import 'dexie-export-import'; // Required to extend Dexie functionality [4]

export const exportDatabase = async () => {
    try {
        // Use db.db to access the actual Dexie instance defined in your class [1, 2]
        const blob = await db.db.export({
            prettyJson: true,
            progressCallback: ({ totalRows, completedRows }) => {
                console.log(`Export progress: ${completedRows}/${totalRows}`);
            }
        });

        // Fixed filename as requested to avoid string manipulation errors
        const fileName = 'backup_natura_ice.json';

        // Standard logic for triggering a download in Android browsers [5]
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();

        // Cleanup resources
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        return { success: true };
    } catch (error) {
        console.error("Error exporting IndexedDB:", error);
        return { success: false, error };
    }
};
************************************************************

FILE: src/lib/db/utils/migrationService.js
------------------------------
/**
 * Servicio de migraciÃ³n para convertir pedidos al formato detallado de BI.
 * Realiza una captura de precios y costos actuales para pedidos antiguos.
 */
import { db } from '../database';

/**
 * Migra las ventas antiguas al formato BI agregando costos y utilidad.
 */
export const migrateSalesToBI = async () => {
  try {
    // 1. Obtener datos necesarios en paralelo
    const [allSales, allGroups] = await Promise.all([
      db.getAll('ventas'),
      db.getAll('grupos')
    ]);

    // 2. Filtrar ventas que no tienen snapshot financiero (falta costoUnitarioUsd)
    const salesToMigrate = allSales.filter(v => v.costoUnitarioUsd === undefined);

    if (salesToMigrate.length === 0) {
      return { success: true, migratedCount: 0, message: "No hay ventas pendientes por migrar." };
    }

    let count = 0;
    for (const venta of salesToMigrate) {
      // 3. Buscar el costo actual del grupo al que pertenece el producto
      const grupo = allGroups.find(g => g.nombre.toLowerCase() === venta.grupo.toLowerCase());

      const costoUnit = grupo?.costo_$ || 0;
      const precioVenta = venta.precioUsd || 0;

      // 4. Preparar el objeto con el Snapshot Financiero retroactivo
      const ventaMigrada = {
        ...venta,
        costoUnitarioUsd: costoUnit,
        utilidadUsd: precioVenta - costoUnit,
        // Si no tiene tasaVenta (ventas muy viejas), podrÃ­as asignar 0 o buscar la tasa de esa fecha
        tasaVenta: venta.tasaVenta || 0,
        migratedAt: new Date().toISOString() // Marca de auditorÃ­a
      };

      // 5. Guardar registro actualizado
      await db.put('ventas', ventaMigrada);
      count++;
    }

    return {
      success: true,
      migratedCount: count,
      message: `Se normalizaron ${count} registros de ventas para anÃ¡lisis de BI.`
    };

  } catch (error) {
    console.error("Error en la migraciÃ³n de ventas:", error);
    return { success: false, error: error.message };
  }
};


export const migrateOrdersToBI = async () => {
  try {
    // 1. Obtener toda la data necesaria en paralelo para optimizar rendimiento
    const [allOrders, allProducts, allGroups] = await Promise.all([
      db.getAll('pedidos'),
      db.getAll('productos'),
      db.getAll('grupos')
    ]);

    // 2. Filtrar pedidos que aÃºn tienen el formato antiguo (items no es un Array) 
    // MODIFICACIÃ“N: Ahora permitimos migrar todos para corregir discrepancias de cÃ¡lculos anteriores
    const ordersToMigrate = allOrders; // Procesamos todos los pedidos para asegurar consistencia

    if (ordersToMigrate.length === 0) {
      return { success: true, migratedCount: 0, message: "No hay pedidos pendientes por migrar." };
    }

    let count = 0;

    for (const pedido of ordersToMigrate) {
      // 3. LÃ³gica de TransformaciÃ³n de Items (Maneja tanto Formato Antiguo como BI)
      const itemsSnapshot = Array.isArray(pedido.items)
        ? pedido.items
        : Object.entries(pedido.items || {}).map(([id, qty]) => ({ productoId: parseInt(id), cantidad: qty }));

      const itemsBI = itemsSnapshot.map((item) => {
        const prodId = item.productoId;
        const qty = item.cantidad;
        const prod = allProducts.find(p => p.id === prodId);
        // Buscamos el grupo ignorando mayÃºsculas/minÃºsculas para mayor seguridad
        const grupo = prod
          ? allGroups.find(g => g.nombre.toLowerCase() === prod.grupo.toLowerCase())
          : null;

        const precioUnit = grupo?.precio || 0;
        const costoUnit = grupo?.costo_$ || 0;

        return {
          productoId: parseInt(prodId),
          nombre: prod?.nombre || "Producto no encontrado",
          grupo: prod?.grupo || "Otros",
          cantidad: qty,
          precioUnitario: precioUnit,
          costoUnitario: costoUnit,
          subtotalUsd: qty * precioUnit,
          utilidadUsd: qty * (precioUnit - costoUnit)
        };
      });

      // 4. Recalcular totales para asegurar consistencia BI
      const subtotalCostoUsd = itemsBI.reduce((sum, item) => sum + (item.cantidad * item.costoUnitario), 0);
      const subtotalVentaUsd = itemsBI.reduce((sum, item) => sum + item.subtotalUsd, 0);
      const costoEnvio = pedido.delivery_aplicado ? (parseFloat(pedido.delivery_tasa) || 0) : 0;

      const totalInversionUsd = subtotalCostoUsd + costoEnvio;
      const totalVentaUsd = subtotalVentaUsd; // La venta no suele incluir el delivery pagado al proveedor
      const tasaActual = parseFloat(pedido.tasa) || 0;

      // 5. Preparar objeto migrado
      const pedidoMigrado = {
        ...pedido,
        items: itemsBI,
        total_usd: totalInversionUsd, // Ahora es Costo + Delivery
        total_bs: totalInversionUsd * tasaActual,
        venta_usd: totalVentaUsd,
        venta_bs: totalVentaUsd * tasaActual,
        utilidad_usd: totalVentaUsd - totalInversionUsd,
        utilidad_bs: (totalVentaUsd - totalInversionUsd) * tasaActual,
        updatedAt: new Date().toISOString(),
        migratedAt: new Date().toISOString()
      };

      // 6. ActualizaciÃ³n Masiva (Registro por registro para seguridad en IndexedDB)
      await db.put('pedidos', pedidoMigrado);
      count++;
    }

    return {
      success: true,
      migratedCount: count,
      message: `Se migraron ${count} pedidos exitosamente al formato BI.`
    };

  } catch (error) {
    console.error("Error en la migraciÃ³n de pedidos:", error);
    return { success: false, error: error.message };
  }
};
************************************************************

FILE: src/lib/db/utils/tasaUtil.js
------------------------------
// src/lib/db/utils/tasaUtil.js
import { db } from '../database.js'; // This is correct if the file is in /utils/ [1]

export async function getTasaBCV() {
  try {
        // CAMBIO: Ahora llama al mÃ©todo que prioriza el histÃ³rico [5, 6]
        const valor = await db.getUltimaTasaBCV();
        return valor ? parseFloat(valor) : 0;
    } catch (error) {
        console.error('Error obteniendo tasa desde utils:', error);
        return null;
    }
}

export async function calcularEnDolares(bs, tasa = null) {
  try {
    if (!tasa) {
      tasa = await getTasaBCV();
    }

    if (!tasa || tasa <= 0) {
      console.warn('CÃ¡lculo cancelado: Tasa invÃ¡lida');
      return null;
    }

    const dolares = parseFloat(bs) / parseFloat(tasa);
    return Math.round(dolares * 100) / 100;
  } catch (error) {
    console.error('Error calculando conversiÃ³n:', error);
    return null;
  }
}

************************************************************

FILE: src/lib/utils.js
------------------------------
/**
 * Formatea una fecha en formato YYYY-MM-DD a DD/MM/YYYY
 * sin usar el constructor new Date() para evitar problemas de zona horaria (UTC).
 * @param {string} dateStr - Fecha en formato YYYY-MM-DD
 * @returns {string} - Fecha en formato DD/MM/YYYY
 */
export const formatDate = (dateStr) => {
    try {
        if (!dateStr) return '---';
        const str = String(dateStr);
        const cleanDate = str.split('T')[0];
        const parts = cleanDate.split('-');

        if (parts.length !== 3) return str;

        const [year, month, day] = parts;
        return `${day}/${month}/${year}`;
    } catch (e) {
        console.error("Error formatting date:", e);
        return String(dateStr || '---');
    }
};

************************************************************

FILE: src/main.jsx
------------------------------
import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import App from "./App";
import "./index.css";

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);

************************************************************

FILE: src/pages/About.jsx
------------------------------
export default function About() {
  return <h1>About Page</h1>;
}

************************************************************

FILE: src/pages/Admin.module.css
------------------------------
.adminContainer {
  padding: 20px;
  max-width: 700px;
  margin: 0 auto;
}

h2, h3 {
  text-align: center;
  color: #00BFFF;
}

/* AQUI AGREGAMOS COLOR NEGRO A TODO EL CONTENIDO DE LAS FILAS */
.item, 
.item p,
.item strong,
.info p {
  color: #000 !important;
}

.formBox {
  background: #fff;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  margin-bottom: 30px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.formBox input {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #bbb;
}

.saveBtn {
  background: #00BFFF;
  border: none;
  padding: 10px;
  color: #fff;
  border-radius: 8px;
  margin-top: 10px;
  cursor: pointer;
  width: 100%;
}

.cancelBtn {
  background: #ccc;
  border: none;
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
  width: 100%;
}

.list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.item {
  background: #fff;
  padding: 12px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  display: flex;
  gap: 12px;
  align-items: center;
}

.item img {
  width: 70px;
  height: 70px;
  object-fit: contain;
  border-radius: 8px;
}

.info {
  flex: 1;
}

.actions button {
  margin-left: 6px;
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  color: #000; /* aseguramos color visible */
}

.actions button:first-child {
  background: #FFB800;
}

.actions button:last-child {
  background: #FF5757;
  color: #fff;
}

/* ------------------- */
/*       MODAL         */
/* ------------------- */

.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.modalContent {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  color: #000; /* texto negro dentro del modal */
}

************************************************************

FILE: src/pages/DeliveryPage.jsx
------------------------------
// src/pages/DeliveryPage.jsx
import React from 'react';
import Delivery from '../components/Delivery';

const DeliveryPage = () => {
  return (
    <div style={styles.container}>
      <Delivery />
    </div>
  );
};

const styles = {
  container: {
    width: '100%',
    minHeight: '100vh',
    backgroundColor: '#f5f7fa'
  }
};

export default DeliveryPage;
************************************************************

FILE: src/pages/Estadisticas.jsx
------------------------------
// src/pages/Estadisticas.jsx
import { useState, useEffect } from 'react';
import { db } from '../lib/db/database'; // [1, 2]
import { getTasaBCV } from '../lib/db/utils/tasaUtil'; // [3, 4]
import {
  BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer,
  CartesianGrid, Cell, LabelList, Legend
} from 'recharts'; // [5, 6]
import styles from './Estadisticas.module.css'; // [7]

const Estadisticas = () => {
  const [datosBI, setDatosBI] = useState([]);
  const [datosMargen, setDatosMargen] = useState([]);
  const [tasa, setTasa] = useState(0);
  const [rango, setRango] = useState('mes');
  const [limiteProducto, setLimiteProducto] = useState('todos'); // Nuevo estado para el filtro
  const [cargando, setCargando] = useState(true);
  const [metricas, setMetricas] = useState({
    ventaTotalUsd: 0,
    utilidadTotalUsd: 0,
    utilidadNetaUsd: 0,
    costoTotalUsd: 0,
    gastosOperativosUsd: 0,
    retirosPersonalesUsd: 0,
    margenPorcentaje: 0,
    proyeccionVenta: 0,
    proyeccionCosto: 0,
    proyeccionUtilidad: 0,
    inversionTotalUsd: 0
  });

  useEffect(() => {
    const cargarAnaliticaBI = async () => {
      setCargando(true);
      try {
        // 1. UnificaciÃ³n de Fuentes: Pedidos, Ventas, Gastos, Productos y Grupos en paralelo
        const [pedidosRaw, ventasRaw, gastosRaw, valorTasa, productosRaw, gruposRaw] = await Promise.all([
          db.getAll('pedidos'),
          db.getAll('ventas'),
          db.getAll('gastos'),
          getTasaBCV(),
          db.getAll('productos'),
          db.getAll('grupos')
        ]);

        // 2. Filtrado por rango de tiempo unificado
        const pedidosCerrados = filtrarPorRango(pedidosRaw.filter(p => p.estatus === 'Cerrado'), rango);
        const ventasDirectas = filtrarPorRango(ventasRaw, rango);
        const gastosFiltrados = filtrarPorRango(gastosRaw, rango);

        const acumulado = {};

        // 3. Procesar Pedidos (Ventas a Distribuidores)
        pedidosCerrados.forEach(pedido => {
          if (Array.isArray(pedido.items)) {
            pedido.items.forEach(item => {
              actualizarAcumulado(acumulado, item);
            });
          }
        });

        // 4. Procesar Ventas (Ventas Directas desde Home.jsx)
        ventasDirectas.forEach(venta => {
          actualizarAcumulado(acumulado, {
            nombre: venta.nombre,
            utilidadUsd: venta.utilidadUsd,
            cantidad: 1,
            subtotalUsd: venta.precioUsd,
            costoUnitario: venta.costoUnitarioUsd
          });
        });

        // 5. Procesar Gastos y Retiros
        let gastosOperativosSum = 0;
        let retirosPersonalesSum = 0;
        let inversionesSum = 0;

        gastosFiltrados.forEach(g => {
          if (g.categoria === 'Personal') {
            retirosPersonalesSum += g.montoUsd || 0;
          } else if (g.categoria === 'InversiÃ³n') {
            inversionesSum += g.montoUsd || 0;
          } else {
            gastosOperativosSum += g.montoUsd || 0;
          }
        });

        // 6. Ordenar por Rentabilidad para aplicar el Top
        let productosOrdenados = Object.values(acumulado).sort((a, b) => b.utilidad - a.utilidad);

        // 7. Aplicar Filtro de Universo (Top 5, 10, Todos)
        if (limiteProducto !== 'todos') {
          productosOrdenados = productosOrdenados.slice(0, parseInt(limiteProducto));
        }

        // 8. Calcular MÃ©tricas del Universo Definido
        let ventaSum = 0;
        let costoSum = 0;

        productosOrdenados.forEach(prod => {
          ventaSum += prod.ventaTotal;
          costoSum += prod.costoTotal;
        });

        const utilidadBrutaSum = ventaSum - costoSum;
        const utilidadNetaSum = utilidadBrutaSum - gastosOperativosSum;
        const margenPorc = ventaSum > 0 ? (utilidadNetaSum / ventaSum) * 100 : 0;

        // 9. Calcular ProyecciÃ³n de Inventario (NUEVO - Valor Futuro)
        let invVenta = 0;
        let invCosto = 0;
        const gruposMap = new Map(gruposRaw.map(g => [g.nombre, g]));

        if (Array.isArray(productosRaw)) {
          productosRaw.forEach(p => {
            if (p.stock > 0 && p.grupo) {
              const g = gruposMap.get(p.grupo);
              if (g) {
                const costo = g.costo_$ || 0;
                const precio = g.precio || 0;
                invVenta += precio * p.stock;
                invCosto += costo * p.stock;
              }
            }
          });
        }
        const invUtilidad = invVenta - invCosto;

        setMetricas({
          ventaTotalUsd: ventaSum,
          costoTotalUsd: costoSum,
          utilidadTotalUsd: utilidadBrutaSum,
          utilidadNetaUsd: utilidadNetaSum,
          gastosOperativosUsd: gastosOperativosSum,
          retirosPersonalesUsd: retirosPersonalesSum,
          margenPorcentaje: margenPorc,
          proyeccionVenta: invVenta,
          proyeccionCosto: invCosto,
          proyeccionUtilidad: invUtilidad,
          inversionTotalUsd: inversionesSum
        });

        // Datos para el grÃ¡fico de Ranking
        setDatosBI(productosOrdenados);

        // Datos para el grÃ¡fico de Margen de ContribuciÃ³n
        setDatosMargen([
          { name: 'Finanzas USD', Costo: costoSum, Gastos: gastosOperativosSum, Utilidad: utilidadNetaSum }
        ]);

        setTasa(valorTasa || 0);

      } catch (err) {
        console.error("Error en unificaciÃ³n BI:", err);
      } finally {
        setCargando(false);
      }
    };

    cargarAnaliticaBI();
  }, [rango, limiteProducto]); // AÃ±adimos limiteProducto a dependencias

  const actualizarAcumulado = (acc, item) => {
    // NormalizaciÃ³n de valores
    const ventaItem = item.subtotalUsd || item.precioUsd || 0;
    const costoItem = (item.costoUnitario || item.costoUnitarioUsd || 0) * (item.cantidad || 1);
    const utilidadItem = item.utilidadUsd || (ventaItem - costoItem);

    if (!acc[item.nombre]) {
      acc[item.nombre] = {
        name: item.nombre,
        utilidad: 0,
        cantidad: 0,
        ventaTotal: 0,
        costoTotal: 0
      };
    }
    acc[item.nombre].utilidad += utilidadItem;
    acc[item.nombre].cantidad += (item.cantidad || 0);
    acc[item.nombre].ventaTotal += ventaItem;
    acc[item.nombre].costoTotal += costoItem;
  };

  const filtrarPorRango = (items, tipo) => {
    const ahora = new Date();
    return items.filter(item => {
      const fechaStr = item.fecha_pedido || item.fecha; // Soporta ambos formatos
      const fechaItem = new Date(fechaStr);
      if (tipo === 'hoy') return fechaItem.toDateString() === ahora.toDateString();
      if (tipo === '7d') {
        const limite = new Date();
        limite.setDate(ahora.getDate() - 7);
        return fechaItem >= limite;
      }
      if (tipo === 'mes') {
        return fechaItem.getMonth() === ahora.getMonth() && fechaItem.getFullYear() === ahora.getFullYear();
      }
      return true;
    });
  };

  if (cargando) return <div className={styles.loading}>Procesando Inteligencia de Negocio...</div>;

  return (
    <div className={styles.container}>
      <h1 className={styles.title}>ğŸ“Š ANALÃTICA FINANCIERA (BI)</h1>

      <div className={styles.mainCard}>
        <div className={styles.filterBar}>
          <div style={{ display: 'flex', gap: '10px' }}>
            <div style={{ flex: 1 }}>
              <label className={styles.filterLabel}>Periodo:</label>
              <select value={rango} onChange={(e) => setRango(e.target.value)} className={styles.select} style={{ width: '100%' }}>
                <option value="mes">Mes Actual</option>
                <option value="7d">Ãšltimos 7 DÃ­as</option>
                <option value="hoy">Ventas de Hoy</option>
              </select>
            </div>
            <div style={{ flex: 1 }}>
              <label className={styles.filterLabel}>Top Prods:</label>
              <select value={limiteProducto} onChange={(e) => setLimiteProducto(e.target.value)} className={styles.select} style={{ width: '100%' }}>
                <option value="todos">Todos</option>
                <option value={10}>Top 10</option>
                <option value={5}>Top 5</option>
              </select>
            </div>
          </div>
        </div>

        <div className={styles.ingresosContainer}>
          <div className={styles.ingresosCard}>
            <span className={styles.ingresosLabel}>Venta Bruta (Top)</span>
            <span className={styles.ingresosValue}>${metricas.ventaTotalUsd.toFixed(2)}</span>
          </div>
          <div className={styles.ingresosCard} style={{ backgroundColor: '#fff3e0' }}>
            <span className={styles.ingresosLabel}>Margen Real</span>
            <span className={styles.ingresosValue} style={{ color: '#e65100' }}>
              {metricas.margenPorcentaje.toFixed(1)}%
            </span>
          </div>
        </div>

        {/* GrÃ¡fico de Margen de ContribuciÃ³n */}
        <h3 className={styles.chartTitle}>MARGEN DE CONTRIBUCIÃ“N (COSTO VS UTILIDAD)</h3>
        <div className={styles.chartWrapper}>
          <ResponsiveContainer width="100%" height={150}>
            <BarChart data={datosMargen} layout="vertical">
              <CartesianGrid strokeDasharray="3 3" horizontal={false} />
              <XAxis type="number" hide />
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
              <Tooltip formatter={(v) => `$${v.toFixed(2)}`} />
              <Legend />
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
            </BarChart>
          </ResponsiveContainer>
        </div>

        {/* GrÃ¡fico de Rentabilidad por Producto */}
        <h3 className={styles.chartTitle}>
          {limiteProducto === 'todos' ? 'RENTABILIDAD POR PRODUCTO (TODOS)' : `TOP ${limiteProducto}: RENTABILIDAD POR PRODUCTO`}
        </h3>
        <div className={styles.chartWrapper}>
          <ResponsiveContainer width="100%" height={Math.max(250, datosBI.length * 40)}>
            <BarChart data={datosBI} layout="vertical" margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
              <CartesianGrid strokeDasharray="3 3" horizontal={false} />
              <XAxis type="number" hide />
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
              <Tooltip formatter={(v) => `$${v.toFixed(2)}`} />
              {/* Cambiamos a layout vertical para mejor visualizaciÃ³n cuando son muchos productos */}
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
                <LabelList
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
                  position="right"
                  formatter={(v) => `$${v.toFixed(2)}`}
                  style={{ fill: '#2c3e50', fontSize: 10, fontWeight: 'bold' }}
                />
                {datosBI.map((entry, index) => (
[CONTENIDO SENSIBLE ELIMINADO EN: Estadisticas.jsx]
                ))}
              </Bar>
            </BarChart>
          </ResponsiveContainer>
        </div>

        <div className={styles.footerInfo} style={{ marginTop: '20px', textAlign: 'center' }}>
          <p style={{ color: '#2e7d32', fontWeight: 'bold', marginBottom: '5px' }}>
            UTILIDAD NETA REAL: $ {metricas.utilidadNetaUsd.toLocaleString('en-US', {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2
            })}
          </p>
          <p style={{ color: '#000', fontWeight: 'bold' }}>
            UTILIDAD NETA REAL: Bs. {(metricas.utilidadNetaUsd * tasa).toLocaleString('es-VE', {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2
            })}
          </p>
          <small style={{ color: '#666' }}>Tasa: {tasa.toFixed(2)} (HistÃ³rico BCV)</small>
        </div>
      </div>

      {/* Tarjeta de Desglose de Utilidad (Segunda PosiciÃ³n) */}
      <div className={styles.mainCard} style={{ marginTop: '20px' }}>
        <h3 className={styles.chartTitle}>ğŸ’° DESGLOSE DE UTILIDAD REAL</h3>
        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', fontSize: '1rem', color: '#444' }}>
          <div style={{ display: 'flex', justifyContent: 'space-between' }}>
            <span>(+) Venta Bruta:</span>
            <span style={{ fontWeight: 'bold' }}>${metricas.ventaTotalUsd.toFixed(2)}</span>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', color: '#d32f2f' }}>
            <span>(-) Costo de MercancÃ­a:</span>
            <span style={{ fontWeight: 'bold' }}>-${metricas.costoTotalUsd.toFixed(2)}</span>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', color: '#f57c00' }}>
            <span>(-) Gastos Operativos:</span>
            <span style={{ fontWeight: 'bold' }}>-${metricas.gastosOperativosUsd.toFixed(2)}</span>
          </div>
          <hr style={{ border: '0', borderTop: '1px solid #eee', margin: '5px 0' }} />
          <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '1.2rem', color: '#2e7d32' }}>
            <span>(=) Utilidad Neta Real:</span>
            <span style={{ fontWeight: 'bold' }}>${metricas.utilidadNetaUsd.toFixed(2)}</span>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', color: '#7b1fa2', marginTop: '10px', fontSize: '0.9rem' }}>
            <span>(âš ) Retiros Personales:</span>
            <span style={{ fontWeight: 'bold' }}>-${metricas.retirosPersonalesUsd.toFixed(2)}</span>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', color: '#0288d1', fontSize: '0.9rem' }}>
            <span>(â†») InversiÃ³n / ReposiciÃ³n:</span>
            <span style={{ fontWeight: 'bold' }}>-${metricas.inversionTotalUsd.toFixed(2)}</span>
          </div>
          <div style={{ fontSize: '0.75rem', color: '#666', fontStyle: 'italic', marginTop: '5px' }}>
            * Retiros e Inversiones NO bajan tu utilidad contable, pero sÃ­ restan efectivo de caja.

          </div>
        </div>
      </div>

      {/* Tarjeta de ProyecciÃ³n de Inventario (NUEVO) */}
      <div className={styles.mainCard} style={{ marginTop: '20px', backgroundColor: '#e3f2fd' }}>
        <h3 className={styles.chartTitle}>ğŸ”® PROYECCIOÌN DE INVENTARIO (VALOR FUTURO)</h3>
        <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', fontSize: '1rem', color: '#444' }}>
          <p style={{ fontSize: '0.85rem', color: '#555', marginBottom: '5px' }}>
            Este es el dinero que tienes "guardado" en tus freezers. Si vendieras todo hoy, estos serÃ­an tus nÃºmeros:
          </p>
          <div style={{ display: 'flex', justifyContent: 'space-between' }}>
            <span>Valor de Venta (PVP):</span>
            <span style={{ fontWeight: 'bold' }}>${metricas.proyeccionVenta.toFixed(2)}</span>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', color: '#d32f2f' }}>
            <span>Costo de ReposiciÃ³n:</span>
            <span style={{ fontWeight: 'bold' }}>-${metricas.proyeccionCosto.toFixed(2)}</span>
          </div>
          <hr style={{ border: '0', borderTop: '1px solid #bbdefb', margin: '5px 0' }} />
          <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '1.2rem', color: '#0d47a1' }}>
            <span>(=) Utilidad Proyectada:</span>
            <span style={{ fontWeight: 'bold' }}>${metricas.proyeccionUtilidad.toFixed(2)}</span>
          </div>
        </div>
      </div>

      {/* Tarjeta de GuÃ­a para No Financieros (InformaciÃ³n adicional del historial) */}
      <div className={styles.mainCard} style={{ marginTop: '20px', backgroundColor: '#fdfdfd' }}>
        <h3 className={styles.chartTitle}>ğŸ“– GUÃA RÃPIDA DE TUS NÃšMEROS</h3>
        <div style={{ fontSize: '0.85rem', color: '#444', lineHeight: '1.4' }}>
          <p><strong>ğŸ’° Venta Bruta:</strong> Todo el dinero cobrado por ventas.</p>
          <p><strong>ğŸ“‰ Costo de MercancÃ­a:</strong> Lo que debes apartar para reponer los productos vendidos.</p>
          <p><strong>ğŸ¢ Gastos Operativos:</strong> Costos del negocio (empaques, transporte, catÃ¡logos).</p>
          <p><strong>âœ… Utilidad Neta Real:</strong> Tu ganancia verdadera despuÃ©s de pagar productos y gastos.</p>
          <p><strong>ğŸ‘¤ Retiros Personales:</strong> Dinero que has tomado para uso personal (no es un gasto del negocio, pero vacÃ­a la caja).</p>
        </div>
      </div>
    </div>
  );
};

export default Estadisticas;
************************************************************

FILE: src/pages/Estadisticas.module.css
------------------------------
.container {
    padding: 20px;
    padding-bottom: 120px;
    /* Cambio: Eliminado el fondo rojo de las fuentes [1] por un blanco profesional */
    background-color: #ffffff; 
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #333;
    font-family: system-ui, -apple-system, sans-serif;
}

/* TÃ­tulo de la AnalÃ­tica */
.title {
    font-size: 1.6rem;
    color: #2c3e50;
    font-weight: 800;
    margin-bottom: 25px;
    text-align: center;
    letter-spacing: -0.5px;
}

/* El componente principal presentado en una Card Profesional */
.mainCard {
    background-color: #ffffff;
    border-radius: 20px; /* Bordes redondeados solicitados */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Sombra profesional */
    padding: 25px;
    width: 100%;
    max-width: 500px; /* Optimizado para el dispositivo Android del host Vercel [2] */
    border: 1px solid #f0f0f0;
    box-sizing: border-box;
}

/* Barra de filtros */
.filterBar {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 25px;
}

.filterLabel {
    color: #546e7a;
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
}

/* Selector de rango de fechas */
.select {
    padding: 12px 15px;
    border-radius: 12px;
    border: 2px solid #eceff1;
    font-size: 1rem;
    background-color: #f8fafc;
    color: #263238; /* Asegura visibilidad del texto solicitado en fuentes [3, 4] */
    cursor: pointer;
    transition: all 0.3s ease;
}

.select:focus {
    outline: none;
    border-color: #00BFFF; /* Azul Natura */
}

/* Bloques de ingresos (USD y BS) */
.ingresosContainer {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 30px;
}

.ingresosCard {
    background: #f1f8ff;
    padding: 15px;
    border-radius: 15px;
    text-align: center;
    border: 1px solid #e1f5fe;
}

.ingresosValue {
    display: block;
    font-size: 1.2rem;
    font-weight: 800;
    color: #007bff;
}

.ingresosLabel {
    font-size: 0.7rem;
    color: #78909c;
    font-weight: 700;
    text-transform: uppercase;
}

/* Contenedor para el grÃ¡fico de Recharts [5] */
.chartWrapper {
    margin-top: 20px;
    padding: 15px;
    background: #fafafa;
    border-radius: 15px;
    border: 1px solid #f0f0f0;
}

.chartTitle {
    font-size: 0.9rem;
    color: #455a64;
    font-weight: 700;
    margin-bottom: 15px;
    text-align: center;
}

/* Estado de carga */
.loading {
    text-align: center;
    padding: 50px;
    color: #90a4ae;
    font-weight: 500;
}
************************************************************

FILE: src/pages/GruposPage.jsx
------------------------------
// src/pages/GruposPage.jsx
import React from 'react';
import GruposCRUD from '../components/GruposCRUD/GruposCRUD';

const GruposPage = () => {
  return (
    <div>
      <GruposCRUD />
    </div>
  );
};

export default GruposPage;
************************************************************

FILE: src/pages/Home.jsx
------------------------------
import { useState, useEffect } from 'react';
import { useNavigate } from "react-router-dom";
import { db } from '../lib/db/database.js';
import { getTasaBCV } from '../lib/db/utils/tasaUtil.js';
import styles from './Home.module.css';
import FreezerLayout from "../components/FreezerLayout/FreezerLayout.jsx";

const getConstructedImagePath = (nombre) => {
    const cleanName = nombre.toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Remove accents
        .replace(/\s+/g, ""); // Remove spaces
    return `/outputs/small/${cleanName}_400.webp`;
};

const ProductImage = ({ product, className }) => {
    const [src, setSrc] = useState(product.imagen || getConstructedImagePath(product.nombre));
    const [error, setError] = useState(false);

    useEffect(() => {
        setSrc(product.imagen || getConstructedImagePath(product.nombre));
        setError(false);
    }, [product]);

    if (error) {
        return <div className={className}>ğŸ“· {product.nombre}</div>;
    }

    return (
        <img
            src={src}
            alt={product.nombre}
            className={className}
            onError={() => setError(true)}
        />
    );
};

function Home() {
    const [productos, setProductos] = useState([]);
    const [grupos, setGrupos] = useState([]);
    const [listaDeSeleccionados, setListaDeSeleccionados] = useState([]);
    const [tasa, setTasa] = useState(0);
    const [cargando, setCargando] = useState(true);
    const [filtroGrupo, setFiltroGrupo] = useState('todos');

    // Estado para controlar la visibilidad del modal del Freezer
    const [isFreezerOpen, setIsFreezerOpen] = useState(false);

    const navigate = useNavigate();

    const enriquecerProductos = (listaProductos, listaGrupos) => {
        const gruposMap = new Map(listaGrupos.map(g => [g.nombre, g]));
        return listaProductos.map(p => {
            const grupoInfo = gruposMap.get(p.grupo);
            return {
                ...p,
                precio: grupoInfo ? grupoInfo.precio : 0,
                costo: grupoInfo ? (grupoInfo.costo_$ || 0) : 0
            };
        });
    };

    useEffect(() => {
        const cargarTodo = async () => {
            try {
                await db.init();
                const [p, g, t] = await Promise.all([
                    db.getAll('productos'),
                    db.getAll('grupos'),
                    getTasaBCV()
                ]);

                setGrupos(g);
                const productosEnriquecidos = enriquecerProductos(p, g);
                setProductos(productosEnriquecidos);
                setTasa(t || 0);
            } catch (err) {
                console.error("Error initializing Home:", err);
            } finally {
                setCargando(false);
            }
        };
        cargarTodo();
    }, []);

    const productosFiltrados = productos.filter(p => {
        const coincideGrupo = filtroGrupo === 'todos' || p.grupo === filtroGrupo;
        const esVisible = p.visible !== false;
        return coincideGrupo && esVisible;
    });

    const handleVaciarLista = () => {
        if (listaDeSeleccionados.length === 0) return;
        const confirmar = window.confirm(`âš ï¸ Â¿EstÃ¡s seguro de que deseas vaciar la lista?`);
        if (confirmar) setListaDeSeleccionados([]);
    };

    const handleGrabar = async () => {
        if (listaDeSeleccionados.length === 0) return;
        const confirmar = window.confirm(`Â¿Desea procesar la venta de ${listaDeSeleccionados.length} helados?`);
        if (!confirmar) return;

        try {
            const transaccionId = `TX-${Date.now()}`;
            await db.transaction('rw', [db.ventas, db.productos], async () => {
                for (const item of listaDeSeleccionados) {
                    await db.add('ventas', {
                        productoId: item.id,
                        nombre: item.nombre,
                        grupo: item.grupo,
                        precioUsd: item.precio || 0,
                        costoUnitarioUsd: item.costo || 0,
                        utilidadUsd: (item.precio || 0) - (item.costo || 0),
                        tasaVenta: tasa,
                        transaccionId: transaccionId,
                        cantidad: 1,
                        fecha: new Date().toISOString()
                    });
                    await db.updateStock(item.id, -1);
                }
            });
            setListaDeSeleccionados([]);
            alert("âœ… Venta procesada con Ã©xito.");
        } catch (error) {
            alert("âŒ Error al procesar la venta.");
        }
    };

    const seleccionarProducto = (producto) => {
        setListaDeSeleccionados(prev => [...prev, producto]);
    };

    const eliminarItem = (indexParaEliminar) => {
        setListaDeSeleccionados(prev => prev.filter((_, index) => index !== indexParaEliminar));
    };

    const calcularTotales = () => {
        let usd = listaDeSeleccionados.reduce((acc, item) => acc + (item.precio || 0), 0);
        return { usd, bs: usd * tasa };
    };

    const { usd, bs } = calcularTotales();

    if (cargando) return <div>Cargando tienda...</div>;

    return (
        <div className={styles.container}>
            <div className={styles.filterBar}>
                <label htmlFor="filtro-home">Filtrar por Grupo:</label>
                <select
                    id="filtro-home"
                    value={filtroGrupo}
                    onChange={(e) => setFiltroGrupo(e.target.value)}
                    className={styles.select}
                >
                    <option value="todos">Todos los helados</option>
                    {grupos.map(g => (
[CONTENIDO SENSIBLE ELIMINADO EN: Home.jsx]
                    ))}
                </select>
            </div>

            <div className={styles.grid}>
                {productosFiltrados.map(p => {
                    const precio = p.precio || 0;
                    const esAgotado = p.stock === 0;
                    const badgeColor = p.stock === 0 ? '#ff4d4d' : (p.stock <= 5 ? '#ffa500' : '#28a745');
                    return (
                        <div
[CONTENIDO SENSIBLE ELIMINADO EN: Home.jsx]
                            className={`${styles.card} ${esAgotado ? styles.cardDisabled : ''}`}
                            onClick={() => !esAgotado && seleccionarProducto(p)}
                        >
                            <div className={styles.stockBadge} style={{ backgroundColor: badgeColor }}>{p.stock}</div>
                            <ProductImage product={p} className={styles.productImage} />
                            <h3 className={styles.productTitle}>{p.nombre}</h3>
                            <p className={styles.priceText}>
                                $: {precio.toFixed(2)} - Bs.: {(precio * tasa).toFixed(2)} - Stock: {p.stock}
                            </p>
                        </div>
                    );
                })}
            </div>

            <div className={styles.selectedContainer}>
                <div
                    className={styles.selectedHeader}
                    onClick={() => setIsFreezerOpen(true)}
                    style={{ cursor: 'pointer' }}
                >
                    Items: <span>{listaDeSeleccionados.length}</span>
                    Tasa: <span>{tasa.toFixed(2)}</span>
                </div>

                <div className={styles.selectedList}>
                    {listaDeSeleccionados.map((item, index) => (
[CONTENIDO SENSIBLE ELIMINADO EN: Home.jsx]
                            <span>#{item.id} - {item.nombre}</span>
                            <button onClick={() => eliminarItem(index)}>ELIM</button>
                        </div>
                    ))}
                </div>

                <div className={styles.totalRow}>
                    Total: ${usd.toFixed(2)} | Bs. {bs.toFixed(2)}
                </div>

                <div className={styles.actionButtons}>
                    <button className={styles.vaciarBtn} onClick={handleVaciarLista}>Vaciar</button>
                    <button className={styles.grabarBtn} onClick={handleGrabar} disabled={listaDeSeleccionados.length === 0}>
                        Grabar
                    </button>

                    <button
                        className={styles.ubicarBtn}
                        onClick={() => setIsFreezerOpen(true)}
                    >
                        Ubicar
                    </button>
                </div>
            </div>

            {isFreezerOpen && (
                <div className={styles.modalOverlay} onClick={() => setIsFreezerOpen(false)}>
                    <div className={styles.modalContent} onClick={(e) => e.stopPropagation()}>
                        <div className={styles.modalHeader}>
                            <h3 className={styles.modalTitle}>UBICACIÃ“N EN FREEZER</h3>
                            <button
                                className={styles.closeModalBtn}
                                onClick={() => setIsFreezerOpen(false)}
                            >
                                Ã—
                            </button>
                        </div>
                        <div className={styles.modalBody}>
                            <FreezerLayout productosSeleccionados={listaDeSeleccionados} />
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
}

export default Home;
************************************************************

FILE: src/pages/Home.module.css
------------------------------
.container {
    padding: 15px;
    padding-bottom: 280px;
    /* Espacio para el panel fijo inferior */
    background-color: #fafafa;
    min-height: 100dvh;
    width: 100%;
    box-sizing: border-box;
    color: #333;
}

.filterBar {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 20px;
    padding: 0 5px;
    color: #2c3e50;
    font-weight: bold;
}

.select {
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-size: 18px;
    background-color: #00BFFF;
    /* Azul Natura */
    color: #fff;
    font-weight: bold;
    text-align: center;
    width: 100%;
    box-sizing: border-box;
}

.grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
    width: 100%;
}

.card {
    position: relative;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    padding: 15px;
    cursor: pointer;
    transition: transform 0.2s;
    touch-action: manipulation;
}

.card:active {
    transform: scale(0.98);
}

.stockBadge {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    border: 2px solid #fff;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    z-index: 10;
}

.cardDisabled {
    opacity: 0.6;
    filter: grayscale(1);
    cursor: not-allowed !important;
}

.productImage {
    width: 100%;
    height: auto;
    border-radius: 8px;
    margin-bottom: 10px;
}

.productTitle {
    font-size: 1.1rem;
    font-weight: bold;
    margin: 0 0 5px 0;
    color: #2c3e50;
}

.priceText {
    color: #28a745;
    font-weight: bold;
    font-size: 0.9rem;
}

/* Panel de selecciÃ³n fijo en la base */
.selectedContainer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #fff;
    padding: 15px;
    border-top: 3px solid #00BFFF;
    box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.15);
    z-index: 9999;
    width: 100%;
    box-sizing: border-box;
}

.selectedHeader {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
    font-size: 1rem;
    padding: 5px 0;
}

.selectedList {
    max-height: 120px;
    overflow-y: auto;
    margin-bottom: 10px;
}

.selectedItem {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    background-color: #f8f9fa;
    margin-bottom: 5px;
    border-radius: 6px;
    color: #000;
    font-size: 0.9rem;
}

.eliminarBtn {
    background-color: #ffeded;
    color: #f44336;
    border: 1px solid #f44336;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: bold;
    cursor: pointer;
}

.totalRow {
    font-size: 1.2rem;
    font-weight: 800;
    text-align: center;
    margin: 10px 0;
    color: #007bff;
    background-color: #eef6ff;
    padding: 8px;
    border-radius: 8px;
}

/* Botonera de acciones */
.actionButtons {
    display: flex;
    gap: 8px;
}

.vaciarBtn,
.grabarBtn,
.ubicarBtn {
    flex: 1;
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    text-transform: uppercase;
    transition: opacity 0.2s;
}

.vaciarBtn {
    background-color: #f44336;
    color: white;
}

.grabarBtn {
    background-color: #28a745;
    color: white;
}

.ubicarBtn {
    background-color: #00BFFF;
    color: white;
}

.grabarBtn:disabled {
    background-color: #ccc;
    cursor: not-allowed;
}

/* Estilos del Modal para FreezerLayout */
.modalOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 20000;
    /* Por encima del panel inferior */
}

.modalContent {
    background-color: #fff;
    width: 92%;
    max-width: 480px;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}

.modalHeader {
    padding: 12px 15px;
    background-color: #00BFFF;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modalTitle {
    margin: 0;
    color: white;
    font-size: 15px;
    font-weight: 800;
    letter-spacing: 0.5px;
}

.closeModalBtn {
    background: none;
    border: none;
    color: white;
    font-size: 32px;
    cursor: pointer;
    line-height: 1;
    padding: 0;
}

.modalBody {
    padding: 20px;
    display: flex;
    justify-content: center;
    background-color: #f0f2f5;
    min-height: 200px;
    max-height: 70vh;
    /* Limita la altura mÃ¡xima al 70% del viewport */
    overflow-y: auto;
    /* Habilita scroll vertical */
}
************************************************************

FILE: src/pages/Lista.jsx
------------------------------
import { useLocalStorageList } from "../hooks/useLocalStorageList";

function Lista() {
  const { data } = useLocalStorageList("productos", []);

  return (
    <div>
      <h2>Lista de Helados</h2>

      <div style={{ display: "flex", flexWrap: "wrap", gap: "1rem" }}>
        {data.map((producto) => (
[CONTENIDO SENSIBLE ELIMINADO EN: Lista.jsx]
            <img
              src={producto.imagen}
              alt={producto.nombre}
              style={{ width: "100%", borderRadius: "8px" }}
            />
            <p>{producto.nombre}</p>
            <small>{producto.grupo}</small>
          </div>
        ))}
      </div>
    </div>
  );
}

export default Lista;

************************************************************

FILE: src/pages/NotFound.jsx
------------------------------
export default function NotFound() {
  return <h1>404 - PÃ¡gina no encontrada</h1>;
}

************************************************************

FILE: src/pages/Pedidos.jsx
------------------------------
// src/pages/Pedidos.jsx
import React from 'react';
import PedidosComponente from '../components/Pedidos';

const PedidosPage = () => {
  return (
    <main>
      <PedidosComponente />
    </main>
  );
};

export default PedidosPage;
************************************************************

FILE: src/pages/ProductosPage.jsx
------------------------------
// src/pages/ProductosPage.jsx
import React from 'react';
import ProductosCRUD from '../components/ProductosCRUD/ProductosCRUD';

const ProductosPage = () => {
  return (
    <div>
      <ProductosCRUD />
    </div>
  );
};

export default ProductosPage;
************************************************************

FILE: src/pages/TasaBCV.jsx
------------------------------
import { useState, useEffect } from 'react';
import { db } from "../lib/db/database"; 
import styles from './TasaBCV.module.css';

export default function TasaBCV() {
  const [historico, setHistorico] = useState([]);
  const [loading, setLoading] = useState(true);
  const [editandoId, setEditandoId] = useState(null);
  
  // Estado para el formulario (Add/Edit)
  const [formData, setFormData] = useState({
    fecha_tasa: new Date().toISOString().split('T'),
    tasa: ''
  });
  
  const [message, setMessage] = useState('');

  // 1. READ: Cargar historial al iniciar
  useEffect(() => {
    cargarHistorico();
  }, []);

  const cargarHistorico = async () => {
    try {
      setLoading(true);
      // Consulta directa a la tabla de historial
      const datos = await db.getAll('historico_tasas');
      // Ordenar por fecha descendente para mostrar lo mÃ¡s nuevo arriba
      setHistorico(datos.sort((a, b) => new Date(b.fecha_tasa) - new Date(a.fecha_tasa)));
    } catch (err) {
      console.error("Error cargando historial:", err);
    } finally {
      setLoading(false);
    }
  };

  // 2. CREATE / UPDATE
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!formData.tasa || !formData.fecha_tasa) return;

    const dataToSave = {
      fecha_tasa: formData.fecha_tasa,
      tasa: parseFloat(formData.tasa)
    };

    try {
      if (editandoId) {
        // OperaciÃ³n de actualizaciÃ³n (Update)
        await db.put('historico_tasas', { ...dataToSave, id: editandoId });
        setMessage('âœ… Registro actualizado');
      } else {
        // OperaciÃ³n de creaciÃ³n (Create)
        await db.add('historico_tasas', dataToSave);
        setMessage('âœ… Nueva tasa agregada');
      }
      
      resetForm();
      cargarHistorico();
      setTimeout(() => setMessage(''), 3000);
    } catch (err) {
      setMessage('âŒ Error al guardar');
    }
  };

  // 3. DELETE
  const handleEliminar = async (id) => {
    if (window.confirm("Â¿Deseas eliminar este registro de forma permanente?")) {
      await db.del('historico_tasas', id);
      cargarHistorico();
    }
  };

  const startEdit = (reg) => {
    setEditandoId(reg.id);
    setFormData({ 
      fecha_tasa: reg.fecha_tasa, 
      tasa: reg.tasa.toString() 
    });
  };

  const resetForm = () => {
    setEditandoId(null);
    setFormData({ 
      fecha_tasa: new Date().toISOString().split('T'), 
      tasa: '' 
    });
  };

  if (loading) return <div className={styles.loading}>Cargando historial...</div>;

  return (
    <div className={styles.container}>
      {/* Encabezado con estilo GestionPedido */}
      <div className={styles.header}>
        <h2 className={styles.title}>ğŸ“ˆ GESTIÃ“N DE TASAS BCV</h2>
      </div>

      <div className={styles.content}>
        {/* Formulario CRUD */}
        <form onSubmit={handleSubmit}>
          <div className={styles.topRow}>
            <div className={styles.inputGroup}>
              <label className={styles.label}>Fecha de Tasa</label>
              <input 
                type="date" 
                value={formData.fecha_tasa} 
                onChange={(e) => setFormData({...formData, fecha_tasa: e.target.value})}
                className={styles.inputSmall}
              />
            </div>
            <div className={styles.inputGroup}>
              <label className={styles.label}>Valor Tasa (Bs.)</label>
              <input 
                type="number" 
                step="0.01" 
                value={formData.tasa} 
                onChange={(e) => setFormData({...formData, tasa: e.target.value})}
                placeholder="0.00"
                className={styles.inputSmall}
              />
            </div>
          </div>

          <div className={styles.footer}>
            <button type="submit" className={styles.grabarBtn}>
              {editandoId ? "ACTUALIZAR" : "GRABAR"}
            </button>
            {editandoId && (
              <button type="button" onClick={resetForm} className={styles.limpiarBtn}>
                CANCELAR
              </button>
            )}
          </div>
          {message && <div className={styles.infoBar}>{message}</div>}
        </form>

        {/* Listado de Datos con estilo Product List */}
        <div className={styles.productListContainer}>
          <div className={styles.productListHeader}>REGISTROS EN HISTORICO</div>
          <div className={styles.productList}>
            {historico.length === 0 ? (
              <div className={styles.productName} style={{ textAlign: 'center', padding: '20px' }}>
                No hay registros en el historial.
              </div>
            ) : (
              historico.map(reg => (
[CONTENIDO SENSIBLE ELIMINADO EN: TasaBCV.jsx]
                  <div className={styles.productName}>
                    <strong>{reg.fecha_tasa}</strong> â€” Bs. {reg.tasa.toFixed(2)}
                  </div>
                  <div className={styles.quantityControl}>
                    <button 
                      onClick={() => startEdit(reg)} 
                      className={styles.qtyBtn}
                      title="Editar"
                    >
                      âœï¸
                    </button>
                    <button 
                      onClick={() => handleEliminar(reg.id)} 
                      className={styles.qtyBtn}
                      style={{ color: '#f44336' }}
                      title="Eliminar"
                    >
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
************************************************************

FILE: src/pages/TasaBCV.module.css
------------------------------

.container {
    background-color: #fff;
    width: 95%;
    max-width: 500px;
    margin: 20px auto;
    padding: 15px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    font-family: system-ui, -apple-system, sans-serif;
}

.header {
    display: flex;
    justify-content: center;
    align-items: center;
    border-bottom: 2px solid #00BFFF;
    margin-bottom: 10px;
    padding-bottom: 5px;
}

.title {
    font-size: 16px;
    font-weight: bold;
    color: #000;
    text-transform: uppercase;
}

.content {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.topRow {
    display: flex;
    gap: 10px;
}

.inputGroup {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.label {
    font-size: 14px;
    font-weight: bold;
    color: #000;
    margin-bottom: 5px;
}

.inputSmall {
    padding: 10px;
    border-radius: 4px;
    width: 100%;
    box-sizing: border-box;
    font-size: 16px;
    background-color: #00BFFF; /* Azul Natura */
    color: white;
    font-weight: bold;
    text-align: center;
    border: 1px solid #aaa;
}

.inputSmall:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.3);
}

.footer {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

.grabarBtn, .limpiarBtn {
    flex: 1;
    padding: 14px;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    text-align: center;
}

.grabarBtn {
    background-color: #28a745;
    color: white;
}

.limpiarBtn {
    background-color: #f44336;
    color: white;
}

.infoBar {
    text-align: center;
    font-weight: bold;
    color: #000;
    font-size: 13px;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    margin-top: 5px;
}

/* Estilos de la lista de registros (Estilo Product List) */

.productListContainer {
    border: 1px solid #aaa;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 20px;
}

.productListHeader {
    text-align: center;
    background-color: #00BFFF;
    color: white;
    padding: 8px;
    font-weight: bold;
    font-size: 14px;
}

.productList {
    max-height: 350px;
    overflow-y: auto;
    background-color: #fff;
}

.productItem {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
}

.productName {
    color: #000;
    font-size: 14px;
    flex: 1;
}

.quantityControl {
    display: flex;
    align-items: center;
    gap: 10px;
}

.qtyBtn {
    width: 36px;
    height: 36px;
    background-color: #eee;
    border: 1px solid #ccc;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 18px;
    transition: background-color 0.2s;
}

.qtyBtn:active {
    background-color: #ddd;
}

.loading {
    text-align: center;
    padding: 40px;
    color: #666;
    font-weight: bold;
}
************************************************************

FILE: test_db_check.js
------------------------------

const { NaturaDBClass } = require('./src/lib/db/database.js');
// This is for local execution in the environment if possible, 
// but since it's browser-based with Dexie, I can't run it easily in node without polyfills.
// I'll try to look at the code more or use a different approach.

************************************************************

FILE: validacion_resumen_inventario.js
------------------------------
/**
 * Script de ValidaciÃ³n para Resumen de Inventario
 * 
 * Ejecutar en DevTools Console (F12) despuÃ©s de navegar a la pÃ¡gina de Resumen de Inventario
 * 
 * Este script valida:
 * 1. Productos huÃ©rfanos (sin grupo vÃ¡lido)
 * 2. Grupos con margen negativo
 * 3. Tasa BCV vÃ¡lida (no cero)
 * 4. Productos ocultos excluidos del cÃ¡lculo
 * 5. PrecisiÃ³n de los cÃ¡lculos financieros
 */

const validarResumenInventario = async () => {
    console.clear();
    console.log('%cğŸ“Š AUDITORÃA DE RESUMEN DE INVENTARIO', 'font-size: 18px; font-weight: bold; color: #2196F3');
    console.log('='.repeat(60));

    try {
        await db.init();

        const todosProductos = await db.productos.toArray();
        const grupos = await db.grupos.toArray();
        const gruposMap = new Map(grupos.map(g => [g.nombre, g]));

        // 1. ANÃLISIS DE PRODUCTOS
        console.log('\n%c1ï¸âƒ£ ANÃLISIS DE PRODUCTOS', 'font-weight: bold; color: #4CAF50');
        console.log('-'.repeat(60));

        const productosVisibles = todosProductos.filter(p => p.visible !== false);
        const productosOcultos = todosProductos.filter(p => p.visible === false);

        console.log(`Total de productos en BD: ${todosProductos.length}`);
        console.log(`âœ… Productos visibles (incluidos): ${productosVisibles.length}`);
        console.log(`âŒ Productos ocultos (excluidos): ${productosOcultos.length}`);

        if (productosOcultos.length > 0) {
            console.log('\n%cProductos excluidos del anÃ¡lisis:', 'color: #FF9800');
            productosOcultos.forEach(p => {
                console.log(`  - ${p.nombre} (Stock: ${p.stock || 0})`);
            });
        }

        // 2. PRODUCTOS HUÃ‰RFANOS
        console.log('\n%c2ï¸âƒ£ PRODUCTOS HUÃ‰RFANOS (sin grupo vÃ¡lido)', 'font-weight: bold; color: #FF5722');
        console.log('-'.repeat(60));

        const huerfanos = productosVisibles.filter(p => !gruposMap.has(p.grupo) && p.stock > 0);

        if (huerfanos.length === 0) {
            console.log('âœ… No hay productos huÃ©rfanos con stock');
        } else {
            console.log(`ğŸ”´ ADVERTENCIA: ${huerfanos.length} producto(s) con stock pero sin grupo vÃ¡lido:`);
            huerfanos.forEach(p => {
                console.log(`  - ID: ${p.id} | Nombre: ${p.nombre} | Grupo: "${p.grupo}" | Stock: ${p.stock}`);
            });
            console.log('\nâš ï¸ Estos productos NO se incluyen en el cÃ¡lculo financiero');
        }

        // 3. GRUPOS CON MARGEN NEGATIVO
        console.log('\n%c3ï¸âƒ£ VALIDACIÃ“N DE MÃRGENES', 'font-weight: bold; color: #9C27B0');
        console.log('-'.repeat(60));

        const margenNegativo = grupos.filter(g => g.costo_$ > g.precio);

        if (margenNegativo.length === 0) {
            console.log('âœ… Todos los grupos tienen margen positivo');
        } else {
            console.log(`âš ï¸ ADVERTENCIA: ${margenNegativo.length} grupo(s) con margen negativo:`);
            margenNegativo.forEach(g => {
                const margen = ((g.precio - g.costo_$) / g.costo_$ * 100).toFixed(2);
                console.log(`  - ${g.nombre}: Costo $${g.costo_$} > Precio $${g.precio} (Margen: ${margen}%)`);
            });
        }

        // 4. TASA BCV
        console.log('\n%c4ï¸âƒ£ TASA BCV', 'font-weight: bold; color: #00BCD4');
        console.log('-'.repeat(60));

        const tasa = await db.getUltimaTasaBCV();
        const ultimaEntrada = await db.historico_tasas.orderBy('fecha_tasa').last();

        if (tasa === 0) {
            console.log('ğŸ”´ ERROR CRÃTICO: La tasa BCV es 0');
        } else {
            console.log(`âœ… Tasa BCV vÃ¡lida: ${tasa.toFixed(2)}`);
            if (ultimaEntrada) {
                console.log(`   Fecha: ${ultimaEntrada.fecha_tasa}`);
                console.log(`   Fuente: HistÃ³rico BCV`);
            } else {
                console.log(`   Fuente: ConfiguraciÃ³n o fallback`);
            }
        }

        // 5. CÃLCULOS FINANCIEROS
        console.log('\n%c5ï¸âƒ£ CÃLCULOS FINANCIEROS', 'font-weight: bold; color: #4CAF50');
        console.log('-'.repeat(60));

        let totalCosto = 0;
        let totalVenta = 0;
        let productosContabilizados = 0;

        productosVisibles.forEach(p => {
            const grupo = gruposMap.get(p.grupo);
            if (grupo) {
                const stock = p.stock || 0;
                totalCosto += stock * (grupo.costo_$ || 0);
                totalVenta += stock * (grupo.precio || 0);
                if (stock > 0) productosContabilizados++;
            }
        });

        const gananciaUsd = totalVenta - totalCosto;
        const gananciaBs = gananciaUsd * tasa;
        const margenPromedio = totalCosto > 0 ? ((gananciaUsd / totalCosto) * 100) : 0;

        console.log(`Productos contabilizados: ${productosContabilizados}`);
        console.log(`\nğŸ’° InversiÃ³n Total (Costo): $${totalCosto.toFixed(2)}`);
        console.log(`ğŸ’µ Venta Estimada: $${totalVenta.toFixed(2)}`);
        console.log(`ğŸ“ˆ Ganancia Potencial USD: $${gananciaUsd.toFixed(2)}`);
        console.log(`ğŸ“ˆ Ganancia Potencial Bs: Bs. ${gananciaBs.toLocaleString('es-VE', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`);
        console.log(`ğŸ“Š Margen Promedio: ${margenPromedio.toFixed(2)}%`);

        // 6. RESUMEN DE VALIDACIÃ“N
        console.log('\n%c6ï¸âƒ£ RESUMEN DE VALIDACIÃ“N', 'font-weight: bold; color: #E91E63');
        console.log('='.repeat(60));

        const problemas = [];

        if (huerfanos.length > 0) {
            problemas.push(`ğŸ”´ ${huerfanos.length} producto(s) huÃ©rfano(s)`);
        }
        if (margenNegativo.length > 0) {
            problemas.push(`âš ï¸ ${margenNegativo.length} grupo(s) con margen negativo`);
        }
        if (tasa === 0) {
            problemas.push(`ğŸ”´ Tasa BCV es 0`);
        }

        if (problemas.length === 0) {
            console.log('%câœ… VALIDACIÃ“N EXITOSA: No se detectaron problemas', 'color: #4CAF50; font-weight: bold');
        } else {
            console.log('%câš ï¸ SE DETECTARON PROBLEMAS:', 'color: #FF5722; font-weight: bold');
            problemas.forEach(p => console.log(`   ${p}`));
        }

        console.log('\n' + '='.repeat(60));
        console.log('%câœ… AuditorÃ­a completada', 'font-size: 14px; color: #4CAF50');

        // Retornar objeto con resultados para uso programÃ¡tico
        return {
            totalProductos: todosProductos.length,
            productosVisibles: productosVisibles.length,
            productosOcultos: productosOcultos.length,
            productosHuerfanos: huerfanos.length,
            gruposConMargenNegativo: margenNegativo.length,
            tasaBCV: tasa,
            totales: {
                costo: totalCosto,
                venta: totalVenta,
                gananciaUsd: gananciaUsd,
                gananciaBs: gananciaBs,
                margenPromedio: margenPromedio
            },
            problemas: problemas
        };

    } catch (error) {
        console.error('âŒ Error durante la auditorÃ­a:', error);
        throw error;
    }
};

// Ejecutar automÃ¡ticamente
console.log('%cğŸš€ Ejecutando validaciÃ³n...', 'color: #2196F3; font-weight: bold');
validarResumenInventario().then(resultado => {
    console.log('\n%cğŸ“‹ Resultado guardado en variable "resultado"', 'color: #9C27B0');
    window.resultadoAuditoria = resultado;
});

************************************************************

FILE: vite.config.js
------------------------------
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { VitePWA } from 'vite-plugin-pwa'

// https://vite.dev/config/
export default defineConfig({
  plugins: [
    react({
      babel: {
        plugins: [['babel-plugin-react-compiler']],
      },
    }),
    VitePWA({
      registerType: 'autoUpdate',
      includeAssets: ['favicon.ico', 'apple-touch-icon.png', 'mask-icon.svg'],
      manifest: {
        name: 'Natura Helados',
        short_name: 'Natura',
        description: 'Venta de Helados Offline',
        theme_color: '#ffffff',
        icons: [
          {
            src: 'pwa-192x192.png',
            sizes: '192x192',
            type: 'image/png'
          },
          {
            src: 'pwa-512x512.png',
            sizes: '512x512',
            type: 'image/png'
          }
        ]
      },
      workbox: {
        runtimeCaching: [
          {
            urlPattern: ({ url }) => url.pathname.startsWith('/outputs/'),
            handler: 'CacheFirst',
            options: {
              cacheName: 'images-cache',
              expiration: {
                maxEntries: 100,
                maxAgeSeconds: 60 * 60 * 24 * 30 // 30 Days
              },
              cacheableResponse: {
                statuses: [0, 200]
              }
            }
          }
        ]
      }
    })
  ],
})



************************************************************