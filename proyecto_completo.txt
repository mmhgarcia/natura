ESTRUCTURA DEL PROYECTO: natura
============================================================

--- √ÅRBOL DE DIRECTORIOS ---
üìÅ .vercel/
  üìÑ README.txt
  üìÑ project.json
üìÑ README.md
üìÑ eslint.config.js
üìÑ index.html
üìÑ package.json
üìÑ project_reader.py
üìÅ public/
  üìÅ outputs/
    üìÅ small/
üìÅ src/
  üìÑ App.css
  üìÑ App.jsx
  üìÅ assets/
  üìÅ components/
    üìÑ Delivery.jsx
    üìÑ Footer.jsx
    üìÑ GestionPedido.jsx
    üìÑ GestionPedido.module.css
    üìÅ GruposCRUD/
      üìÑ GruposCRUD.jsx
      üìÑ ModalGrupo.jsx
    üìÑ Header.jsx
    üìÅ Panel/
      üìÑ Panel.jsx
      üìÑ Panel.module.css
      üìÅ hooks/
        üìÑ useGrupos.js
        üìÑ useProductos.jsx
    üìÑ Pedidos.jsx
    üìÑ Pedidos.module.css
    üìÅ ProductosCRUD/
      üìÑ ModalProducto.jsx
      üìÑ ProductosCRUD.jsx
    üìÑ RegistroGasto.jsx
    üìÑ RegistroGasto.module.css
    üìÑ ResumenInventario.jsx
    üìÑ ResumenInventario.module.css
    üìÑ Sidebar.jsx
    üìÑ TasaImporter.jsx
    üìÑ TasaList.jsx
  üìÅ data/
    üìÑ data.json
    üìÑ grupos.json
  üìÅ hooks/
    üìÑ useLocalStorageList.js
  üìÑ index.css
  üìÅ lib/
    üìÅ db/
      üìÑ database.js
      üìÅ hooks/
        üìÑ useDelivery.js
        üìÑ useTasa.js
        üìÑ useTasaBCV.js
      üìÑ index.js
      üìÅ repositories/
        üìÑ DeliveryRepository.js
        üìÑ RepoRecommStructure.js
        üìÑ TasaRepository.js
      üìÅ schemas/
      üìÅ utils/
        üìÑ Importer.js
        üìÑ deliveryUtil.js
        üìÑ exportService.js
        üìÑ migrationService.js
        üìÑ tasaUtil.js
    üìÅ types/
  üìÑ main.jsx
  üìÅ pages/
    üìÑ About.jsx
    üìÑ Admin.module.css
    üìÑ DeliveryPage.jsx
    üìÑ Estadisticas.jsx
    üìÑ Estadisticas.module.css
    üìÑ GruposPage.jsx
    üìÑ Home.jsx
    üìÑ Home.module.css
    üìÑ Lista.jsx
    üìÑ NotFound.jsx
    üìÑ Pedidos.jsx
    üìÑ ProductosPage.jsx
    üìÑ TasaBCV.jsx
    üìÑ TasaBCV.module.css
üìÑ vite.config.js

============================================================

--- CONTENIDO DE ARCHIVOS (SANITIZADO) ---

FILE: .vercel/README.txt
------------------------------
> Why do I have a folder named ".vercel" in my project?
The ".vercel" folder is created when you link a directory to a Vercel project.

> What does the "project.json" file contain?
The "project.json" file contains:
- The ID of the Vercel project that you linked ("projectId")
- The ID of the user or team your Vercel project is owned by ("orgId")

> Should I commit the ".vercel" folder?
No, you should not share the ".vercel" folder with anyone.
Upon creation, it will be automatically added to your ".gitignore" file.

************************************************************

FILE: .vercel/project.json
------------------------------
{"projectId":"prj_hjReYCHTcKVrtd3weTmPa3dKTGQl","orgId":"team_esiDhEy9BSjEtp80YsKI8dmT","projectName":"natura"}
************************************************************

FILE: README.md
------------------------------
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is enabled on this template. See [this documentation](https://react.dev/learn/react-compiler) for more information.

Note: This will impact Vite dev & build performances.

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.

************************************************************

FILE: eslint.config.js
------------------------------
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

************************************************************

FILE: index.html
------------------------------
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>natura</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

************************************************************

FILE: package.json
------------------------------
{
  "name": "natura",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "dexie": "^4.2.1",
    "dexie-export-import": "^4.1.4",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.10.1",
    "recharts": "^3.6.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "babel-plugin-react-compiler": "^1.0.0",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4"
  }
}

************************************************************

FILE: project_reader.py
------------------------------
import os
import shutil
import sys
from pathlib import Path

# --- CONFIGURACI√ìN DE EXCLUSIONES ---
IGNORE_DIRS = {
    '.git', 'node_modules', 'dist', 'build', '.next',
    '__pycache__', 'env', 'venv', '.idea', '.vscode'
}
IGNORE_FILES = {
    '.DS_Store', '.env', '.env.*', 'package-lock.json',
    'yarn.lock', 'pnpm-lock.yaml', '*.log', '*.pid'
}
ALLOWED_EXTENSIONS = {
    '.js', '.jsx', '.ts', '.tsx', '.css', '.scss',
    '.html', '.json', '.md', '.py', '.txt', '.yml', '.yaml'
}
MAX_FILE_SIZE = 1024 * 1024  # 1MB
[CONTENIDO SENSIBLE ELIMINADO EN: project_reader.py]

def should_ignore(path: Path, root: Path) -> bool:
    """Determina si un archivo/directorio debe ser omitido."""
    for part in path.parts:
        if part in IGNORE_DIRS:
            return True
    for pattern in IGNORE_FILES:
        if pattern.startswith('*') and path.name.endswith(pattern[1:]):
            return True
        elif path.name == pattern:
            return True
    if path.is_file() and path.suffix not in ALLOWED_EXTENSIONS:
        return True
    return False

def sanitize_content(content: str, filepath: str) -> str:
    """Detecta y oculta l√≠neas con patrones de datos sensibles."""
    lines = content.split('\n')
    sanitized = []
    for line in lines:
        lower_line = line.lower()
        if any(pattern in lower_line for pattern in SENSITIVE_PATTERNS):
            sanitized.append(f"[CONTENIDO SENSIBLE ELIMINADO EN: {filepath}]")
            continue
        sanitized.append(line)
    return '\n'.join(sanitized)

def count_words_in_file(filepath: str) -> int:
    """Cuenta el n√∫mero total de palabras en el archivo generado."""
    try:
        path = Path(filepath)
        content = path.read_text(encoding='utf-8', errors='ignore')
        words = content.split()
        return len(words)
    except Exception as e:
        print(f"‚ö†Ô∏è No se pudo realizar el conteo de palabras: {e}")
        return 0

def generate_project_summary(root_path: Path, output_file: str):
    """Genera un archivo consolidado con la estructura y contenido del proyecto."""
    root = Path(root_path).resolve()
    output_path = Path(output_file).resolve()

    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(f"ESTRUCTURA DEL PROYECTO: {root.name}\n")
        f.write("=" * 60 + "\n\n")
        
        f.write("--- √ÅRBOL DE DIRECTORIOS ---\n")
        dir_structure = []
        file_contents = []
        
        for path in sorted(root.rglob('*')):
            if should_ignore(path, root) or path.resolve() == output_path:
                continue
            
            relative_path = path.relative_to(root)
            depth = len(relative_path.parts) - 1
            indent = '  ' * depth
            
            if path.is_dir():
                dir_structure.append(f"{indent}üìÅ {path.name}/")
            else:
                dir_structure.append(f"{indent}üìÑ {path.name}")
                
                try:
                    file_size = path.stat().st_size
                    if file_size > MAX_FILE_SIZE:
                        content_block = f"\nFILE: {relative_path}\n" + "-"*30 + \
                                        f"\n[ARCHIVO EXCEDE L√çMITE DE TAMA√ëO: {file_size} bytes]\n"
                    else:
                        raw_content = path.read_text(encoding='utf-8', errors='ignore')
                        sanitized = sanitize_content(raw_content, path.name)
                        content_block = f"\nFILE: {relative_path}\n" + "-"*30 + f"\n{sanitized}\n"
                    
                    file_contents.append(content_block + "*"*60)
                except Exception as e:
                    file_contents.append(f"\n[ERROR procesando {relative_path}: {e}]\n" + "*"*60)
        
        f.write('\n'.join(dir_structure))
        f.write("\n\n" + "=" * 60 + "\n\n")
        f.write("--- CONTENIDO DE ARCHIVOS (SANITIZADO) ---\n")
        f.write('\n'.join(file_contents))

def copy_to_destination(source_name: str, destination_dir: str):
    """Copia el archivo generado a la carpeta compartida especificada."""
    source_path = Path(source_name).resolve()
    target_folder = Path(destination_dir)

    if not source_path.exists():
        print(f"‚ùå Error: El archivo fuente {source_name} no existe.")
        return

    if not target_folder.exists():
        print(f"‚ö†Ô∏è Aviso: La carpeta de destino '{destination_dir}' no existe o no est√° montada.")
        return

    try:
        final_destination = target_folder / source_name
        shutil.copy2(source_path, final_destination)
        print(f"üöÄ Copia exitosa a: {final_destination}")
    except PermissionError:
        print(f"üö´ Error de permisos: No se pudo escribir en '{destination_dir}'.")
    except Exception as e:
        print(f"‚ùå Error durante la copia: {e}")

def main():
    current_dir = Path.cwd()
    output_filename = "proyecto_completo.txt"
    shared_folder = "/media/sf_sfPaleteria/natura/"

    print(f"üöÄ Iniciando an√°lisis en: {current_dir}")
    confirm = input("¬øDesea proceder? (s/n): ").strip().lower()
    
    if confirm != 's':
        print("Operaci√≥n abortada.")
        return

    try:
        # 1. Generar el resumen
        generate_project_summary(current_dir, output_filename)
        print(f"‚úÖ Resumen generado: {output_filename}")
        
        # 2. Contar palabras (Nueva funcionalidad)
        word_count = count_words_in_file(output_filename)
        print("-" * 30)
        print(f"üìä ESTAD√çSTICAS DEL ARCHIVO:")
        print(f"   Total de palabras: {word_count:,}/500.000")
        print("-" * 30)
        
        # 3. Copiar a destino
        print(f"üì¶ Copiando a carpeta compartida...")
        copy_to_destination(output_filename, shared_folder)
        
    except Exception as e:
        print(f"üí• Error cr√≠tico en la ejecuci√≥n: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()
************************************************************

FILE: src/App.css
------------------------------
#root {
  width: 100%;         /* Asegura que el root ocupe todo el ancho */
  max-width: 100%;     /* Elimina el l√≠mite de 1280px si existiera */
  margin: 0;           /* Elimina el margin: 0 auto */
  padding: 0;          /* ELIMINA el padding: 2rem que causa el recorte */
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

************************************************************

FILE: src/App.jsx
------------------------------
import { Routes, Route } from "react-router-dom";
import Home from "./pages/Home";
import Lista from "./pages/Lista";
import About from "./pages/About";
import NotFound from "./pages/NotFound";
import Panel from "./components/Panel/Panel";
import TasaBCV from "./pages/TasaBCV";
import Header from "./components/Header";
import Footer from "./components/Footer";
import GruposPage from './pages/GruposPage';
import ProductosPage from './pages/ProductosPage';
// Nueva importaci√≥n de la p√°gina de Pedidos
import PedidosPage from './pages/Pedidos'; 
// Aseg√∫rate de tener esto:
import DeliveryPage from './pages/DeliveryPage';
import Estadisticas from "./pages/Estadisticas";
import ResumenInventario from "./components/ResumenInventario";
import RegistroGasto from "./components/RegistroGasto";

function App() {
  return (
    <>
      <Header />
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/lista" element={<Lista />} />
        <Route path="/about" element={<About />} />
        <Route path="/Panel" element={<Panel />} />
        <Route path="/tasabcv" element={<TasaBCV />} />
        <Route path="/admingrupos" element={<GruposPage />} />
        <Route path="/adminproductos" element={<ProductosPage />} />
        <Route path="/delivery" element={<DeliveryPage />} />
        <Route path="/estadisticas" element={<Estadisticas />} />
        <Route path="/resumeninventario" element={<ResumenInventario />} />
        <Route path="/registrogasto" element={<RegistroGasto />} />
        {/* Nueva ruta para Pedidos */}
        <Route path="/pedidos" element={<PedidosPage />} />
        <Route path="*" element={<NotFound />} />
      </Routes>
      <Footer />
    </>
  );
}

export default App;
************************************************************

FILE: src/components/Delivery.jsx
------------------------------
// Gestiona el parametro de sistema: Delivery
import React, { useState, useEffect } from 'react';
import { db } from '../lib/db/database';

const Delivery = () => {
  const [costoDelivery, setCostoDelivery] = useState('');
  const [loading, setLoading] = useState(true);
  const [guardando, setGuardando] = useState(false);
  const [mensaje, setMensaje] = useState('');

  // Cargar costo de delivery al inicio
  useEffect(() => {
    cargarDelivery();
  }, []);

  const cargarDelivery = async () => {
    try {
      setLoading(true);
      // Buscar en la tabla 'config' donde clave = 'delivery'
      const config = await db.get('config', 'delivery');
      
      if (config && config.valor !== undefined) {
        setCostoDelivery(String(config.valor));
      } else {
        setCostoDelivery(''); // Vac√≠o si no existe
      }
      setMensaje('');
    } catch (error) {
      console.error('Error cargando delivery:', error);
      setMensaje('‚ùå Error al cargar el costo de delivery');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    let valor = e.target.value;
    
    // Permitir solo n√∫meros y un punto decimal
    valor = valor.replace(/[^0-9.]/g, '');
    
    // Asegurar solo un punto decimal
    const puntos = valor.split('.').length - 1;
    if (puntos > 1) {
      const partes = valor.split('.');
      valor = partes[0] + '.' + partes.slice(1).join('');
    }
    
    setCostoDelivery(valor);
    setMensaje(''); // Limpiar mensaje al cambiar
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!costoDelivery.trim()) {
      setMensaje('‚ö†Ô∏è Ingresa un valor para el delivery');
      return;
    }

    // Convertir a n√∫mero para validaci√≥n
    const valorNumero = parseFloat(costoDelivery.replace(',', '.'));
    
    if (isNaN(valorNumero) || valorNumero < 0) {
      setMensaje('‚ùå Ingresa un n√∫mero v√°lido (mayor o igual a 0)');
      return;
    }

    setGuardando(true);
    setMensaje('üíæ Guardando...');

    try {
      // Guardar en IndexedDB
      await db.put('config', {
        clave: 'delivery',
        valor: valorNumero,
        tipo: 'costo_servicio',
        moneda: 'USD',
        updatedAt: new Date().toISOString()
      });

      setMensaje(`‚úÖ Costo de delivery guardado: $${valorNumero.toFixed(2)}`);
      
      // Limpiar mensaje despu√©s de 3 segundos
      setTimeout(() => setMensaje(''), 3000);
      
    } catch (error) {
      setMensaje('‚ùå Error al guardar: ' + error.message);
      console.error(error);
    } finally {
      setGuardando(false);
    }
  };

  const handleLimpiar = () => {
    setCostoDelivery('');
    setMensaje('');
  };

  // Estilos
  const styles = {
    container: {
      maxWidth: '500px',
      margin: '0 auto',
      padding: '20px'
    },
    titulo: {
      color: '#2c3e50',
      textAlign: 'center',
      marginBottom: '30px',
      fontSize: '24px',
      fontWeight: 'bold'
    },
    formContainer: {
      backgroundColor: 'white',
      borderRadius: '12px',
      padding: '25px',
      boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
    },
    label: {
      display: 'block',
      fontSize: '14px',
      fontWeight: '500',
      marginBottom: '8px',
      color: '#2c3e50'
    },
    input: {
      width: '100%',
      padding: '12px 15px',
      fontSize: '16px',
      border: '2px solid #ddd',
      borderRadius: '8px',
      boxSizing: 'border-box',
      transition: 'border-color 0.3s'
    },
    inputFocus: {
      borderColor: '#3498db',
      outline: 'none',
      boxShadow: '0 0 0 3px rgba(52, 152, 219, 0.2)'
    },
    mensaje: {
      padding: '12px 15px',
      borderRadius: '8px',
      marginBottom: '20px',
      textAlign: 'center',
      fontWeight: '500'
    },
    mensajeExito: {
      backgroundColor: '#d4edda',
      color: '#155724',
      border: '1px solid #c3e6cb'
    },
    mensajeError: {
      backgroundColor: '#f8d7da',
      color: '#721c24',
      border: '1px solid #f5c6cb'
    },
    mensajeInfo: {
      backgroundColor: '#d1ecf1',
      color: '#0c5460',
      border: '1px solid #bee5eb'
    },
    botonesContainer: {
      display: 'flex',
      gap: '12px',
      marginTop: '25px'
    },
    boton: {
      padding: '12px 20px',
      border: 'none',
      borderRadius: '8px',
      fontSize: '14px',
      fontWeight: '600',
      cursor: 'pointer',
      transition: 'all 0.2s',
      flex: 1
    },
    botonLimpiar: {
      backgroundColor: '#95a5a6',
      color: 'white'
    },
    botonGuardar: {
      backgroundColor: '#27ae60',
      color: 'white'
    },
    botonDeshabilitado: {
      backgroundColor: '#bdc3c7',
      cursor: 'not-allowed',
      opacity: 0.7
    },
    loading: {
      textAlign: 'center',
      padding: '40px',
      color: '#7f8c8d',
      fontSize: '16px'
    },
    infoBox: {
      marginTop: '25px',
      padding: '15px',
      backgroundColor: '#f8f9fa',
      borderRadius: '8px',
      fontSize: '13px',
      color: '#6c757d',
      borderLeft: '4px solid #3498db'
    },
    currentValue: {
      textAlign: 'center',
      padding: '15px',
      backgroundColor: '#e8f4fc',
      borderRadius: '8px',
      marginBottom: '20px',
      border: '1px solid #d6e9f9'
    },
    currentValueText: {
      fontSize: '18px',
      fontWeight: 'bold',
      color: '#2c3e50'
    },
    currentValueLabel: {
      fontSize: '12px',
      color: '#7f8c8d',
      marginTop: '5px'
    }
  };

  if (loading) {
    return (
      <div style={styles.container}>
        <div style={styles.loading}>
          <div style={{ 
            border: '4px solid #f3f3f3', 
            borderTop: '4px solid #3498db', 
            borderRadius: '50%', 
            width: '40px', 
            height: '40px', 
            margin: '0 auto 20px',
            animation: 'spin 1s linear infinite' 
          }}></div>
          Cargando costo de delivery...
        </div>
        <style>{`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `}</style>
      </div>
    );
  }

  return (
    <div style={styles.container}>
      <h1 style={styles.titulo}>üöö Costo de Delivery</h1>
      
      {/* Valor actual */}
      <div style={styles.currentValue}>
        <div style={styles.currentValueText}>
          {costoDelivery ? `$${parseFloat(costoDelivery).toFixed(2)}` : 'No configurado'}
        </div>
        <div style={styles.currentValueLabel}>
          Costo actual por servicio de delivery
        </div>
      </div>

      <div style={styles.formContainer}>
        {/* Mensajes */}
        {mensaje && (
          <div style={{
            ...styles.mensaje,
            ...(mensaje.includes('‚úÖ') ? styles.mensajeExito : 
                 mensaje.includes('‚ùå') ? styles.mensajeError : 
                 styles.mensajeInfo)
          }}>
            {mensaje}
          </div>
        )}

        <form onSubmit={handleSubmit}>
          <div style={{ marginBottom: '20px' }}>
            <label style={styles.label}>
              Costo del Delivery (USD) *
            </label>
            <input
              type="text"
              value={costoDelivery}
              onChange={handleChange}
              onFocus={(e) => e.target.style.borderColor = '#3498db'}
              onBlur={(e) => e.target.style.borderColor = '#ddd'}
              placeholder="Ej: 5.00"
              style={styles.input}
              disabled={guardando}
            />
            <div style={{ fontSize: '12px', color: '#6c757d', marginTop: '5px' }}>
              Ingresa el costo del servicio de delivery en d√≥lares
            </div>
          </div>
          
          {/* Botones */}
          <div style={styles.botonesContainer}>
            <button
              type="button"
              onClick={handleLimpiar}
              style={{
                ...styles.boton,
                ...styles.botonLimpiar,
                opacity: guardando ? 0.5 : 1
              }}
              disabled={guardando}
            >
              Limpiar
            </button>
            
            <button
              type="submit"
              style={{
                ...styles.boton,
                ...styles.botonGuardar,
                ...(guardando ? styles.botonDeshabilitado : {}),
                opacity: guardando ? 0.7 : 1
              }}
              disabled={guardando}
            >
              {guardando ? 'üíæ Guardando...' : 'üíæ Guardar'}
            </button>
          </div>
        </form>
      </div>

      {/* Informaci√≥n adicional */}
      <div style={styles.infoBox}>
        <div style={{ fontWeight: '500', marginBottom: '8px' }}>
          üí° Informaci√≥n:
        </div>
        <div>‚Ä¢ El costo de delivery se almacena en la tabla "config" con clave "delivery"</div>
        <div>‚Ä¢ Se guarda como n√∫mero decimal (ej: 5.00 para $5.00 USD)</div>
        <div>‚Ä¢ Este costo se puede usar para agregar a los totales de los pedidos</div>
        <div>‚Ä¢ Para usarlo: <code>await db.getConfigValue('delivery')</code></div>
      </div>
    </div>
  );
};

export default Delivery;
************************************************************

FILE: src/components/Footer.jsx
------------------------------
export default function Footer() {
  return (
    <footer style={{ textAlign: "center", padding: "16px 0", color: "#555" }}>
      ¬© {new Date().getFullYear()} - Natura-Ice
    </footer>
  );
}

************************************************************

FILE: src/components/GestionPedido.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../lib/db/database'; // Referencia a la base de datos dbTasaBCV [4, 5]
import styles from './GestionPedido.module.css'; // [4]

const GestionPedido = ({ pedido, onClose, onSave }) => {
    const getLocalToday = () => new Date().toLocaleDateString('en-CA');

    const [formData, setFormData] = useState({
        numero_pedido: '',
        fecha_pedido: getLocalToday(),
        tasa: '',
        estatus: 'Activo',
        delivery_tasa: 0
    });

    const [productos, setProductos] = useState([]);
    const [listaGrupos, setListaGrupos] = useState([]);
    const [cantidades, setCantidades] = useState({});
    const [aplicarDelivery, setAplicarDelivery] = useState(true);
    const [totales, setTotales] = useState({ usd: 0, bs: 0 });
    const [utilidad, setUtilidad] = useState({ usd: 0, bs: 0 });

    const esVisualizacion = !!pedido && pedido.estatus === 'Cerrado';

    useEffect(() => {
        const cargarDatos = async () => {
            try {
                // ACTUALIZACI√ìN FASE 2: Prioriza el hist√≥rico de tasas [3]
                const tasaConfig = await db.getUltimaTasaBCV();
                const deliveryValor = await db.getConfigValue('delivery'); // [1, 6]

                const [todosLosProductos, todosLosGrupos] = await Promise.all([
                    db.getAll('productos'),
                    db.getAll('grupos')
                ]); // [1, 7]

                setProductos(todosLosProductos);
                setListaGrupos(todosLosGrupos);

                if (pedido) {
                    setFormData({
                        numero_pedido: pedido.numero_pedido || '',
                        fecha_pedido: pedido.fecha_pedido || '',
                        tasa: pedido.tasa || (tasaConfig ? tasaConfig.toString() : ''),
                        estatus: pedido.estatus || 'Activo',
                        delivery_tasa: pedido.delivery_tasa !== undefined ? pedido.delivery_tasa : (deliveryValor || 0)
                    });

                    // Soporte para ambos formatos (Diccionario antiguo o Array BI nuevo)
                    if (pedido.items) {
                        if (Array.isArray(pedido.items)) {
                            const dict = {};
                            pedido.items.forEach(item => {
                                dict[item.productoId] = item.cantidad;
                            });
                            setCantidades(dict);
                        } else {
                            setCantidades(pedido.items);
                        }
                    }
                    setAplicarDelivery(pedido.delivery_aplicado ?? true);
                } else {
                    const ultimoPedido = await db.pedidos.orderBy('id').last(); // [8]
                    const siguienteNumero = ultimoPedido ? (parseInt(ultimoPedido.numero_pedido) + 1).toString() : "1";

                    setFormData(prev => ({
                        ...prev,
                        numero_pedido: siguienteNumero,
                        tasa: tasaConfig ? tasaConfig.toString() : '',
                        delivery_tasa: deliveryValor || 0
                    }));
                }
            } catch (err) {
                console.error("Error cargando datos:", err);
            }
        };
        cargarDatos();
    }, [pedido]);

    useEffect(() => {
        const calcularFinanzas = () => {
            let costoTotalUSD = 0;
            let ingresoEstimadoUSD = 0;

            Object.entries(cantidades).forEach(([prodId, qty]) => {
                const producto = productos.find(p => p.id === parseInt(prodId));
                if (producto && qty > 0) {
                    const grupo = listaGrupos.find(g => g.nombre.toLowerCase() === producto.grupo.toLowerCase());
                    if (grupo) {
                        costoTotalUSD += qty * (grupo.costo_$ || 0);
                        ingresoEstimadoUSD += qty * (grupo.precio || 0);
                    }
                }
            });

            const cargoDelivery = aplicarDelivery ? (parseFloat(formData.delivery_tasa) || 0) : 0;
            const totalPedidoUSD = ingresoEstimadoUSD + cargoDelivery;
            const tasaNum = parseFloat(formData.tasa) || 0;
            const utilidadUSD = ingresoEstimadoUSD - (costoTotalUSD + cargoDelivery);

            setTotales({ usd: totalPedidoUSD, bs: totalPedidoUSD * tasaNum });
            setUtilidad({ usd: utilidadUSD, bs: utilidadUSD * tasaNum });
        };

        if (productos.length > 0) calcularFinanzas();
    }, [cantidades, productos, listaGrupos, formData.tasa, formData.delivery_tasa, aplicarDelivery]);

    const handleRecalcular = async () => {
        try {
            // ACTUALIZACI√ìN FASE 2: Obtiene la tasa m√°s reciente del historial [2, 3]
            const nuevaTasa = await db.getUltimaTasaBCV();
            const nuevoDelivery = await db.getConfigValue('delivery');
            const gruposActualizados = await db.getAll('grupos');

            setListaGrupos(gruposActualizados);
            setFormData(prev => ({
                ...prev,
                tasa: nuevaTasa ? nuevaTasa.toString() : prev.tasa,
                delivery_tasa: nuevoDelivery !== null ? nuevoDelivery : prev.delivery_tasa
            }));
            alert("Totales recalculados con √©xito.");
        } catch (err) {
            alert("Error al recalcular.");
        }
    };

    const handleLimpiar = () => {
        if (window.confirm("¬øEst√°s seguro de que deseas vaciar todas las cantidades seleccionadas?")) {
            setCantidades({});
        }
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (esVisualizacion) return;

        const mensaje = pedido
            ? `¬øActualizar cambios en el pedido #${formData.numero_pedido}?`
            : `¬øGrabar el nuevo pedido #${formData.numero_pedido}?`;

        if (!window.confirm(mensaje)) return;

        // --- TRANSFORMACI√ìN PARA BI --- [9, 10]
        const itemsBI = Object.entries(cantidades)
            .filter(([_, qty]) => qty > 0)
            .map(([prodId, qty]) => {
                const prod = productos.find(p => p.id === parseInt(prodId));
                const grupo = listaGrupos.find(g => g.nombre.toLowerCase() === prod.grupo.toLowerCase());
                const precioUnit = grupo?.precio || 0;
                const costoUnit = grupo?.costo_$ || 0;

                return {
                    productoId: parseInt(prodId),
                    nombre: prod.nombre,
                    grupo: prod.grupo,
                    cantidad: qty,
                    precioUnitario: precioUnit,
                    costoUnitario: costoUnit,
                    subtotalUsd: qty * precioUnit,
                    utilidadUsd: qty * (precioUnit - costoUnit)
                };
            });

        const pedidoData = {
            ...formData,
            items: itemsBI,
            total_usd: totales.usd,
            total_bs: totales.bs,
            delivery_aplicado: aplicarDelivery,
            updatedAt: new Date().toISOString()
        };

        try {
            if (pedido?.id) {
                await db.put('pedidos', { ...pedidoData, id: pedido.id });
            } else {
                await db.add('pedidos', { ...pedidoData, createdAt: new Date().toISOString() });
            }
            onSave();
            onClose();
        } catch (error) {
            console.error("Error al guardar:", error);
            alert("Hubo un error al guardar el pedido.");
        }
    };

    const productosAgrupados = productos.reduce((acc, prod) => {
        const esVisible = prod.visible !== false;
        const tieneCantidad = (cantidades[prod.id] || 0) > 0;
        if (esVisible || tieneCantidad) {
            const grupo = prod.grupo || 'Otros';
            if (!acc[grupo]) acc[grupo] = [];
            acc[grupo].push(prod);
        }
        return acc;
    }, {});

    return (
        <div className={styles.overlay}>
            <div className={styles.modal}>
                <div className={styles.header}>
                    <span className={styles.title}>GESTI√ìN DE PEDIDOS</span>
                    <button className={styles.closeButton} onClick={onClose}>√ó</button>
                </div>

                <form onSubmit={handleSubmit} className={styles.content}>
                    <div className={styles.topRow}>
                        <div className={styles.inputGroup}>
                            <label className={styles.label}>Pedido #</label>
                            <input type="text" value={formData.numero_pedido} readOnly className={styles.inputSmall} />
                        </div>
                        <div className={styles.inputGroup}>
                            <label className={styles.label}>Fecha</label>
                            <input 
                                type="date" 
                                value={formData.fecha_pedido} 
                                onChange={(e) => setFormData({...formData, fecha_pedido: e.target.value})}
                                className={esVisualizacion ? styles.inputReadOnly : styles.inputSmall}
                                disabled={esVisualizacion}
                            />
                        </div>
                    </div>

                    <div className={styles.totalsBar}>
                        <div className={styles.totalBox}>
                            <span className={styles.totalLabel}>TOTAL PEDIDO $</span>
                            <span className={styles.totalValue}>{totales.usd.toFixed(2)}</span>
                        </div>
                        <div className={styles.totalBox}>
                            <span className={styles.totalLabel}>TOTAL PEDIDO BS</span>
                            <span className={styles.totalValue}>{totales.bs.toFixed(2)}</span>
                        </div>
                    </div>

                    <div className={styles.infoBar}>
                        <span>Tasa: {formData.tasa || '---'}</span>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '5px' }}>
                            <input 
                                type="checkbox" 
                                checked={aplicarDelivery} 
                                onChange={(e) => setAplicarDelivery(e.target.checked)} 
                                className={styles.checkbox}
                                disabled={esVisualizacion}
                            />
                            <span>Delivery: ${formData.delivery_tasa}</span>
                        </div>
                    </div>

                    <div className={styles.productListContainer}>
                        <div className={styles.productListHeader}>Selecci√≥n de Productos</div>
                        <div className={styles.productList}>
                            {Object.entries(productosAgrupados).map(([grupo, items]) => (
                                <div key={grupo}>
                                    <div className={styles.groupTitle}>{grupo.toUpperCase()}</div>
                                    {items.map((prod) => {
                                        const badgeColor = prod.stock === 0 ? '#ff4d4d' : (prod.stock <= 5 ? '#ffa500' : '#28a745');
                                        return (
                                            <div key={prod.id} className={styles.productItem}>
                                                <div className={styles.stockBadgeSmall} style={{ backgroundColor: badgeColor }}>{prod.stock}</div>
                                                <div className={styles.productName}>{prod.nombre}</div>
                                                <div className={styles.quantityControl}>
                                                    <button 
                                                        type="button" 
                                                        className={styles.qtyBtn} 
                                                        onClick={() => setCantidades({...cantidades, [prod.id]: Math.max(0, (cantidades[prod.id] || 0) - 1)})}
                                                        disabled={esVisualizacion}
                                                    >-</button>
                                                    <span>{cantidades[prod.id] || 0}</span>
                                                    <button 
                                                        type="button" 
                                                        className={styles.qtyBtn} 
                                                        onClick={() => setCantidades({...cantidades, [prod.id]: (cantidades[prod.id] || 0) + 1})}
                                                        disabled={esVisualizacion}
                                                    >+</button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className={styles.utilidadBar}>
                        <div className={styles.utilidadBox}>
                            <span className={styles.utilidadLabel}>UTILIDAD EST. $</span>
                            <span style={{ fontWeight: 'bold', color: utilidad.usd >= 0 ? '#28a745' : '#f44336' }}>
                                ${utilidad.usd.toFixed(2)}
                            </span>
                        </div>
                        <div className={styles.utilidadBox}>
                            <span className={styles.utilidadLabel}>UTILIDAD EST. BS</span>
                            <span style={{ fontWeight: 'bold', color: utilidad.bs >= 0 ? '#28a745' : '#f44336' }}>
                                Bs. {utilidad.bs.toFixed(2)}
                            </span>
                        </div>
                    </div>

                    <div className={styles.footer}>
                        <button type="button" className={styles.limpiarBtn} onClick={handleLimpiar} disabled={esVisualizacion}>Limpiar</button>
                        <button type="button" className={styles.recalcularBtn} onClick={handleRecalcular} disabled={esVisualizacion}>Recalcular</button>
                        {!esVisualizacion && (
                            <button type="submit" className={styles.grabarBtn}>{pedido ? "Actualizar" : "Grabar"}</button>
                        )}
                    </div>
                </form>
            </div>
        </div>
    );
};

export default GestionPedido;
************************************************************

FILE: src/components/GestionPedido.module.css
------------------------------
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}

.modal {
  background-color: #fff;
  width: 95%;
  max-width: 500px;
  max-height: 95vh;
  padding: 0px 15px 15px 15px;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 2px solid #00BFFF;
}

.title {
  font-size: 16px;
  font-weight: bold;
  color: #000;
}

.closeButton {
  background: none;
  border: none;
  font-size: 32px;
  cursor: pointer;
  color: #000;
}

.content {
  display: flex;
  flex-direction: column;
  gap: 8px;
  overflow-y: auto;
}

.topRow {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.inputGroup {
  display: flex;
  flex-direction: column;
  flex: 1;
}

.label {
  font-size: 14px;
  font-weight: bold;
  color: #000;
}

.totalsBar {
  display: flex;
  gap: 8px;
  justify-content: space-between;
}

.totalBox {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: #e1f5fe;
  padding: 6px;
  border: 1px solid #00BFFF;
  border-radius: 4px;
}

.totalLabel {
  font-size: 11px;
  font-weight: bold;
  color: #000; /* Se agrega color negro para cumplir con la solicitud */
}

.totalValue {
  font-size: 14px;
  font-weight: bold;
  color: #007bff;
}

.infoBar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  font-weight: bold;
  color: #000; /* Se agrega color negro para cumplir con la solicitud */
}

.productListContainer {
  border: 1px solid #aaa;
  border-radius: 4px;
  overflow: hidden;
}

.productListHeader {
  text-align: center;
  background-color: #00BFFF;
  color: white;
  padding: 4px;
  font-weight: bold;
}

.productList {
  height: 250px;
  overflow-y: auto;
}

.groupTitle {
  font-size: 14px;
  font-weight: bold;
  background-color: #f1f1f1;
  padding: 6px 10px;
  color: #000; /* Se agrega para que el texto del grupo sea negro */
}

.productItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  border-bottom: 1px solid #eee;
}

.stockBadgeSmall {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
}

.quantityControl {
  display: flex;
  align-items: center;
  gap: 8px;           /* Aumentado ligeramente para mejor separaci√≥n */
  
  /* Propiedades para hacer visible la cantidad */
  color: #000;        /* Color negro para el n√∫mero */
  font-weight: bold;  /* Resalta la cantidad */
  font-size: 16px;    /* Tama√±o de fuente legible */
  min-width: 25px;    /* Espacio m√≠nimo para que el n√∫mero no se mueva */
  justify-content: center;
}

.qtyBtnOld {
  width: 32px;
  height: 32px;
  background-color: #eee;
  border: 1px solid #ccc;
  font-weight: bold;
  color: #000; /* Se a√±ade color negro para los signos + y - */
}

.qtyBtn {
  width: 32px;
  height: 32px;
  background-color: #eee;
  border: 1px solid #ccc;
  font-weight: bold;
  color: #000;          /* Signos en color negro (solicitud anterior) */
  
  /* Nuevas propiedades para centrado */
  display: flex;
  align-items: center;  /* Centrado vertical */
  justify-content: center; /* Centrado horizontal */
  padding: 0;           /* Elimina paddings por defecto que puedan desviar el signo */
  line-height: normal;  /* Asegura que el interlineado no afecte la posici√≥n */
}

.utilidadBar {
  display: flex;
  gap: 8px;
  padding: 8px;
  background-color: #f9f9f9;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.utilidadBox {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* --- ESTILOS DE LA BOTONERA INFERIOR --- */

.footer {
  display: flex;
  gap: 8px;
  margin-top: 15px;
  width: 100%;
}

.limpiarBtn, .recalcularBtn, .grabarBtn {
  flex: 1; /* Esto asegura que los 3 botones tengan el mismo ancho */
  padding: 12px 5px;
  border: none;
  border-radius: 4px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  text-align: center;
}

.limpiarBtn {
  background-color: #f44336;
  color: white;
}

.recalcularBtn {
  background-color: #007bff;
  color: white;
}

.grabarBtn {
  background-color: #28a745;
  color: white;
}

.grabarBtn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.inputSmall {
  padding: 8px;
  border-radius: 4px;
  width: 100%;
  box-sizing: border-box;
  font-size: 16px;
  background-color: #00BFFF;
  color: white;
  font-weight: bold;
  text-align: center;
  border: 1px solid #aaa;
}

.productName {
  color: #666; 
  flex: 1; 
  margin-left: 10px;
  font-size: 14px; /* Se reduce la fuente a 14px (2px menos que el est√°ndar de 16px del componente) */
}

.utilidadLabel {
  font-size: 11px;
  font-weight: bold;
  color: #000; /* Negro solicitado */
  /* Aqu√≠ podr√≠as a√±adir un estilo diferente, como otro color o margen */
}


************************************************************

FILE: src/components/GruposCRUD/GruposCRUD.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database'; // Acceso a la instancia dbTasaBCV [4]
import ModalGrupo from './ModalGrupo';

const GruposCRUD = () => {
  const [grupos, setGrupos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [modalOpen, setModalOpen] = useState(false);
  const [grupoEditando, setGrupoEditando] = useState(null);

  // Carga inicial de los grupos desde IndexedDB [5, 6]
  useEffect(() => {
    cargarGrupos();
  }, []);

  const cargarGrupos = async () => {
    try {
      setLoading(true);
      // Obtiene todos los registros de la tabla 'grupos' [7, 8]
      const datos = await db.getAll('grupos');
      setGrupos(datos);
    } catch (err) {
      setError('Error al cargar los grupos: ' + err.message);
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  const handleEditar = (grupo) => {
    setGrupoEditando(grupo);
    setModalOpen(true); // Abre el modal para edici√≥n [7, 8]
  };

  const handleEliminar = async (grupo) => {
    if (window.confirm(`¬øEst√°s seguro de eliminar el grupo "${grupo.nombre}"?`)) {
      try {
        // Verifica integridad referencial antes de eliminar [8, 9]
        const productosConGrupo = await db.getAll('productos', { grupo: grupo.nombre });
        if (productosConGrupo.length > 0) {
          alert(`No se puede eliminar. Hay ${productosConGrupo.length} producto(s) usando este grupo.`);
          return;
        }
        await db.del('grupos', grupo.id);
        cargarGrupos(); // Refresca la lista tras eliminar [1, 9]
      } catch (err) {
        setError('Error al eliminar: ' + err.message);
      }
    }
  };

  const handleNuevoGrupo = () => {
    setGrupoEditando(null);
    setModalOpen(true); // Abre el modal para nuevo registro [1, 9]
  };

  if (loading) return <div style={styles.loading}>Cargando grupos...</div>;

  return (
    <div style={styles.container}>
      {/* T√≠tulo actualizado y color blanco para visibilidad [1, 2] */}
      <h1 style={styles.title}>Panel de Grupos</h1>

      {error && <div style={styles.errorAlert}>{error}</div>}

      <button onClick={handleNuevoGrupo} style={styles.nuevoButton}>
        + Agregar Nuevo Grupo
      </button>

      <div style={styles.lista}>
        {grupos.length === 0 ? (
          <div style={styles.vacio}>No hay grupos registrados.</div>
        ) : (
          grupos.map(grupo => (
            <div key={grupo.id} style={styles.item}>
              <div style={styles.itemInfo}>
                <div style={styles.itemNombre}>{grupo.nombre}</div>
                {/* Visualizaci√≥n de Precio y nuevo campo Costo [10, 11] */}
                <div style={styles.itemPrecio}>Precio: ${grupo.precio.toFixed(2)}</div>
                <div style={styles.itemCosto}>
                  Costo: ${grupo.costo_$ ? grupo.costo_$.toFixed(2) : "0.00"}
                </div>
                <div style={styles.itemId}>ID: {grupo.id}</div>
              </div>
              <div style={styles.itemActions}>
                <button onClick={() => handleEditar(grupo)} style={styles.btnEditar}>Editar</button>
                <button onClick={() => handleEliminar(grupo)} style={styles.btnEliminar}>Eliminar</button>
              </div>
            </div>
          ))
        )}
      </div>

      <div style={styles.resumen}>
        Total: {grupos.length} grupo{grupos.length !== 1 ? 's' : ''}
      </div>

      {/* Renderizado condicional del Modal para evitar duplicidad [10, 12] */}
      {modalOpen && (
        <ModalGrupo 
          grupo={grupoEditando} 
          onClose={() => setModalOpen(false)} 
          onSave={cargarGrupos} 
        />
      )}
    </div>
  );
};

const styles = {
  container: { padding: '20px', maxWidth: '800px', margin: '0 auto' },
  // Estilo corregido: Blanco para contrastar con el fondo oscuro #242424 [2, 13]
  title: { marginBottom: '20px', color: '#ffffff', fontWeight: 'bold', textAlign: 'center' },
  loading: { padding: '40px', textAlign: 'center', color: '#fff' },
  errorAlert: { backgroundColor: '#fee', color: '#c33', padding: '10px', borderRadius: '4px', marginBottom: '20px' },
  nuevoButton: { marginBottom: '20px', padding: '10px 15px', backgroundColor: '#4CAF50', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontWeight: '500' },
  lista: { border: '1px solid #ddd', borderRadius: '4px', overflow: 'hidden', marginBottom: '20px' },
  vacio: { padding: '40px', textAlign: 'center', color: '#666' },
  item: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '15px', borderBottom: '1px solid #eee', backgroundColor: 'white' },
  itemInfo: { flex: 1 },
  itemNombre: { fontWeight: 'bold', fontSize: '18px', marginBottom: '5px', color: '#333' },
  itemPrecio: { color: '#007bff', marginBottom: '3px', fontWeight: '500' },
  // Estilo espec√≠fico para el campo de costo en rojo [11]
  itemCosto: { color: '#dc3545', marginBottom: '3px', fontWeight: '500' },
  itemId: { fontSize: '12px', color: '#999' },
  itemActions: { display: 'flex', gap: '10px' },
  btnEditar: { padding: '8px 12px', backgroundColor: '#2196F3', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' },
  btnEliminar: { padding: '8px 12px', backgroundColor: '#f44336', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' },
  resumen: { marginTop: '20px', padding: '10px', backgroundColor: '#f5f5f5', borderRadius: '4px', fontSize: '14px', textAlign: 'center', color: '#333' }
};

export default GruposCRUD;
************************************************************

FILE: src/components/GruposCRUD/ModalGrupo.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database';

const ModalGrupo = ({ grupo, onClose, onSave }) => {
  const [formData, setFormData] = useState({
    nombre: '',
    precio: 0,
    costo_$: 0
  });

  useEffect(() => {
    if (grupo) {
      setFormData({
        nombre: grupo.nombre || '',
        precio: grupo.precio || 0,
        costo_$: grupo.costo_$ || 0
      });
    }
  }, [grupo]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      if (grupo) {
        await db.put('grupos', { id: grupo.id, ...formData });
      } else {
        await db.add('grupos', formData);
      }
      onSave();
      onClose();
    } catch (err) {
      alert('Error al guardar: ' + err.message);
    }
  };

  return (
    <div style={modalStyles.overlay}>
      <div style={modalStyles.modal}>
        <h2 style={{color: '#000'}}>GESTI√ìN DE GRUPO</h2>
        <form onSubmit={handleSubmit}>
          <div style={modalStyles.field}>
            <label style={{color: '#000'}}>Nombre:</label>
            <input 
              type="text" 
              value={formData.nombre} 
              onChange={e => setFormData({...formData, nombre: e.target.value})}
              required 
            />
          </div>
          <div style={modalStyles.field}>
            <label style={{color: '#000'}}>Precio ($):</label>
            <input 
              type="number" 
              step="0.01"
              value={formData.precio} 
              onChange={e => setFormData({...formData, precio: parseFloat(e.target.value)})}
            />
          </div>
          <div style={modalStyles.field}>
            <label style={{color: '#000'}}>Costo ($):</label>
            <input 
              type="number" 
              step="0.01"
              value={formData.costo_$} 
              onChange={e => setFormData({...formData, costo_$: parseFloat(e.target.value)})}
            />
          </div>
          <div style={{display: 'flex', gap: '10px', marginTop: '20px'}}>
            <button type="submit" style={{backgroundColor: '#28a745', color: '#fff'}}>Guardar</button>
            <button type="button" onClick={onClose} style={{backgroundColor: '#ccc'}}>Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  );
};

const modalStyles = {
  overlay: { position: 'fixed', top: 0, left: 0, width: '100%', height: '100%', backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', justifyContent: 'center', alignItems: 'center', zIndex: 3000 },
  modal: { backgroundColor: '#fff', padding: '20px', borderRadius: '8px', width: '90%', maxWidth: '400px' },
  field: { display: 'flex', flexDirection: 'column', marginBottom: '10px' }
};

export default ModalGrupo;
************************************************************

FILE: src/components/Header.jsx
------------------------------
import React, { useState } from 'react';
import Sidebar from './Sidebar';

export default function Header() {
    const [isMenuOpen, setIsMenuOpen] = useState(false);

    return (
        <header style={styles.header}>
            <div style={styles.nav}>
                {/* Bot√≥n Tipo Side Menu (Hamburguesa) */}
                <button 
                    onClick={() => setIsMenuOpen(true)} 
                    style={styles.menuBtn}
                >
                    ‚ò∞
                </button>
                
                <h1 style={styles.brand}>Natura Ice</h1>
                <div style={{ width: '40px' }} /> {/* Espaciador para centrar t√≠tulo */}
            </div>

            <Sidebar 
                isOpen={isMenuOpen} 
                onClose={() => setIsMenuOpen(false)} 
            />
        </header>
    );
}

const styles = {
    header: {
        padding: '0.5rem 1rem',
        backgroundColor: '#f8f9fa',
        borderBottom: '1px solid #dee2e6',
        position: 'sticky',
        top: 0,
        zIndex: 10000  
    },
    nav: {
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center'
    },
    menuBtn: {
        fontSize: '1.8rem',
        background: 'none',
        border: 'none',
        color: '#007bff',
        cursor: 'pointer'
    },
    brand: {
        fontSize: '1.8rem',
        margin: 0,
        color: '#333',
        fontWeight: 'bold'
    }
};
************************************************************

FILE: src/components/Panel/Panel.jsx
------------------------------
// src/components/Panel/Panel.jsx
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import { db } from "../../lib/db/database"; // Referencia a la base de datos dbTasaBCV [1, 2]
import { useGrupos } from "./hooks/useGrupos"; // [3]
import { useProductos } from "./hooks/useProductos"; // [4]
import { exportDatabase } from "../../lib/db/utils/exportService"; // [3, 5]
import { migrateOrdersToBI } from "../../lib/db/utils/migrationService"; // [3, 6]
import styles from "./Panel.module.css"; // [3, 7]

export default function Panel() {
    const navigate = useNavigate(); // [3]
    const { importarGrupos } = useGrupos(); // [3]
    const { importarProductos } = useProductos(); // [4]

    // Estados para control de procesos de carga
    const [isExporting, setIsExporting] = useState(false); // [4]
    const [isMigrating, setIsMigrating] = useState(false); // [4]
    const [isLoadingHistory, setIsLoadingHistory] = useState(false); // Nuevo estado Fase 1

    /**
     * Maneja la exportaci√≥n de la base de datos a un archivo JSON [5, 8]
     */
    const handleExport = async () => {
        setIsExporting(true);
        const result = await exportDatabase();
        if (result.success) {
            alert("‚úÖ Copia de seguridad guardada en Descargas"); // [4]
        } else {
            alert("‚ùå Error al exportar: " + (result.error?.message || "Error desconocido"));
        }
        setIsExporting(false);
    };

    /**
     * Ejecuta la migraci√≥n de pedidos antiguos al formato BI detallado [6, 9]
     */
    const handleMigrateBI = async () => {
        const mensajeConfirmacion = "‚ö†Ô∏è ¬øDeseas iniciar la migraci√≥n de pedidos al formato BI?\n\n" +
            "Esta acci√≥n transformar√° los pedidos antiguos para habilitar la anal√≠tica financiera."; // [9]
        
        if (!window.confirm(mensajeConfirmacion)) return;

        setIsMigrating(true);
        try {
            const result = await migrateOrdersToBI();
            if (result.success) {
                alert(result.message); // [10]
            } else {
                alert("‚ùå Error en la migraci√≥n: " + result.error);
            }
        } catch (error) {
            alert("‚ùå Error cr√≠tico: " + error.message);
        } finally {
            setIsMigrating(false);
        }
    };

    /**
     * Fase 1 Redise√±o: Carga masiva de los 11 d√≠as de hist√≥rico recolectados
     */
    const handleLoadHistory = async () => {
      if (!window.confirm("¬øDeseas cargar los 11 d√≠as de hist√≥rico de tasas BCV?")) return;
      
      setIsLoadingHistory(true);
      try {
          // Ejecutamos la carga en IndexedDB [1]
          const result = await db.cargarDatosInicialesHistorico();
          
          if (result.success) {
              // Ahora result.message existe y no ser√° undefined
              alert(result.message); 
          } else {
              alert("‚ùå Error: " + result.error);
          }
      } catch (err) {
          alert("‚ùå Error cr√≠tico: " + err.message);
      } finally {
          setIsLoadingHistory(false);
      }
  };

    /**
     * Importaci√≥n masiva de grupos desde el archivo grupos.json [11, 12]
     */
    const handleImportGrupos = async () => {
        if (!window.confirm("¬øImportar grupos iniciales? Se borrar√°n los actuales.")) return;
        const result = await importarGrupos();
        alert(result.message);
    };

    return (
        <div className={styles.container}>
            <h1 className={styles.title}>PANEL DE CONTROL</h1>

            <div className={styles.buttons}>
                {/* Gesti√≥n de Datos y Backups */}
                <button 
                    className={styles.button} 
                    onClick={handleExport} 
                    disabled={isExporting}
                >
                    {isExporting ? "‚åõ Exportando..." : "üì§ Exportar DB"}
                </button>

                {/* Migraci√≥n Anal√≠tica BI */}
                <button 
                    className={styles.button} 
                    onClick={handleMigrateBI} 
                    disabled={isMigrating}
                    style={{ backgroundColor: '#6a1b9a' }} // P√∫rpura para BI [13]
                >
                    {isMigrating ? "‚öôÔ∏è Migrando..." : "üìä Migrar Pedidos a BI"}
                </button>

                {/* NUEVO: Carga de Hist√≥rico de Tasas (Fase 1) */}
                <button 
                    className={styles.button} 
                    onClick={handleLoadHistory}
                    disabled={isLoadingHistory}
                    style={{ backgroundColor: '#f39c12' }} // Naranja para hist√≥rico
                >
                    {isLoadingHistory ? "‚öôÔ∏è Cargando..." : "üìà Cargar Hist√≥rico BCV"}
                </button>

                {/* Importaci√≥n de Configuraci√≥n Inicial */}
                <button className={styles.button} onClick={handleImportGrupos}>
                    üì• Cargar Datos Iniciales (Grupos)
                </button>

                {/* Accesos Directos a M√≥dulos [13] */}
                <button className={styles.button} onClick={() => navigate("/tasabcv")}>
                    üí∞ Tasa BCV
                </button>

                <button className={styles.button} onClick={() => navigate("/admingrupos")}>
                    üç¶ Grupos
                </button>

                <button className={styles.button} onClick={() => navigate("/adminproductos")}>
                    üì¶ Productos
                </button>

                {/* Bot√≥n Regresar [14] */}
                <button 
                    className={`${styles.button} ${styles.back}`} 
                    onClick={() => navigate("/")}
                >
                    ‚Ü©Ô∏è Regresar
                </button>
            </div>
        </div>
    );
}
************************************************************

FILE: src/components/Panel/Panel.module.css
------------------------------
/* Ocupa todo el ancho y alto de la pantalla */
.container {
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;   /* centra verticalmente */
  align-items: center;       /* centra horizontalmente */
  background: #fafafa;
}

/* T√≠tulo */
.title {
  font-size: 2rem;
  margin-bottom: 40px;
  font-weight: bold;
  color: #333;
}

/* Contenedor de los botones para mantenerlos centrados */
.buttons {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Botones */
.button {
  width: 75%;
  max-width: 300px;
  padding: 14px 0;
  margin: 10px 0;
  font-size: 1.1rem;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #007bff;
  color: white;
  transition: background 0.25s;
}

.button:hover {
  background: #005fcc;
}

/* Bot√≥n Regresar */
.back {
  background: #555;
}

.back:hover {
  background: #333;
}

************************************************************

FILE: src/components/Panel/hooks/useGrupos.js
------------------------------
// src/components/Panel/hooks/useGrupos.js
import { useState } from 'react';
import gruposData from '../../../data/grupos.json';
import { db } from '../../../lib/db/database.js'; 

export function useGrupos() {
  
  const [error, setError] = useState(null);

  const importarGrupos = async () => { 
          
    try {
              
      // 1. CONVERTIR {clave:valor} a [{nombre, precio}]
      const gruposArray = Object.entries(gruposData).map(([nombre, precio]) => ({
        nombre: nombre,
        precio: Number(precio)
      }));
  
      // 2. LIMPIAR TABLA
      await db.grupos.clear();
 
      // 3. INSERTAR NUEVOS DATOS
      await db.grupos.bulkAdd(gruposArray);
  
      return {
        success: true,
        count: gruposArray.length,
        message: `${gruposArray.length} grupos importados`
      };
  
    } catch (error) {
      console.error('Error en importaci√≥n:', error);
      return {
        success: false,
        error: error.message
      };
    }
  }
  

  const verificarGrupos = async () => {
    try {
      const { db } = await import('../../../lib/db/database.js');
      const grupos = await db.grupos.toArray();
      
      return {
        success: true,
        data: grupos,
        count: grupos.length,
        message: `${grupos.length} grupos encontrados`
      };
    } catch (err) {
      console.error('Error verificando grupos:', err);
      return {
        success: false,
        error: err.message,
        data: []
      };
    }
  };

  return {
    importarGrupos,
    verificarGrupos,    
    error,
    clearError: () => setError(null)
  };
}
************************************************************

FILE: src/components/Panel/hooks/useProductos.jsx
------------------------------
// src/components/Panel/hooks/useProductos.js
import { useState } from 'react';
import productosData from '../../../data/data.json';
import { db } from '../../../lib/db/database.js'; // Import normal

export function useProductos() {
  const [error, setError] = useState(null);

const importarProductos = async () => {
  try {
    // 1. OBTENER EL ARRAY DE PRODUCTOS
    // Accedemos a la propiedad "productos" del objeto
    const productosArray = productosData.productos;
    
    // Si necesitas asegurar que cada producto tenga un campo createdAt
    const productosConFecha = productosArray.map(producto => ({
      ...producto,
      createdAt: producto.createdAt || new Date().toISOString() // Fecha actual si no existe
    }));

    // 2. LIMPIAR TABLA
    await db.productos.clear();

    // 3. INSERTAR NUEVOS DATOS
    await db.productos.bulkAdd(productosConFecha);

    console.log(`Importando ${productosConFecha.length} productos...`);

    return {
      success: true,
      count: productosConFecha.length,
      total: productosConFecha.length,
      message: `${productosConFecha.length} productos importados exitosamente.`
    };

  } catch (error) {
    console.error('Error en importaci√≥n de productos:', error);
    return {
      success: false,
      error: error.message
    };
  }
};

  const verificarProductos = async () => {
  };

  return {
    importarProductos,
    verificarProductos,
    error
  };
}
************************************************************

FILE: src/components/Pedidos.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { db } from '../lib/db/database';
import GestionPedido from './GestionPedido';
import styles from './Pedidos.module.css';

const PedidosComponente = () => {
  const navigate = useNavigate();
  const [listaPedidos, setListaPedidos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [modalOpen, setModalOpen] = useState(false);
  const [pedidoSeleccionado, setPedidoSeleccionado] = useState(null);
  const [isProcessing, setIsProcessing] = useState(false);
  const [stats, setStats] = useState({ pedidosActivos: 0, pedidosCerrados: 0 });

  const cargarRegistros = async () => {
    try {
      setLoading(true);
      const datos = await db.getAll('pedidos'); [5]
      const datosOrdenados = datos.sort((a, b) => {
        const numA = parseInt(a.numero_pedido) || 0;
        const numB = parseInt(b.numero_pedido) || 0;
        return numB - numA;
      });
      setListaPedidos(datosOrdenados);
      const activos = datosOrdenados.filter(p => p.estatus === 'Activo' || !p.estatus).length;
      const cerrados = datosOrdenados.filter(p => p.estatus === 'Cerrado').length;
      setStats({ pedidosActivos: activos, pedidosCerrados: cerrados });
    } catch (error) {
      console.error("Error al cargar pedidos:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    cargarRegistros();
  }, []);

  // --- ACTUALIZACI√ìN FASE 5: L√≥gica para Array de Items (BI) ---
  const handleExportTxt = async (pedido, e) => {
    e.stopPropagation();
    try {
      let contenido = `PEDIDO NATURA ICE\n`;
      contenido += `==============================\n\n`;
      contenido += `Numero: #${pedido.numero_pedido}\n`;
      contenido += `Fecha: ${new Date(pedido.fecha_pedido).toLocaleDateString('es-ES')}\n`;
      contenido += `Tasa BCV: ${pedido.tasa}\n`;
      contenido += `==============================\n`;
      contenido += `PRODUCTOS SOLICITADOS:\n`;
      contenido += `==============================\n\n`;

      let totalUnidades = 0;

      // CAMBIO CLAVE: Recorremos directamente el array de BI [Snapshot hist√≥rico]
      pedido.items.forEach((item) => {
        if (item.cantidad > 0) {
          // El nombre ya viene en el item, no hace falta buscar en la tabla 'productos'
          contenido += `${item.cantidad} x ${item.nombre}\n`;
          totalUnidades += item.cantidad;
        }
      });

      const costoDelivery = pedido.delivery_aplicado ? (parseFloat(pedido.delivery_tasa) || 0) : 0;
      
      contenido += `\n==============================\n`;
      contenido += `RESUMEN:\n`;
      contenido += `==============================\n\n`;
      contenido += `Total Unidades: ${totalUnidades}\n`;
      contenido += `Delivery: ${costoDelivery.toFixed(2)}\n`;
      contenido += `----------------------------\n`;
      contenido += `Total USD + Deliv: $${(pedido.total_usd).toFixed(2)}\n`;
      contenido += `Total Bs: Bs. ${pedido.total_bs.toFixed(2)}\n\n`;
      
      contenido += `==============================\n`;
      contenido += `INFORMACION:\n`;
      contenido += `==============================\n\n`;
      contenido += `Distribuidor: Natura Ice\n`;
      contenido += `Generado: ${new Date().toLocaleDateString('es-ES')}\n`;
      contenido += `==============================\n`;

      const blob = new Blob([contenido], { type: 'text/plain' }); [6]
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `Pedido_${pedido.numero_pedido}.txt`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

    } catch (error) {
      console.error("Error exportando pedido:", error);
      alert("No se pudo generar el archivo de texto.");
    }
  };

  // --- ACTUALIZACI√ìN FASE 5: Recepci√≥n de pedido con items detallados ---
  const handleRecibirPedido = async (pedido, e) => {
    e.stopPropagation();
    if (pedido.estatus === 'Cerrado' || isProcessing) return;

    const confirmar = window.confirm(`¬øMarcar Pedido #${pedido.numero_pedido} como RECIBIDO?\nSe actualizar√° el stock.`);
    if (!confirmar) return;

    setIsProcessing(true);
    try {
      await db.db.transaction('rw', [db.productos, db.pedidos], async () => {
        // CAMBIO CLAVE: Iteraci√≥n sobre el array de objetos detallados
        for (const item of pedido.items) {
          // Usamos el productoId guardado en el snapshot del item [2, 7]
          await db.updateStock(item.productoId, item.cantidad);
        }
        
        await db.pedidos.update(pedido.id, {
          estatus: 'Cerrado',
          updatedAt: new Date().toISOString()
        });
      });

      alert("‚úÖ Inventario actualizado exitosamente.");
      await cargarRegistros();
    } catch (error) {
      console.error("Error al recibir pedido:", error);
      alert(`‚ùå Error: ${error.message}`);
    } finally {
      setIsProcessing(false);
    }
  };

  const handleEliminar = async (pedido, e) => {
    e.stopPropagation();
    if (pedido.estatus === 'Cerrado' || isProcessing) return;
    if (window.confirm(`¬øEliminar pedido #${pedido.numero_pedido}?`)) {
      await db.del('pedidos', pedido.id);
      cargarRegistros();
    }
  };

  return (
    <div className={styles.container}>
      <header className={styles.header}>
        <button onClick={() => navigate(-1)} className={styles.backArrow}>‚Üê</button>
        <span className={styles.title}>Pedidos Natura</span>
        <button className={styles.addBtnCircle} onClick={() => { setPedidoSeleccionado(null); setModalOpen(true); }}>+</button>
      </header>

      <div className={styles.statsBar}>
        <div className={styles.statCard}>
          <span className={styles.statNumber}>{listaPedidos.length}</span>
          <span className={styles.statLabel}>TOTAL</span>
        </div>
        <div className={styles.statCard}>
          <span className={styles.statNumber}>{stats.pedidosActivos}</span>
          <span className={styles.statLabel}>PENDIENTES</span>
        </div>
        <div className={styles.statCard}>
          <span className={styles.statNumber}>{stats.pedidosCerrados}</span>
          <span className={styles.statLabel}>RECIBIDOS</span>
        </div>
      </div>

      <div className={styles.listaCards}>
        {loading ? (
          <p className={styles.loading}>Cargando registros...</p>
        ) : (
          listaPedidos.map((p) => (
            <div 
              key={p.id} 
              className={styles.pedidoCard}
              onClick={() => { if(!isProcessing) { setPedidoSeleccionado(p); setModalOpen(true); } }}
              style={{ borderLeftColor: p.estatus === 'Cerrado' ? '#3498db' : '#27ae60' }}
            >
              <div className={styles.cardHeader}>
                <span className={styles.orderNumber}>#{p.numero_pedido}</span>
                <span className={`${styles.statusBadge} ${p.estatus === 'Cerrado' ? styles.statusCerrado : styles.statusPendiente}`}>
                  {p.estatus === 'Cerrado' ? '‚úÖ RECIBIDO' : 'üü¢ PENDIENTE'}
                </span>
              </div>
              <div className={styles.tasaRow}>
                <span className={styles.tasaLabel}>üí∞ Tasa:</span>
                <span className={styles.tasaValue}>{p.tasa || '---'}</span>
              </div>
              <div className={styles.cardBody}>
                <span className={styles.cardDate}>{new Date(p.fecha_pedido).toLocaleDateString('es-ES')}</span>
                <div style={{ textAlign: 'right' }}>
                  <div className={styles.totalUsd}>${p.total_usd?.toFixed(2)}</div>
                  <div className={styles.totalBs}>Bs. {p.total_bs?.toFixed(2)}</div>
                </div>
              </div>

              <div className={styles.cardActions}>
                <button 
                  className={styles.actionBtn} 
                  onClick={(e) => { e.stopPropagation(); setPedidoSeleccionado(p); setModalOpen(true); }}
                  disabled={p.estatus === 'Cerrado'}
                >‚úèÔ∏è</button>
                <button 
                  className={styles.actionBtn} 
                  onClick={(e) => handleExportTxt(p, e)} 
                  title="Exportar para Proveedor"
                  style={{ backgroundColor: '#fff3cd' }}
                >üìÑ</button>
                <button 
                  className={styles.actionBtn} 
                  onClick={(e) => handleRecibirPedido(p, e)}
                  disabled={p.estatus === 'Cerrado' || isProcessing}
                  style={{ opacity: (p.estatus === 'Cerrado' || isProcessing) ? 0.3 : 1 }}
                >
                  {isProcessing && p.id === pedidoSeleccionado?.id ? '‚åõ' : 'üì•'}
                </button>
                <button 
                  className={styles.actionBtn} 
                  onClick={(e) => handleEliminar(p, e)} 
                  disabled={p.estatus === 'Cerrado'}
                >üóëÔ∏è</button>
              </div>
            </div>
          ))
        )}
      </div>

      {modalOpen && (
        <GestionPedido 
          pedido={pedidoSeleccionado} 
          onClose={() => { setModalOpen(false); cargarRegistros(); }} 
          onSave={cargarRegistros} 
        />
      )}
    </div>
  );
};

export default PedidosComponente;
************************************************************

FILE: src/components/Pedidos.module.css
------------------------------
.container {
    display: flex;
    flex-direction: column;
    width: 100vw;
    min-height: 100vh;
    background-color: #f5f7fa;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    overflow-x: hidden; /* Evita el recorte derecho */
}

.header {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    background-color: #2c3e50;
    color: white;
    position: sticky;
    top: 0;
    z-index: 100;
    width: 100%;
    box-sizing: border-box;
}

.backArrow {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    margin-right: 15px;
}

.title {
    font-size: 1.2rem;
    font-weight: bold;
    flex: 1;
    margin-right: 20px; /* Margen derecho del literal solicitado */
}

/* Bot√≥n "+" corregido para ser circular */
.addBtnCircle {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background-color: #27ae60;
    color: white;
    border: none;
    font-size: 28px;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0; /* Elimina padding que causa elipse */
    flex-shrink: 0; /* Evita que se aplaste en el contenedor flex */
    box-sizing: border-box;
}

/* Estilo para la Tasa BCV dentro de la card */
.tasaRow {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    background-color: #fcf8e3;
    border-radius: 6px;
    border: 1px solid #faebcc;
    width: fit-content;
    margin: 5px 0;
}

.tasaLabel {
    font-size: 0.8rem;
    color: #8a6d3b;
    font-weight: 600;
}

.tasaValue {
    font-size: 0.9rem;
    color: #2c3e50;
    font-weight: 800;
}

.statsBar {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    padding: 15px;
    background-color: white;
    border-bottom: 1px solid #eaeaea;
}

.statCard {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 8px;
}

.statNumber { font-size: 1.1rem; font-weight: bold; color: #7f8c8d; }
.statLabel { font-size: 0.65rem; color: #95a5a6; text-transform: uppercase; }

.listaCards {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 15px;
    width: 100%;
    box-sizing: border-box;
}

.pedidoCard {
    background-color: white;
    border-radius: 12px;
    padding: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border-left: 6px solid #00BFFF;
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    box-sizing: border-box;
}

.cardHeader { display: flex; justify-content: space-between; align-items: center; }
.orderNumber { font-size: 1.1rem; font-weight: 800; color: #2c3e50; }
.statusBadge { font-size: 0.75rem; padding: 4px 10px; border-radius: 20px; font-weight: bold; }
.statusPendiente { background-color: #d5f4e6; color: #27ae60; }
.statusCerrado { background-color: #e8f4fc; color: #3498db; }

.cardBody { display: flex; justify-content: space-between; align-items: flex-end; }
.cardDate { font-size: 0.9rem; color: #7f8c8d; }
.totalUsd { font-size: 1.5rem; font-weight: 900; color: #28a745; }
.totalBs { font-size: 0.85rem; color: #7f8c8d; }

.cardActions {
    display: flex;
    gap: 8px;
    padding-top: 10px;
    border-top: 1px solid #eee;
}

.actionBtn, .deleteBtn {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
    background-color: #f8f9fa;
    font-size: 1.2rem;
    display: flex;
    justify-content: center;
}

.deleteBtn { color: #f44336; border-color: #ffcdd2; }
************************************************************

FILE: src/components/ProductosCRUD/ModalProducto.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database'; // Acceso a dbTasaBCV [4]

const ModalProducto = ({ producto, grupos, onClose, onSave }) => {
  // Estado inicial incluyendo el campo 'visible' soportado en la versi√≥n 8 de la DB [1, 2]
  const [formData, setFormData] = useState({
    id: '',
    nombre: '',
    grupo: '',
    stock: 0,
    imagen: '',
    visible: true 
  });

  const [error, setError] = useState('');
  const [validando, setValidando] = useState(false);

  // Efecto para cargar los datos del producto al editar [2, 5]
  useEffect(() => {
    if (producto) {
      setFormData({
        id: producto.id.toString(),
        nombre: producto.nombre || '',
        grupo: producto.grupo || '',
        stock: producto.stock || 0,
        imagen: producto.imagen || '',
        // Se asegura la carga del campo visible (predeterminado a true si no existe) [1]
        visible: producto.visible !== undefined ? producto.visible : true 
      });
    } else {
      setFormData({
        id: '',
        nombre: '',
        grupo: grupos.length > 0 ? grupos.nombre : '',
        stock: 0,
        imagen: '',
        visible: true
      });
    }
  }, [producto, grupos]);

  // Valida que el ID no est√© duplicado en IndexedDB [5]
  const validarIdExistente = async (id) => {
    try {
      const existe = await db.get('productos', parseInt(id));
      return !!existe;
    } catch (err) {
      console.error('Error validando ID:', err);
      return false;
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    
    // Manejo espec√≠fico para el campo booleano 'visible'
    if (name === 'visible') {
      setFormData(prev => ({ ...prev, visible: value === 'true' }));
      return;
    }

    setFormData(prev => ({
      ...prev,
      [name]: name === 'stock' || name === 'id' ?
        (value === '' ? '' : value.replace(/\D/g, '')) :
        value
    }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setValidando(true);

    // Validaciones b√°sicas de integridad [3, 5]
    if (!formData.id.trim()) {
      setError('El ID es requerido');
      setValidando(false);
      return;
    }

    const idNumero = parseInt(formData.id);
    if (isNaN(idNumero) || idNumero <= 0) {
      setError('El ID debe ser un n√∫mero positivo');
      setValidando(false);
      return;
    }

    if (!formData.nombre.trim()) {
      setError('El nombre es requerido');
      setValidando(false);
      return;
    }

    try {
      const dataToSave = {
        id: idNumero,
        nombre: formData.nombre,
        grupo: formData.grupo,
        stock: parseInt(formData.stock),
        imagen: formData.imagen,
        visible: formData.visible, // Persistencia del estado de visibilidad [1]
        createdAt: producto ? producto.createdAt : new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };

      if (producto) {
        const idCambiado = idNumero !== producto.id;
        if (idCambiado) {
          const idExiste = await validarIdExistente(idNumero);
          if (idExiste) {
            setError(`El ID ${idNumero} ya est√° en uso`);
            setValidando(false);
            return;
          }
          await db.del('productos', producto.id);
          await db.add('productos', dataToSave);
        } else {
          await db.put('productos', dataToSave); // Actualiza registro existente [6]
        }
      } else {
        const idExiste = await validarIdExistente(idNumero);
        if (idExiste) {
          setError(`El ID ${idNumero} ya est√° en uso`);
          setValidando(false);
          return;
        }
        await db.add('productos', dataToSave); // Crea nuevo registro [7]
      }

      onSave(); // Refresca la lista en el componente padre [8]
      onClose();
    } catch (err) {
      setError('Error al guardar: ' + err.message);
    } finally {
      setValidando(false);
    }
  };

  return (
    <div style={modalStyles.overlay}>
      <div style={modalStyles.modal}>
        <div style={modalStyles.header}>
          <h3 style={{ margin: 0, color: '#333' }}>
            {producto ? '‚úèÔ∏è Editar Producto' : '‚ûï Nuevo Producto'}
          </h3>
          <button onClick={onClose} style={modalStyles.closeBtn}>√ó</button>
        </div>

        <form onSubmit={handleSubmit} style={{ padding: '20px' }}>
          {error && (
            <div style={modalStyles.errorBox}>
              ‚ö†Ô∏è {error}
            </div>
          )}

          {/* Fila: ID y Stock [9] */}
          <div style={{ display: 'flex', gap: '15px', marginBottom: '15px' }}>
            <div style={{ flex: 1 }}>
              <label style={modalStyles.label}>ID *</label>
              <input 
                type="text" 
                name="id" 
                value={formData.id} 
                onChange={handleChange} 
                disabled={validando || !!producto} 
                style={inputStyle(validando)} 
              />
            </div>
            <div style={{ flex: 1 }}>
              <label style={modalStyles.label}>Stock</label>
              <input 
                type="text" 
                name="stock" 
                value={formData.stock} 
                onChange={handleChange} 
                disabled={validando} 
                style={inputStyle(validando)} 
              />
            </div>
          </div>

          {/* Campo: Nombre [9] */}
          <div style={{ marginBottom: '15px' }}>
            <label style={modalStyles.label}>Nombre del Producto *</label>
            <input 
              type="text" 
              name="nombre" 
              value={formData.nombre} 
              onChange={handleChange} 
              disabled={validando} 
              style={inputStyle(validando)} 
            />
          </div>

          {/* Campo: Ruta de la Imagen [10] */}
          <div style={{ marginBottom: '15px' }}>
            <label style={modalStyles.label}>Ruta de la Imagen</label>
            <input 
              type="text" 
              name="imagen" 
              value={formData.imagen} 
              onChange={handleChange} 
              disabled={validando} 
              placeholder="/outputs/small/nombre_400.webp" 
              style={inputStyle(validando)} 
            />
          </div>

          {/* Campo: Visibilidad (Nuevo control basado en esquema v8) [1] */}
          <div style={{ marginBottom: '15px' }}>
            <label style={modalStyles.label}>Estado en Cat√°logo</label>
            <select
              name="visible"
              value={formData.visible.toString()}
              onChange={handleChange}
              disabled={validando}
              style={{ ...inputStyle(validando), cursor: 'pointer' }}
            >
              <option value="true">üü¢ Visible (Disponible en Home)</option>
              <option value="false">‚ö™ Oculto (Solo visible en Admin)</option>
            </select>
          </div>

          {/* Campo: Grupo [10] */}
          <div style={{ marginBottom: '20px' }}>
            <label style={modalStyles.label}>Grupo *</label>
            <select 
              name="grupo" 
              value={formData.grupo} 
              onChange={handleChange} 
              disabled={validando} 
              style={{ ...inputStyle(validando), cursor: 'pointer' }}
            >
              <option value="">Seleccionar grupo...</option>
              {grupos.map(grupo => (
                <option key={grupo.id} value={grupo.nombre}>
                  {grupo.nombre} {grupo.precio > 0 ? `(+$${grupo.precio.toFixed(2)})` : ''}
                </option>
              ))}
            </select>
          </div>

          <div style={modalStyles.footer}>
            <button 
              type="button" 
              onClick={onClose} 
              disabled={validando} 
              style={modalStyles.btnCancel}
            >
              Cancelar
            </button>
            <button 
              type="submit" 
              disabled={validando} 
              style={modalStyles.btnSave}
            >
              {validando ? '‚åõ Grabando...' : producto ? 'üíæ Guardar Cambios' : '‚úÖ Grabar Producto'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

// Estilos basados en la estructura del proyecto [11, 12]
const modalStyles = {
  overlay: {
    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,
    backgroundColor: 'rgba(0, 0, 0, 0.5)', display: 'flex',
    alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: '20px'
  },
  modal: {
    backgroundColor: 'white', borderRadius: '8px', width: '100%',
    maxWidth: '500px', maxHeight: '90vh', display: 'flex',
    flexDirection: 'column', boxShadow: '0 4px 20px rgba(0, 0, 0, 0.15)',
    overflowY: 'auto'
  },
  header: {
    display: 'flex', justifyContent: 'space-between', alignItems: 'center',
    padding: '20px', borderBottom: '1px solid #eee', backgroundColor: '#f8f9fa'
  },
  closeBtn: { background: 'none', border: 'none', fontSize: '24px', cursor: 'pointer', color: '#666' },
  label: { display: 'block', fontWeight: 'bold', marginBottom: '5px', fontSize: '14px', color: '#333' },
  errorBox: {
    backgroundColor: '#fee', color: '#c33', padding: '12px',
    borderRadius: '4px', marginBottom: '20px', fontSize: '14px', border: '1px solid #fcc'
  },
  footer: { display: 'flex', justifyContent: 'flex-end', gap: '10px', paddingTop: '10px', borderTop: '1px solid #eee', padding: '20px' },
  btnCancel: { padding: '10px 24px', backgroundColor: '#6c757d', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' },
  btnSave: { padding: '10px 24px', backgroundColor: '#28a745', color: 'white', border: 'none', borderRadius: '4px', fontWeight: 'bold', cursor: 'pointer' }
};

const inputStyle = (validando) => ({
  width: '100%', padding: '10px', border: '1px solid #ddd',
  borderRadius: '4px', fontSize: '14px', boxSizing: 'border-box',
  backgroundColor: validando ? '#f8f9fa' : 'white',
  color: '#333', cursor: validando ? 'not-allowed' : 'text'
});

export default ModalProducto;
************************************************************

FILE: src/components/ProductosCRUD/ProductosCRUD.jsx
------------------------------
// src/components/ProductosCRUD/ProductosCRUD.jsx
import React, { useState, useEffect } from 'react';
import { db } from '../../lib/db/database';
import ModalProducto from './ModalProducto';

const ProductosCRUD = () => {
  const [productos, setProductos] = useState([]);
  const [grupos, setGrupos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [modalOpen, setModalOpen] = useState(false);
  const [productoEditando, setProductoEditando] = useState(null);
  const [filtroGrupo, setFiltroGrupo] = useState('todos');

  // Cargar datos al montar el componente
  useEffect(() => {
    cargarDatos();
  }, []);

  const cargarDatos = async () => {
    try {
      setLoading(true);
      
      // Cargar productos y grupos en paralelo
      const [productosData, gruposData] = await Promise.all([
        db.getAll('productos'),
        db.getAll('grupos')
      ]);
      
      setProductos(productosData);
      setGrupos(gruposData);
    } catch (err) {
      setError('Error al cargar los datos: ' + err.message);
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  // Filtrar productos por grupo
  const productosFiltrados = filtroGrupo === 'todos' 
    ? productos 
    : productos.filter(p => p.grupo === filtroGrupo);

  const handleEditar = (producto) => {
    setProductoEditando(producto);
    setModalOpen(true);
  };

  const handleEliminar = async (producto) => {
    if (window.confirm(`¬øEst√°s seguro de eliminar el producto "${producto.nombre}"?`)) {
      try {
        await db.del('productos', producto.id);
        cargarDatos(); // Recargar la lista
      } catch (err) {
        setError('Error al eliminar: ' + err.message);
      }
    }
  };

  const handleNuevoProducto = () => {
    setProductoEditando(null);
    setModalOpen(true);
  };

  const handleGuardarExitoso = () => {
    cargarDatos(); // Recargar lista despu√©s de guardar
  };

  const getNombreGrupo = (grupoId) => {
    const grupo = grupos.find(g => g.nombre === grupoId);
    return grupo ? grupo.nombre : grupoId;
  };

  const getPrecioGrupo = (grupoId) => {
    const grupo = grupos.find(g => g.nombre === grupoId);
    return grupo ? grupo.precio : 0;
  };

  if (loading) {
    return <div style={styles.loading}>Cargando productos...</div>;
  }

  return (
    <div style={styles.container}>
      <h1 style={styles.title}>Administraci√≥n de Productos</h1>
      
      {error && (
        <div style={styles.errorAlert}>
          {error}
        </div>
      )}

      {/* Controles */}
      <div style={styles.controles}>
        <div style={styles.filtros}>
          <div style={styles.filtroGrupo}>
            <label htmlFor="filtro-grupo" style={styles.filtroLabel}>
              Filtrar por grupo:
            </label>
            <select
              id="filtro-grupo"
              value={filtroGrupo}
              onChange={(e) => setFiltroGrupo(e.target.value)}
              style={styles.select}
            >
              <option value="todos">Todos los grupos</option>
              {grupos.map(grupo => (
                <option key={grupo.id} value={grupo.nombre}>
                  {grupo.nombre}
                </option>
              ))}
            </select>
          </div>
        </div>

        <button 
          onClick={handleNuevoProducto}
          style={styles.nuevoButton}
        >
          + Nuevo Producto
        </button>
      </div>

      {/* Lista de productos */}
      <div style={styles.lista}>
        {productosFiltrados.length === 0 ? (
          <div style={styles.vacio}>
            {filtroGrupo === 'todos' 
              ? 'No hay productos registrados. ¬°Crea el primero!' 
              : `No hay productos en el grupo "${filtroGrupo}"`}
          </div>
        ) : (
          productosFiltrados.map(producto => (
            <div key={producto.id} style={styles.item}>
              <div style={styles.itemImagen}>
                {producto.imagen ? (
                  <img 
                    src={producto.imagen} 
                    alt={producto.nombre}
                    style={styles.imagen}
                    onError={(e) => e.target.style.display = 'none'}
                  />
                ) : (
                  <div style={styles.imagenPlaceholder}>
                    üì∑
                  </div>
                )}
              </div>

              <div style={styles.itemInfo}>
                <div style={styles.itemNombre}>{producto.nombre}</div>
                
                <div style={styles.itemDetalles}>
                  <div style={styles.detalle}>
                    <span style={styles.detalleLabel}>Grupo:</span>
                    <span style={styles.detalleValor}>
                      {getNombreGrupo(producto.grupo)}
                      {getPrecioGrupo(producto.grupo) > 0 && 
                        ` (+$${getPrecioGrupo(producto.grupo).toFixed(2)})`}
                    </span>
                  </div>
                  
                  <div style={styles.detalle}>
                    <span style={styles.detalleLabel}>Stock:</span>
                    <span style={{
                      ...styles.detalleValor,
                      color: producto.stock > 0 ? '#2e7d32' : '#c62828',
                      fontWeight: 'bold'
                    }}>
                      {producto.stock} unidad{producto.stock !== 1 ? 'es' : ''}
                    </span>
                  </div>
                  
                  <div style={styles.detalle}>
                    <span style={styles.detalleLabel}>ID:</span>
                    <span style={styles.detalleValor}>{producto.id}</span>
                  </div>
                  
                  {producto.createdAt && (
                    <div style={styles.detalle}>
                      <span style={styles.detalleLabel}>Creado:</span>
                      <span style={styles.detalleValor}>
                        {new Date(producto.createdAt).toLocaleDateString()}
                      </span>
                    </div>
                  )}
                </div>
              </div>

              <div style={styles.itemActions}>
                <button
                  onClick={() => handleEditar(producto)}
                  style={styles.btnEditar}
                >
                  Editar
                </button>
                <button
                  onClick={() => handleEliminar(producto)}
                  style={styles.btnEliminar}
                >
                  Eliminar
                </button>
              </div>
            </div>
          ))
        )}
      </div>

      {/* Resumen */}
      <div style={styles.resumen}>
        <div>
          Mostrando: <strong>{productosFiltrados.length}</strong> de <strong>{productos.length}</strong> productos
          {filtroGrupo !== 'todos' && ` (filtrado por: ${filtroGrupo})`}
        </div>
        <div style={styles.stockTotal}>
          Stock total: <strong>{productos.reduce((sum, p) => sum + p.stock, 0)}</strong> unidades
        </div>
      </div>

      {/* Modal */}
      {modalOpen && (
        <ModalProducto
          producto={productoEditando}
          grupos={grupos}
          onClose={() => setModalOpen(false)}
          onSave={handleGuardarExitoso}
        />
      )}
    </div>
  );
};

const styles = {
  container: { 
    padding: '20px', 
    maxWidth: '1000px', 
    margin: '0 auto',
    minHeight: '100vh',
    fontFamily: 'system-ui, -apple-system, sans-serif'
  },
  title: { 
    marginBottom: '20px', 
    color: '#1a1a1a',
    fontSize: '26px',
    fontWeight: '700'
  },
  loading: { 
    padding: '40px', 
    textAlign: 'center',
    fontSize: '18px',
    color: '#666'
  },
  errorAlert: { 
    backgroundColor: '#fff5f5', 
    color: '#c53030', 
    padding: '12px 16px', 
    borderRadius: '6px',
    marginBottom: '20px',
    border: '1px solid #feb2b2',
    display: 'flex',
    alignItems: 'center',
    gap: '10px'
  },
  controles: {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'flex-end',
    marginBottom: '25px',
    flexWrap: 'wrap',
    gap: '15px',
    backgroundColor: '#fff',
    padding: '15px',
    borderRadius: '8px',
    boxShadow: '0 1px 3px rgba(0,0,0,0.1)'
  },
  filtros: {
    flex: 1
  },
  filtroGrupo: {
    display: 'flex',
    flexDirection: 'column',
    gap: '8px'
  },
  filtroLabel: {
    fontSize: '13px',
    color: '#666',
    fontWeight: '600',
    textTransform: 'uppercase',
    letterSpacing: '0.5px'
  },
  select: {
    padding: '10px 12px',
    border: '1px solid #e2e8f0',
    borderRadius: '6px',
    fontSize: '14px',
    maxWidth: '240px',
    backgroundColor: '#f8fafc',
    cursor: 'pointer',
    outline: 'none',
    transition: 'border-color 0.2s'
  },
  nuevoButton: {
    padding: '11px 22px',
    backgroundColor: '#2563eb', // Azul moderno
    color: 'white',
    border: 'none',
    borderRadius: '6px',
    cursor: 'pointer',
    fontSize: '14px',
    fontWeight: '600',
    whiteSpace: 'nowrap',
    transition: 'background 0.2s',
    boxShadow: '0 2px 4px rgba(37, 99, 235, 0.2)'
  },
  lista: { 
    border: '1px solid #e2e8f0',
    borderRadius: '10px',
    overflow: 'hidden',
    marginBottom: '20px',
    backgroundColor: 'white',
    boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)'
  },
  vacio: { 
    padding: '60px 20px', 
    textAlign: 'center', 
    color: '#94a3b8',
    fontSize: '16px'
  },
  item: {
    display: 'flex',
    alignItems: 'center',
    padding: '16px 20px',
    borderBottom: '1px solid #f1f5f9',
    backgroundColor: 'white',
    gap: '20px',
    transition: 'background 0.2s'
  },
  itemImagen: {
    width: '64px',
    height: '64px',
    flexShrink: 0,
    position: 'relative' // Para indicadores sobre la imagen
  },
  imagen: {
    width: '100%',
    height: '100%',
    objectFit: 'cover',
    borderRadius: '8px',
    border: '1px solid #e2e8f0'
  },
  imagenPlaceholder: {
    width: '100%',
    height: '100%',
    backgroundColor: '#f1f5f9',
    borderRadius: '8px',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    fontSize: '24px',
    color: '#94a3b8',
    border: '1px dashed #cbd5e1'
  },
  itemInfo: {
    flex: 1,
    minWidth: 0
  },
  itemHeader: {
    display: 'flex',
    alignItems: 'center',
    gap: '10px',
    marginBottom: '6px'
  },
  itemNombre: { 
    fontWeight: '600', 
    fontSize: '16px', 
    color: '#1e293b'
  },
  badgeVisible: {
    fontSize: '10px',
    padding: '2px 8px',
    borderRadius: '12px',
    fontWeight: '700',
    textTransform: 'uppercase'
  },
  visibleTrue: { backgroundColor: '#dcfce7', color: '#15803d' },
  visibleFalse: { backgroundColor: '#fee2e2', color: '#b91c1c' },

  itemDetalles: {
    display: 'flex',
    gap: '20px',
    fontSize: '13px'
  },
  detalle: {
    display: 'flex',
    gap: '5px'
  },
  detalleLabel: {
    color: '#64748b',
    fontWeight: '400'
  },
  detalleValor: {
    color: '#334155',
    fontWeight: '600'
  },
  itemActions: { 
    display: 'flex', 
    gap: '8px',
    flexShrink: 0
  },
  btnEditar: {
    padding: '8px 14px',
    backgroundColor: '#f1f5f9',
    color: '#475569',
    border: '1px solid #e2e8f0',
    borderRadius: '6px',
    cursor: 'pointer',
    fontSize: '13px',
    fontWeight: '600',
    transition: 'all 0.2s'
  },
  btnEliminar: {
    padding: '8px 14px',
    backgroundColor: '#fff',
    color: '#ef4444',
    border: '1px solid #fee2e2',
    borderRadius: '6px',
    cursor: 'pointer',
    fontSize: '13px',
    fontWeight: '600',
    transition: 'all 0.2s'
  },
  resumen: {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center',
    padding: '20px',
    backgroundColor: '#f8fafc',
    borderRadius: '10px',
    fontSize: '14px',
    color: '#475569',
    border: '1px solid #e2e8f0'
  },
  stockTotal: {
    fontWeight: '700',
    color: '#2563eb',
    fontSize: '16px'
  },
};

export default ProductosCRUD;
************************************************************

FILE: src/components/RegistroGasto.jsx
------------------------------
import React, { useState } from 'react';
import { db } from '../lib/db/database';
import styles from './RegistroGasto.module.css';

const RegistroGasto = ({ onClose }) => {
  const [gasto, setGasto] = useState({
    descripcion: '',
    montoUsd: '',
    categoria: 'Operativo'
  });

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!gasto.descripcion || !gasto.montoUsd) return;

    await db.gastos.add({
      ...gasto,
      montoUsd: parseFloat(gasto.montoUsd),
      fecha: new Date().toISOString()
    });

    alert('Gasto registrado con √©xito');
    setGasto({ descripcion: '', montoUsd: '', categoria: 'Operativo' });
    if (onClose) onClose();
  };

  return (
    <div className={styles.formContainer}>
      <h3>üí∏ Registrar Gasto</h3>
      <form onSubmit={handleSubmit}>
        <div className={styles.inputGroup}>
          <label>Descripci√≥n</label>
          <input 
            type="text" 
            placeholder="Ej: Marcador, Almuerzo..."
            value={gasto.descripcion}
            onChange={(e) => setGasto({...gasto, descripcion: e.target.value})}
            required
          />
        </div>

        <div className={styles.inputGroup}>
          <label>Monto ($)</label>
          <input 
            type="number" 
            step="0.01"
            placeholder="0.00"
            value={gasto.montoUsd}
            onChange={(e) => setGasto({...gasto, montoUsd: e.target.value})}
            required
          />
        </div>

        <div className={styles.inputGroup}>
          <label>Categor√≠a</label>
          <select 
            value={gasto.categoria}
            onChange={(e) => setGasto({...gasto, categoria: e.target.value})}
          >
            <option value="Insumos">Insumos (Empaques/Vasos)</option>
            <option value="Operativo">Operativo (Papeler√≠a/Limpieza)</option>
            <option value="Personal">Personal (Comida/Retiro)</option>
            <option value="Otros">Otros</option>
          </select>
        </div>

        <button type="submit" className={styles.btnGuardar}>Guardar Gasto</button>
      </form>
    </div>
  );
};

export default RegistroGasto;
************************************************************

FILE: src/components/RegistroGasto.module.css
------------------------------
.formContainer {
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  margin: 10px;
}

.inputGroup {
  margin-bottom: 15px;
}

.inputGroup label {
  display: block;
  font-weight: bold;
  margin-bottom: 5px;
  color: #333;
}

.inputGroup input, .inputGroup select {
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 16px; /* Evita zoom autom√°tico en iOS/Android */
}

.btnGuardar {
  width: 100%;
  padding: 15px;
  background-color: #e74c3c;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 16px;
}
************************************************************

FILE: src/components/ResumenInventario.jsx
------------------------------
import React, { useState, useEffect } from 'react';
import { db } from '../lib/db/database';
import styles from './ResumenInventario.module.css';

const ResumenInventario = () => {
    const [metricas, setMetricas] = useState({
        totalCosto: 0,
        totalVenta: 0,
        ganancia: 0,
        gananciaBs: 0
    });

    const [tasa, setTasa] = useState(0);

    useEffect(() => {
        const cargarDatosYCalcular = async () => {
            try {
                // 1. Obtener datos base de productos y grupos
                const productos = await db.productos.toArray();
                const grupos = await db.grupos.toArray();

                // ACTUALIZACI√ìN FASE 2: 
                // Ya no consulta db.config.get('tasa'). Ahora usa el m√©todo din√°mico
                // que prioriza el historial de 11 d√≠as cargado en la Fase 1.
                const valorTasa = await db.getUltimaTasaBCV();
                setTasa(valorTasa);

                // 2. Mapeo de grupos para acceso r√°pido a costos y precios
                const gruposMap = grupos.reduce((acc, g) => {
                    acc[g.nombre] = {
                        costo: parseFloat(g.costo_$) || 0,
                        precio: parseFloat(g.precio) || 0
                    };
                    return acc;
                }, {});

                // 3. C√°lculo de totales basado en el stock actual de cada producto
                const totales = productos.reduce((acc, p) => {
                    const info = gruposMap[p.grupo];
                    if (info) {
                        acc.totalCosto += (p.stock || 0) * info.costo;
                        acc.totalVenta += (p.stock || 0) * info.precio;
                    }
                    return acc;
                }, { totalCosto: 0, totalVenta: 0 });

                const gananciaUsd = totales.totalVenta - totales.totalCosto;

                setMetricas({
                    ...totales,
                    ganancia: gananciaUsd,
                    gananciaBs: gananciaUsd * valorTasa // C√°lculo de la rentabilidad en moneda local
                });
            } catch (error) {
                console.error("Error al calcular resumen de inventario:", error);
            }
        };

        cargarDatosYCalcular();
    }, []);

    return (
        <div className={styles.container}>
            <h2 className={styles.titulo}>An√°lisis de Inventario Actual</h2>
            
            <div className={styles.grid}>
                <div className={styles.card}>
                    <label>Inversi√≥n (Costo $)</label>
                    <span className={styles.valorCosto}>${metricas.totalCosto.toFixed(2)}</span>
                </div>

                <div className={styles.card}>
                    <label>Venta Estimada ($)</label>
                    <span className={styles.valorVenta}>${metricas.totalVenta.toFixed(2)}</span>
                </div>

                <div className={styles.card}>
                    <label>Ganancia Potencial ($)</label>
                    <span className={styles.valorGanancia}>${metricas.ganancia.toFixed(2)}</span>
                </div>

                {/* SECCI√ìN RESALTADA: Ganancia en Bs basada en historial */}
                <div className={`${styles.card} styles.highlightBs`}>
                    <label>Ganancia Potencial (Bs)</label>
                    <span className={styles.valorBs}>
                        Bs. {metricas.gananciaBs.toLocaleString('es-VE', { 
                            minimumFractionDigits: 2, 
                            maximumFractionDigits: 2 
                        })}
                    </span>
                    <span className={styles.tasaInfo}>Tasa aplicada: {tasa} (BCV Hist√≥rico)</span>
                </div>
            </div>
        </div>
    );
};

export default ResumenInventario;
************************************************************

FILE: src/components/ResumenInventario.module.css
------------------------------
.container { padding: 20px; }
.grid {
  display: grid;
  grid-template-columns: 1fr; /* Una columna en m√≥vil */
  gap: 15px;
}
.card {
  background: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
}
.valorCosto { color: #e74c3c; font-size: 1.5rem; font-weight: bold; }
.valorVenta { color: #3498db; font-size: 1.5rem; font-weight: bold; }
.valorGanancia { color: #2ecc71; font-size: 1.8rem; font-weight: bold; }

label{
    color: black;
}

.highlightBs {
  background-color: #f8f9fa;
  border-left: 5px solid #ff9800; /* Color naranja para resaltar moneda local */
}

.valorBs {
  color: #ff9800;
  font-size: 1.8rem;
  font-weight: 800;
}

.tasaInfo {
  margin-top: 5px;
  color: #6c757d;
  font-style: italic;
  font-size: 0.8rem;
}

.sidebar {
  position: fixed; /* Crucial para que no se mueva al hacer scroll */
  top: 0;
  left: 0;
  height: 100vh;
  width: 280px; /* O el ancho que prefieras */
  background-color: #ffffff;
  
  /* Elevaci√≥n m√°xima */
  z-index: 9999; 
  
  /* Sombra para dar profundidad y separar visualmente del fondo */
  box-shadow: 4px 0 10px rgba(0, 0, 0, 0.3);
  
  transition: transform 0.3s ease-in-out;
}
************************************************************

FILE: src/components/Sidebar.jsx
------------------------------
import React from 'react';
import { Link, useNavigate } from "react-router-dom";

export default function Sidebar({ isOpen, onClose }) {
    const navigate = useNavigate();

    const handleAdminAccess = (e) => {
        e.preventDefault();
        const pin = window.prompt("Ingrese el PIN de acceso:");
        if (pin === "aaaaa") { 
            navigate("/Panel");
            onClose();
        } else {
            alert("Acceso denegado: PIN incorrecto.");
        }
    };

    // Funci√≥n para manejar hover
    const handleMouseEnter = (e) => {
        e.target.style.backgroundColor = '#f0f8ff';
    };

    const handleMouseLeave = (e) => {
        e.target.style.backgroundColor = 'transparent';
    };

    // Estilos definidos como objeto
   const styles = {
    sidebar: {
        position: 'fixed',
        top: 0,
        left: 0,
        height: '100vh',
        width: '250px',
        backgroundColor: '#ffffff',
        boxShadow: '2px 0 10px rgba(0,0,0,0.2)',
        zIndex: 9999,
        transition: 'transform 0.3s ease-in-out',
        display: 'flex',
        flexDirection: 'column',
        // Asegura que el sidebar no se mueva si el contenido es largo
        overflow: 'auto' 
    },
    overlay: {
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100vw',
        height: '100vh',
        backgroundColor: 'rgba(0,0,0,0.5)',
        // Subimos el zIndex para que bloquee botones o modales de la UI principal
        zIndex: 9998, 
        backdropFilter: 'blur(2px)', // Toque est√©tico moderno
    },
    header: {
        padding: '20px',
        borderBottom: '1px solid #eee',
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        backgroundColor: '#00BFFF',
        // El header se queda fijo arriba
        flexShrink: 0,
       
    },
    nav: { 
        display: 'flex', 
        flexDirection: 'column', 
        padding: '10px',
        // ESTO HACE QUE LA LISTA SEA DESPLAZABLE
        overflowY: 'auto', 
        flexGrow: 1,
        WebkitOverflowScrolling: 'touch', // Scroll suave en m√≥viles
    },
    // ... tus otros estilos (title, closeBtn, icon se mantienen igual)
    link: {
        padding: '15px',
        textDecoration: 'none',
        color: '#333',
        fontSize: '1.1rem',
        borderBottom: '1px solid #f5f5f5',
        cursor: 'pointer',
        display: 'flex',
        alignItems: 'center',
        gap: '10px',
        transition: 'background-color 0.2s',
        // Evita que el texto se rompa en varias l√≠neas si es largo
        whiteSpace: 'nowrap', 
    },
};

    return (
        <>
            {/* Overlay para cerrar al tocar fuera */}
            {isOpen && (
                <div onClick={onClose} style={styles.overlay} />
            )}

            {/* Contenedor del Men√∫ Lateral */}
            <div style={{
                ...styles.sidebar,
                transform: isOpen ? 'translateX(0)' : 'translateX(-100%)'
            }}>
                <div style={styles.header}>
                    <h3 style={styles.title}>Natura Menu</h3>
                    <button onClick={onClose} style={styles.closeBtn}>√ó</button>
                </div>

                <nav style={styles.nav}>
                    {/* Opci√≥n Inicio */}
                    <Link 
                        to="/" 
                        onClick={onClose} 
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>üè†</span>
                        <span>Inicio</span>
                    </Link>
                    
                    {/* Opci√≥n Pedidos */}
                    <Link 
                        to="/pedidos" 
                        onClick={onClose} 
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>üìã</span>
                        <span>Pedidos</span>
                    </Link>
                    
                                       <Link 
                        to="/registrogasto" 
                        onClick={onClose} 
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>üí∏</span>
                        <span>Registrar Gastos</span>
                    </Link>
 

                    {/* Opci√≥n Tasa Delivery */}
                    <Link 
                        to="/delivery" 
                        onClick={onClose} 
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>üöö</span>
                        <span>Tasa Delivery</span>
                    </Link>
                    
                    {/* Opci√≥n Tasa BCV */}
                    <Link 
                        to="/tasabcv" 
                        onClick={onClose} 
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>üí∞</span>
                        <span>Tasa BCV</span>
                    </Link>

                    
                    <Link to="/estadisticas" onClick={onClose} style={styles.link}>
                        <span style={styles.icon}>üìä</span> Estad√≠sticas
                    </Link>
                    
                    <Link to="/resumeninventario" onClick={onClose} style={styles.link}>
                        <span style={styles.icon}>üìä</span> Resumen de Inventario
                    </Link>
                    
                    {/* Acceso Administrativo */}
                    <a 
                        onClick={handleAdminAccess} 
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>‚öôÔ∏è</span>
                        <span>Panel de Control</span>
                    </a>
                    
                    {/* Opci√≥n Acerca de */}
                    <Link 
                        to="/about" 
                        onClick={onClose} 
                        style={styles.link}
                        onMouseEnter={handleMouseEnter}
                        onMouseLeave={handleMouseLeave}
                    >
                        <span style={styles.icon}>‚ÑπÔ∏è</span>
                        <span>Acerca de</span>
                    </Link>
                    
                    
                </nav>
            </div>
        </>
    );
}
************************************************************

FILE: src/components/TasaImporter.jsx
------------------------------
// src/components/TasaImporter.jsx
import React, { useRef } from 'react';
import { useDataImport } from '../lib/db/hooks/useDataImport.js';
import tasaRepository from '../lib/db/repositories/TasaRepository.js';

const TasaImporter = ({ onImportComplete }) => {
  const fileInputRef = useRef(null);
  const { importing, result, importFromFile } = useDataImport();
  const [demoJson, setDemoJson] = useState('');

  const handleFileSelect = async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const result = await importFromFile(file);
    if (result.success && onImportComplete) {
      onImportComplete();
    }
  };

  const handleDemoImport = async () => {
    try {
      const tasasDemo = [
        {
          nombre: "Tasa de Cambio USD/EUR",
          valor: 0.92,
          moneda: "EUR",
          descripcion: "Tasa de cambio d√≥lar a euro",
          activo: true
        },
        {
          nombre: "Tasa de Cambio USD/GBP",
          valor: 0.79,
          moneda: "GBP",
          descripcion: "Tasa de cambio d√≥lar a libra",
          activo: true
        },
        {
          nombre: "Tasa de Inter√©s Referencial",
          valor: 4.25,
          moneda: "USD",
          descripcion: "Tasa de inter√©s anual",
          activo: true
        }
      ];

      const count = await tasaRepository.bulkImport(tasasDemo, { clearBeforeImport: false });
      
      if (onImportComplete) {
        onImportComplete();
      }
      
      alert(`‚úÖ ${count} tasas de demostraci√≥n importadas`);
    } catch (error) {
      alert(`‚ùå Error: ${error.message}`);
    }
  };

  const handleExport = async () => {
    try {
      const tasas = await tasaRepository.getAll(false);
      const dataStr = JSON.stringify(tasas, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      
      const link = document.createElement('a');
      link.href = URL.createObjectURL(dataBlob);
      link.download = `tasas_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
    } catch (error) {
      alert(`Error al exportar: ${error.message}`);
    }
  };

  return (
    <div className="p-4 border rounded-lg space-y-4">
      <h3 className="font-bold">Importar/Exportar Tasas</h3>
      
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {/* Importar desde archivo */}
        <div className="space-y-2">
          <label className="block text-sm font-medium">
            Importar desde JSON
          </label>
          <input
            ref={fileInputRef}
            type="file"
            accept=".json"
            onChange={handleFileSelect}
            disabled={importing}
            className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
          />
        </div>
        
        {/* Datos de demostraci√≥n */}
        <div className="space-y-2">
          <label className="block text-sm font-medium">
            Datos de demostraci√≥n
          </label>
          <button
            onClick={handleDemoImport}
            disabled={importing}
            className="w-full px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-400"
          >
            Cargar Datos Demo
          </button>
        </div>
        
        {/* Exportar */}
        <div className="space-y-2">
          <label className="block text-sm font-medium">
            Exportar datos
          </label>
          <button
            onClick={handleExport}
            className="w-full px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600"
          >
            Exportar JSON
          </button>
        </div>
      </div>
      
      {/* Resultado de importaci√≥n */}
      {importing && (
        <div className="p-2 bg-blue-50 rounded text-center">
          <div className="inline-block animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-blue-500 mr-2"></div>
          Importando...
        </div>
      )}
      
      {result && (
        <div className={`p-3 rounded ${result.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
          {result.success 
            ? `‚úÖ ${result.count} tasas importadas exitosamente`
            : `‚ùå Error: ${result.error}`
          }
        </div>
      )}
    </div>
  );
};
export default TasaImporter;
************************************************************

FILE: src/components/TasaList.jsx
------------------------------
// src/components/TasaList.jsx
import React, { useState } from 'react';
import { useTasa } from '../lib/db/hooks/useTasa.js';

const TasaList = () => {
  const { 
    tasas, 
    tasaActiva, 
    loading, 
    error, 
    eliminarTasa, 
    loadHistorial,
    historial,
    stats 
  } = useTasa();
  
  const [busqueda, setBusqueda] = useState('');
  const [tasaSeleccionada, setTasaSeleccionada] = useState(null);

  const handleEliminar = async (id) => {
    if (window.confirm('¬øEst√°s seguro de desactivar esta tasa?')) {
      const result = await eliminarTasa(id);
      if (result.success) {
        alert('Tasa desactivada');
      } else {
        alert(`Error: ${result.error}`);
      }
    }
  };

  const handleVerHistorial = async (tasa) => {
    setTasaSeleccionada(tasa);
    await loadHistorial(tasa.id);
  };

  if (loading && tasas.length === 0) {
    return (
      <div className="p-4 text-center">
        <div className="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div>
        <p className="mt-2">Cargando tasas...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-4 bg-red-100 border border-red-400 text-red-700 rounded">
        Error: {error}
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Estad√≠sticas */}
      {stats && (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div className="p-4 bg-blue-50 rounded">
            <p className="text-sm text-gray-600">Total Tasas</p>
            <p className="text-2xl font-bold">{stats.total}</p>
          </div>
          <div className="p-4 bg-green-50 rounded">
            <p className="text-sm text-gray-600">Activas</p>
            <p className="text-2xl font-bold">{stats.activas}</p>
          </div>
          <div className="p-4 bg-yellow-50 rounded">
            <p className="text-sm text-gray-600">Promedio</p>
            <p className="text-2xl font-bold">{stats.promedio.toFixed(4)}</p>
          </div>
          <div className="p-4 bg-purple-50 rounded">
            <p className="text-sm text-gray-600">Rango</p>
            <p className="text-lg font-bold">
              {stats.minima.toFixed(4)} - {stats.maxima.toFixed(4)}
            </p>
          </div>
        </div>
      )}

      {/* Tasa Activa */}
      {tasaActiva && (
        <div className="p-4 bg-green-50 border border-green-200 rounded">
          <h3 className="font-bold text-green-800 mb-2">‚≠ê Tasa Activa Actual</h3>
          <div className="flex justify-between items-center">
            <div>
              <p className="text-lg font-semibold">{tasaActiva.nombre}</p>
              <p className="text-2xl font-bold">{tasaActiva.valor} {tasaActiva.moneda}</p>
            </div>
            <button
              onClick={() => handleVerHistorial(tasaActiva)}
              className="px-3 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200"
            >
              Ver Historial
            </button>
          </div>
        </div>
      )}

      {/* Buscador */}
      <div className="relative">
        <input
          type="text"
          placeholder="Buscar tasas..."
          value={busqueda}
          onChange={(e) => setBusqueda(e.target.value)}
          className="w-full p-2 pl-10 border rounded"
        />
        <span className="absolute left-3 top-2.5">üîç</span>
      </div>

      {/* Lista de Tasas */}
      <div className="space-y-3">
        <h3 className="text-lg font-semibold">
          Todas las Tasas ({tasas.length})
        </h3>
        
        {tasas.length === 0 ? (
          <p className="text-gray-500 text-center py-8">
            No hay tasas registradas
          </p>
        ) : (
          tasas.map(tasa => (
            <div 
              key={tasa.id} 
              className={`p-4 border rounded flex justify-between items-center ${
                !tasa.activo ? 'bg-gray-50 opacity-75' : ''
              }`}
            >
              <div>
                <div className="flex items-center space-x-2">
                  <h4 className="font-medium">{tasa.nombre}</h4>
                  {!tasa.activo && (
                    <span className="text-xs bg-gray-200 px-2 py-1 rounded">INACTIVA</span>
                  )}
                  {tasa.id === tasaActiva?.id && (
                    <span className="text-xs bg-green-200 px-2 py-1 rounded">ACTUAL</span>
                  )}
                </div>
                <p className="text-2xl font-bold my-1">{tasa.valor} {tasa.moneda}</p>
                {tasa.descripcion && (
                  <p className="text-sm text-gray-600">{tasa.descripcion}</p>
                )}
                <p className="text-xs text-gray-500">
                  Creada: {new Date(tasa.fechaCreacion).toLocaleDateString()}
                </p>
              </div>
              
              <div className="flex space-x-2">
                <button
                  onClick={() => handleVerHistorial(tasa)}
                  className="px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200"
                >
                  Historial
                </button>
                <button
                  onClick={() => handleEliminar(tasa.id)}
                  className="px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200"
                >
                  {tasa.activo ? 'Desactivar' : 'Eliminar'}
                </button>
              </div>
            </div>
          ))
        )}
      </div>

      {/* Modal de Historial */}
      {tasaSeleccionada && historial.length > 0 && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-auto">
            <div className="p-4 border-b flex justify-between items-center">
              <h3 className="text-lg font-bold">
                Historial: {tasaSeleccionada.nombre}
              </h3>
              <button
                onClick={() => setTasaSeleccionada(null)}
                className="text-gray-500 hover:text-gray-700"
              >
                ‚úï
              </button>
            </div>
            
            <div className="p-4">
              <div className="space-y-3">
                {historial.map((item, index) => (
                  <div key={index} className="p-3 border rounded">
                    <div className="flex justify-between">
                      <span className="font-medium">{item.tipo}</span>
                      <span className="text-sm text-gray-500">
                        {new Date(item.fechaCambio).toLocaleString()}
                      </span>
                    </div>
                    {item.valorAnterior !== null && (
                      <div className="mt-2 text-sm">
                        <span className="text-gray-600">De: </span>
                        <span className="line-through">{item.valorAnterior}</span>
                        <span className="mx-2">‚Üí</span>
                        <span className="text-green-600 font-semibold">{item.valorNuevo}</span>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default TasaList;
************************************************************

FILE: src/data/data.json
------------------------------
{
  "productos": [
    {
      "id": 1,
      "nombre": "PARCHITA CREMOSA",
      "grupo": "cremoso",
      "stock": 0,
      "imagen": "/outputs/small/parchitacremosa_400.webp"
    },
    {
      "id": 2,
      "nombre": "PINA CREMOSA",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/pinacremosa_400.webp"
    },
    {
      "id": 3,
      "nombre": "DURAZNO cremoso",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/duraznocremoso_400.webp"
    },
    {
      "id": 4,
      "nombre": "FRESA CREMOSA",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/fresa_400.webp"
    },
    {
      "id": 5,
      "nombre": "GUANA-GUANA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/guanaguana_400.webp"
    },
    {
      "id": 6,
      "nombre": "OREO CREMITA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/oreocremita_400.webp"
    },
    {
      "id": 7,
      "nombre": "PIE PARCHITA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/pieparchita_400.webp"
    },
    {
      "id": 8,
      "nombre": "PIE NARANJA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/pienaranja_400.webp"
    },
    {
      "id": 9,
      "nombre": "CHOCO OREO",
      "grupo": "premium",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 10,
      "nombre": "DALMATA",
      "grupo": "premium",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 11,
      "nombre": "VAINILLA",
      "grupo": "premium",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 12,
      "nombre": "COCO",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/coco_400.webp"
    },
    {
      "id": 13,
      "nombre": "PIE LIMON",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/pielimon_400.webp"
    },
    {
      "id": 14,
      "nombre": "CHOKO MILK",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/chokomilk_400.webp"
    },
    {
      "id": 15,
      "nombre": "AGUACATE",
      "grupo": "cremoso",
      "stock": 1,
      "imagen": "/outputs/small/aguacate_400.webp"
    },
    {
      "id": 16,
      "nombre": "MANI",
      "grupo": "fullcremoso",
      "stock": 0,
      "imagen": "/outputs/small/manicremoso_400.webp"
    },
    {
      "id": 17,
      "nombre": "FRESA BLANCO",
      "grupo": "premium",
      "stock": 1,
      "imagen": "/outputs/small/fresablanco_400.webp"
    },
    {
      "id": 26,
      "nombre": "CHOCO SUSY",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": "/outputs/small/chocosussy_400.webp"
    },
        {
      "id": 27,
      "nombre": "DURAZNO CITRICO",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 28,
      "nombre": "FRESA CITRICO",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 29,
      "nombre": "TAMARINDO",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 30,
      "nombre": "NATUGOMITAS",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 31,
      "nombre": "RON CON PASAS",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 32,
      "nombre": "MANGO BICHE",
      "grupo": "citrico",
      "stock": 1,
      "imagen": ""
    },
        {
      "id": 33,
      "nombre": "GUAYABA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    },
    {
      "id": 34,
      "nombre": "MORA",
      "grupo": "fullcremoso",
      "stock": 1,
      "imagen": ""
    }

  ]
}



************************************************************

FILE: src/data/grupos.json
------------------------------
{
  "cremoso": 0.5,
  "fullcremoso": 0.7,
  "premium": 1.05,
  "citrico": 0.4,
  "ninguno": 0.0
}
************************************************************

FILE: src/hooks/useLocalStorageList.js
------------------------------
import { useState, useEffect } from "react";

export function useLocalStorageList(key, initialValue) {
  const [data, setData] = useState(() => {
    const stored = localStorage.getItem(key);
    return stored ? JSON.parse(stored) : initialValue;
  });

  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(data));
  }, [data, key]);

  return { data, setData };
}

************************************************************

FILE: src/index.css
------------------------------
:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a {
  font-weight: 500;
  color: #646cff;
  text-decoration: inherit;
}
a:hover {
  color: #535bf2;
}

body {
  margin: 0;
  display: block;      /* Cambia flex por block para evitar centrados forzados */
  min-width: 100%;     /* Asegura que ocupe el 100% */
  min-height: 100vh;
}

h1 {
  font-size: 3.2em;
  line-height: 1.1;
}

button {
  border-radius: 8px;
  border: 1px solid transparent;
  padding: 0.6em 1.2em;
  font-size: 1em;
  font-weight: 500;
  font-family: inherit;
  background-color: #1a1a1a;
  cursor: pointer;
  transition: border-color 0.25s;
}
button:hover {
  border-color: #646cff;
}
button:focus,
button:focus-visible {
  outline: 4px auto -webkit-focus-ring-color;
}

@media (prefers-color-scheme: light) {
  :root {
    color: #213547;
    background-color: #ffffff;
  }
  a:hover {
    color: #747bff;
  }
  button {
    background-color: #f9f9f9;
  }
}

************************************************************

FILE: src/lib/db/database.js
------------------------------
import Dexie from 'dexie';
import 'dexie-export-import'; // Required for database backup functionality [1, 4]

export class NaturaDBClass {

    constructor() {
        // The database is named dbTasaBCV as per project requirements [1, 5]
        this.db = new Dexie('dbTasaBCV');

        // Version 1 - Initial schema [1]
        this.db.version(1).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio'
        });

        // Version 2 - Added configuration table [2]
        this.db.version(2).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio',
            config: 'clave'
        });

        // Version 3 - Added sales table for real-time tracking [2]
        this.db.version(3).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad'
        });

        // Version 4 - Added orders table with autoincremental ID [3]
        this.db.version(4).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa'
        });

        // Version 5 - Added cost field (costo_$) to groups for price management [3]
        this.db.version(5).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio, costo_$', 
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa'
        });

        // NEW Version 6 - Added status field (estatus) to orders for workflow management
        // Note: 'items' and totals are stored in the object but not indexed [History]
        this.db.version(6).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus'
        });

        this.db.version(7).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago'
        });

        this.db.version(8).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt, visible',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago'
        });

        this.db.version(9).stores({
            productos: 'id, nombre, grupo, stock, imagen, createdAt, visible',
            grupos: '++id, nombre, precio, costo_$',
            config: 'clave',
            ventas: '++id, productoId, nombre, grupo, precioUsd, fecha, cantidad',
            pedidos: '++id, numero_pedido, fecha_pedido, tasa, estatus',
            gastos: '++id, fecha, descripcion, categoria, montoUsd, metodoPago',
            historico_tasas: '++id, fecha_tasa, tasa' // Nueva tabla indexada por fecha y valor
        });

        // Direct access references for components [6]
        this.productos = this.db.productos;
        this.grupos = this.db.grupos;
        this.config = this.db.config;
        this.ventas = this.db.ventas;
        this.pedidos = this.db.pedidos;
        this.gastos = this.db.gastos;
        this.historico_tasas = this.db.historico_tasas;

    }

    // Initialisation method called by the app entry points [6]
    async init() {
        if (!this.db.isOpen()) {
            await this.db.open();
            console.log("Database dbTasaBCV opened successfully.");
        }
        return this;
    }

    // Generic CRUD methods used across the application [6, 7]
    async add(table, data) {
        return await this.db[table].add(data);
    }

    async get(table, id) {
        return await this.db[table].get(id);
    }

    async getAll(table, filters = {}) {
        let query = this.db[table];
        for (const [key, value] of Object.entries(filters)) {
            query = query.where(key).equals(value);
        }
        return await query.toArray();
    }

    async getUltimaTasaBCV() {
        try {
            // Buscamos en el hist√≥rico ordenando por fecha_tasa
            const ultimaEntrada = await this.db.historico_tasas
                .orderBy('fecha_tasa')
                .last(); // Obtiene el registro con la fecha m√°s reciente

            if (ultimaEntrada) {
                return ultimaEntrada.tasa;
            }

            // Fallback: Si el hist√≥rico est√° vac√≠o, buscamos en la tabla config antigua
            const antiguaTasa = 0;  //await this.getConfigValue('tasa');
            return antiguaTasa;
        } catch (error) {
            console.error("Error obteniendo tasa reciente:", error);
            return 0;
        }
    }
    
    async put(table, data) {
        return await this.db[table].put(data);
    }

    async del(table, id) {
        await this.db[table].delete(id);
    }

    // Business specific logic for inventory management [7, 8]
    async updateStock(productoId, cantidad) {
        const producto = await this.get('productos', productoId);
        if (producto) {
            const nuevoStock = Math.max(0, producto.stock + cantidad);
            return await this.put('productos', {
                ...producto,
                stock: nuevoStock
            });
        }
        return null;
    }

    // Configuration helpers for BCV rate and settings [8, 9]
    async getConfigValue(clave) {
        const config = await this.get('config', clave);
        return config ? config.valor : null;
    }

    async setConfigValue(clave, valor) {
        return await this.put('config', {
            clave,
            valor,
            updatedAt: new Date().toISOString()
        });
    }

    // One shott function para buld data de tasas bcv
    async cargarDatosInicialesHistorico() {
        const dataRecaudada = [
            { fecha_tasa: '2026-01-15', tasa: 344.08 },
            { fecha_tasa: '2026-01-16', tasa: 344.08 },
            { fecha_tasa: '2026-01-17', tasa: 341.32 },
            { fecha_tasa: '2026-01-18', tasa: 341.32 },
            { fecha_tasa: '2026-01-19', tasa: 344.08 },
            { fecha_tasa: '2026-01-20', tasa: 346.83 },
            { fecha_tasa: '2026-01-21', tasa: 349.49 },
            { fecha_tasa: '2026-01-22', tasa: 352.27 },
            { fecha_tasa: '2026-01-23', tasa: 355.11 },
            { fecha_tasa: '2026-01-24', tasa: 355.11 },
            { fecha_tasa: '2026-01-25', tasa: 355.11 }
        ];

        try {
            await this.db.historico_tasas.clear();
            await this.db.historico_tasas.bulkAdd(dataRecaudada);
            // Retornamos 'message' para que el Panel lo reconozca
            return { 
                success: true, 
                message: `‚úÖ Se cargaron ${dataRecaudada.length} d√≠as al hist√≥rico.` 
            };
        } catch (error) {
            return { success: false, error: error.message };
        }
    }
}

export const db = new NaturaDBClass();
************************************************************

FILE: src/lib/db/hooks/useDelivery.js
------------------------------
// src/lib/db/hooks/useDelivery.js
import { useState, useEffect } from 'react';
import { db } from '../database.js';

export function useDelivery() {
  const [delivery, setDelivery] = useState(0);
  const [loading, setLoading] = useState(true);

  // Cargar delivery al inicio
  useEffect(() => {
    async function loadDelivery() {
      try {
        // Buscar en la tabla 'config' donde clave = 'delivery'
        const config = await db.config.get('delivery');
        
        if (config && config.valor) {
          const valor = String(config.valor).replace(',', '.');
          setDelivery(valor);
        } else {
          setDelivery('0'); // Cero si no existe
        }
      } catch (error) {
        console.error('Error cargando delivery:', error);
        setDelivery('0');
      } finally {
        setLoading(false);
      }
    }

    loadDelivery();
  }, []);

  // Guardar delivery
  const saveDelivery = async (valor) => {
    try {
      const deliveryNormalizado = String(valor).replace(',', '.');
      const deliveryNumero = parseFloat(deliveryNormalizado);
      
      if (isNaN(deliveryNumero)) {
        console.error('Valor no es un n√∫mero:', valor);
        return false;
      }

      await db.config.put({
        clave: 'delivery',
        valor: deliveryNumero,
        fechaActualizacion: new Date(),
        tipo: 'decimal'
      });

      console.log('Delivery guardado:', deliveryNumero);
      setDelivery(deliveryNormalizado);
      return true;

    } catch (error) {
      console.error('Error guardando delivery:', error);
      return false;
    }
  };

  return {
    delivery,
    setDelivery,
    saveDelivery,
    loading
  };
}
************************************************************

FILE: src/lib/db/hooks/useTasa.js
------------------------------
// src/lib/db/hooks/useTasa.js
import { useState, useEffect, useCallback } from 'react';
import tasaRepository from '../repositories/TasaRepository.js';

export function useTasa() {
  const [tasas, setTasas] = useState([]);
  const [tasaActiva, setTasaActiva] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [historial, setHistorial] = useState([]);
  const [stats, setStats] = useState(null);

  // Cargar todas las tasas
  const loadTasas = useCallback(async () => {
    try {
      setLoading(true);
      const [tasasData, tasaActivaData, statsData] = await Promise.all([
        tasaRepository.getAll(),
        tasaRepository.getActive(),
        tasaRepository.getStats()
      ]);
      
      setTasas(tasasData);
      setTasaActiva(tasaActivaData);
      setStats(statsData);
      setError(null);
    } catch (err) {
      setError(err.message || 'Error al cargar tasas');
      console.error('Error en loadTasas:', err);
    } finally {
      setLoading(false);
    }
  }, []);

  // Cargar historial de una tasa
  const loadHistorial = useCallback(async (tasaId) => {
    try {
      const historialData = await tasaRepository.getHistorial(tasaId);
      setHistorial(historialData);
    } catch (err) {
      setError(err.message || 'Error al cargar historial');
    }
  }, []);

  // Crear nueva tasa
  const crearTasa = useCallback(async (tasaData) => {
    try {
      const id = await tasaRepository.create(tasaData);
      await loadTasas(); // Refrescar lista
      return { success: true, id };
    } catch (err) {
      const errorMsg = err.message || 'Error al crear tasa';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    }
  }, [loadTasas]);

  // Actualizar tasa
  const actualizarTasa = useCallback(async (id, updates) => {
    try {
      await tasaRepository.update(id, updates);
      await loadTasas(); // Refrescar lista
      return { success: true };
    } catch (err) {
      const errorMsg = err.message || 'Error al actualizar tasa';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    }
  }, [loadTasas]);

  // Eliminar tasa (soft delete)
  const eliminarTasa = useCallback(async (id) => {
    try {
      await tasaRepository.delete(id);
      await loadTasas(); // Refrescar lista
      return { success: true };
    } catch (err) {
      const errorMsg = err.message || 'Error al eliminar tasa';
      setError(errorMsg);
      return { success: false, error: errorMsg };
    }
  }, [loadTasas]);

  // Buscar tasas
  const buscarTasas = useCallback(async (query) => {
    try {
      setLoading(true);
      const resultados = await tasaRepository.search(query);
      setTasas(resultados);
      setError(null);
    } catch (err) {
      setError(err.message || 'Error en b√∫squeda');
    } finally {
      setLoading(false);
    }
  }, []);

  // Cargar datos al inicio
  useEffect(() => {
    loadTasas();
  }, [loadTasas]);

  return {
    // Datos
    tasas,
    tasaActiva,
    historial,
    stats,
    
    // Estados
    loading,
    error,
    
    // Acciones CRUD
    crearTasa,
    actualizarTasa,
    eliminarTasa,
    buscarTasas,
    loadHistorial,
    
    // Utilidades
    refresh: loadTasas,
    resetError: () => setError(null),
    resetHistorial: () => setHistorial([])
  };
  
}

************************************************************

FILE: src/lib/db/hooks/useTasaBCV.js
------------------------------
// src/lib/db/hooks/useTasaBCV.js
import { useState, useEffect } from 'react';
import { db } from '../database.js'; // Referencia a la instancia dbTasaBCV [2]

/**
 * Hook personalizado para gestionar la Tasa BCV en la aplicaci√≥n Natura.
 * Actualizado para priorizar la obtenci√≥n desde la tabla historico_tasas.
 */
export function useTasaBCV() {
    const [tasa, setTasa] = useState('');
    const [loading, setLoading] = useState(true);

    // Cargar tasa al inicio mediante el nuevo m√©todo din√°mico
    useEffect(() => {
        async function loadTasa() {
            try {
                // CAMBIO FASE 2: Ya no consulta solo la tabla 'config'.
                // Llama al m√©todo que busca la tasa m√°s reciente en el hist√≥rico [1, 3].
                const valorTasa = await db.getUltimaTasaBCV();

                if (valorTasa) {
                    // Asegurar formato de string con punto decimal para consistencia en la UI [2]
                    const valor = String(valorTasa).replace(',', '.');
                    setTasa(valor);
                } else {
                    setTasa(''); // Vac√≠o si no existe registro en ninguna tabla [2]
                }
            } catch (error) {
                console.error('Error cargando tasa desde el historial:', error);
                setTasa('');
            } finally {
                setLoading(false);
            }
        }
        loadTasa();
    }, []);

    return { 
        tasa, 
        setTasa, 
        loading 
    };
}
************************************************************

FILE: src/lib/db/index.js
------------------------------
//export {default as db} from './db';
// export * from './hooks';
// export * from './repositories';

export { db } from './database.js';
************************************************************

FILE: src/lib/db/repositories/DeliveryRepository.js
------------------------------
// src/lib/db/repositories/DeliveryRepository.js
import { db } from "../database";

const DELIVERY_KEY = 'delivery';

export const DeliveryRepository = {
  async getDelivery() {
    return await db.getConfigValue(DELIVERY_KEY);
  },

  async saveDelivery(valor) {
    return await db.setConfigValue(DELIVERY_KEY, Number(valor));
  },

  async calcularTotalConDelivery(subtotal) {
    const delivery = await db.getConfigValue(DELIVERY_KEY);
    
    if (!delivery || typeof delivery !== "number") {
      console.warn("Delivery no configurado. Retornando solo subtotal.");
      return subtotal;
    }
    
    return Number(subtotal || 0) + delivery;
  }
};
************************************************************

FILE: src/lib/db/repositories/RepoRecommStructure.js
------------------------------
// Ejemplo de repositorio completo para Tasa
class TasaRepository {
  // === CRUD B√ÅSICO ===
  async create(data) { /* ... */ }
  async getById(id) { /* ... */ }
  async getAll() { /* ... */ }
  async update(id, data) { /* ... */ }
  async delete(id) { /* ... */ }
  
  // === CONSULTAS ESPEC√çFICAS ===
  async getActivas() { /* ... */ }
  async getByMoneda(moneda) { /* ... */ }
  async getByRangoValor(min, max) { /* ... */ }
  
  // === B√öSQUEDAS ===
  async search(term) { /* ... */ }
  async getFiltradas(filtros) { /* ... */ }
  
  // === AGREGACIONES ===
  async getEstadisticas() { /* ... */ }
  async getConteoPorMoneda() { /* ... */ }
  
  // === VALIDACIONES ===
  async validarTasa(data) { /* ... */ }
  async existeTasaSimilar(data) { /* ... */ }
  
  // === OPERACIONES MASIVAS ===
  async bulkInsert(tasas) { /* ... */ }
  async bulkUpdate(ids, updates) { /* ... */ }
  
  // === HISTORIAL/AUDITOR√çA ===
  async getHistorial(tasaId) { /* ... */ }
  async registrarCambio(tasaId, cambios) { /* ... */ }
  
  // === SINCRONIZACI√ìN ===
  async getCambiosPendientes() { /* ... */ }
  async marcarComoSincronizado(id) { /* ... */ }
  
  // === UTILIDADES ===
  async hacerBackup() { /* ... */ }
  async compactar() { /* ... */ }
  async getInfo() { /* ... */ }
}
************************************************************

FILE: src/lib/db/repositories/TasaRepository.js
------------------------------
// src/lib/db/repositories/TasaRepository.js
import { db } from "../database";

const TASA_KEY = 'tasa';

export const TasaRepository = {
    async getTasa() {
        // CAMBIO: Ya no busca solo en la tabla 'config' [8]
        // Ahora obtiene la m√°s reciente del hist√≥rico [5]
        return await db.getUltimaTasaBCV();
    },

    async saveTasa(valor) {
        // Mantenemos la escritura en config para compatibilidad con versiones previas [9]
        return 0;   // await db.setConfigValue('tasa', Number(valor));
    },

    async convertirABs(valorenDolar) {
        const valor = await this.getTasa(); // Usa el nuevo m√©todo din√°mico
        if (!valor || typeof valor !== "number") {
            console.warn("Tasa no encontrada. Retornando 0.");
            return 0;
        }
        return valor * Number(valorenDolar || 0);
    }
};
************************************************************

FILE: src/lib/db/utils/Importer.js
------------------------------
// src/lib/db/utils/Importer.js
import { db } from '../database.js';

const Importer = {
    async ImportGrupos(jsonData) {
        try {
            // 1. CONVERTIR {clave:valor} a [{nombre, precio}]
            const gruposArray = Object.entries(jsonData).map(([nombre, precio]) => ({
                nombre: nombre,
                precio: Number(precio)
            }));

            // 2. LIMPIAR TABLA
            await db.grupos.clear();

            // 3. INSERTAR NUEVOS DATOS
            await db.grupos.bulkAdd(gruposArray);

            return {
                success: true,
                count: gruposArray.length,
                message: `${gruposArray.length} grupos importados`
            };

        } catch (error) {
            console.error('Error en importaci√≥n:', error);
            return {
                success: false,
                error: error.message
            };
        }
    },

    async ImportProductos(jsonData) {
        try {
            // ¬°CORRECCI√ìN! - jsonData ya es el array de productos
            // No necesitas Object.entries, ya viene como array
            const productosArray = jsonData.productos || jsonData;

            console.log('Productos a importar:', productosArray.length);
            console.log('Primer producto:', productosArray[0]);

            // 1. LIMPIAR TABLA
            await db.TBPRODUCTOS.clear();

            // 2. INSERTAR NUEVOS DATOS UNO POR UNO
            let importados = 0;
            for (const producto of productosArray) {
                try {
                    await db.productos.add({
                        id: producto.id,
                        nombre: producto.nombre,
                        grupo: producto.grupo,
                        stock: Number(producto.stock),
                        imagen: producto.imagen,
                        visible: producto.visible ?? true, // <--- AGREGA ESTA L√çNEA
                        createdAt: new Date()
                    });
                    importados++;
                } catch (error) {
                    console.error(`Error insertando producto ${producto.id}:`, error);
                }
            }

            return {
                success: true,
                count: importados,
                total: productosArray.length,
                message: `${importados} de ${productosArray.length} productos importados`
            };

        } catch (error) {
            console.error('Error en importaci√≥n de productos:', error);
            return {
                success: false,
                error: error.message
            };
        }
    }
};

export default Importer;
************************************************************

FILE: src/lib/db/utils/deliveryUtil.js
------------------------------
// src/lib/db/utils/deliveryUtil.js
import { db } from '../database.js';

export async function getDeliveryCost() {
  try {
    const valor = await db.getConfigValue('delivery');
    return valor ? parseFloat(valor) : 0;
  } catch (error) {
    console.error('Error obteniendo delivery desde utils:', error);
    return 0;
  }
}

export async function calcularConDelivery(subtotal, delivery = null) {
  try {
    if (!delivery) {
      delivery = await getDeliveryCost();
    }

    if (!delivery || delivery <= 0) {
      return subtotal; // Sin cargo de delivery
    }

    const total = parseFloat(subtotal) + parseFloat(delivery);
    return Math.round(total * 100) / 100;
  } catch (error) {
    console.error('Error calculando con delivery:', error);
    return subtotal;
  }
}
************************************************************

FILE: src/lib/db/utils/exportService.js
------------------------------
import { db } from '../database';
import 'dexie-export-import'; // Required to extend Dexie functionality [4]

export const exportDatabase = async () => {
    try {
        // Use db.db to access the actual Dexie instance defined in your class [1, 2]
        const blob = await db.db.export({
            prettyJson: true,
            progressCallback: ({ totalRows, completedRows }) => {
                console.log(`Export progress: ${completedRows}/${totalRows}`);
            }
        });

        // Fixed filename as requested to avoid string manipulation errors
        const fileName = 'backup_natura_ice.json';

        // Standard logic for triggering a download in Android browsers [5]
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fileName;
        document.body.appendChild(link);
        link.click();

        // Cleanup resources
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        return { success: true };
    } catch (error) {
        console.error("Error exporting IndexedDB:", error);
        return { success: false, error };
    }
};
************************************************************

FILE: src/lib/db/utils/migrationService.js
------------------------------
/**
 * Servicio de migraci√≥n para convertir pedidos al formato detallado de BI.
 * Realiza una captura de precios y costos actuales para pedidos antiguos.
 */
import { db } from '../database';

export const migrateOrdersToBI = async () => {
  try {
    // 1. Obtener toda la data necesaria en paralelo para optimizar rendimiento
    const [allOrders, allProducts, allGroups] = await Promise.all([
      db.getAll('pedidos'),
      db.getAll('productos'),
      db.getAll('grupos')
    ]);

    // 2. Filtrar pedidos que a√∫n tienen el formato antiguo (items no es un Array)
    const ordersToMigrate = allOrders.filter(p => p.items && !Array.isArray(p.items));

    if (ordersToMigrate.length === 0) {
      return { success: true, migratedCount: 0, message: "No hay pedidos pendientes por migrar." };
    }

    let count = 0;

    for (const pedido of ordersToMigrate) {
      // 3. L√≥gica de Transformaci√≥n de Items
      const itemsBI = Object.entries(pedido.items).map(([prodId, qty]) => {
        const prod = allProducts.find(p => p.id === parseInt(prodId));
        // Buscamos el grupo ignorando may√∫sculas/min√∫sculas para mayor seguridad
        const grupo = prod 
          ? allGroups.find(g => g.nombre.toLowerCase() === prod.grupo.toLowerCase()) 
          : null;

        const precioUnit = grupo?.precio || 0;
        const costoUnit = grupo?.costo_$ || 0;

        return {
          productoId: parseInt(prodId),
          nombre: prod?.nombre || "Producto no encontrado",
          grupo: prod?.grupo || "Otros",
          cantidad: qty,
          precioUnitario: precioUnit,
          costoUnitario: costoUnit,
          subtotalUsd: qty * precioUnit,
          utilidadUsd: qty * (precioUnit - costoUnit)
        };
      });

      // 4. Recalcular totales para asegurar consistencia BI
      const subtotalVentaUsd = itemsBI.reduce((sum, item) => sum + item.subtotalUsd, 0);
      const costoEnvio = pedido.delivery_aplicado ? (parseFloat(pedido.delivery_tasa) || 0) : 0;
      
      const nuevoTotalUsd = subtotalVentaUsd + costoEnvio;
      const tasaActual = parseFloat(pedido.tasa) || 0;

      // 5. Preparar objeto migrado
      const pedidoMigrado = {
        ...pedido,
        items: itemsBI, // Reemplazamos el diccionario por el Array BI
        total_usd: nuevoTotalUsd,
        total_bs: nuevoTotalUsd * tasaActual,
        updatedAt: new Date().toISOString(),
        migratedAt: new Date().toISOString() // Marca de auditor√≠a
      };

      // 6. Actualizaci√≥n Masiva (Registro por registro para seguridad en IndexedDB)
      await db.put('pedidos', pedidoMigrado);
      count++;
    }

    return { 
      success: true, 
      migratedCount: count, 
      message: `Se migraron ${count} pedidos exitosamente al formato BI.` 
    };

  } catch (error) {
    console.error("Error en la migraci√≥n de pedidos:", error);
    return { success: false, error: error.message };
  }
};
************************************************************

FILE: src/lib/db/utils/tasaUtil.js
------------------------------
// src/lib/db/utils/tasaUtil.js
import { db } from '../database.js'; // This is correct if the file is in /utils/ [1]

export async function getTasaBCV() {
  try {
        // CAMBIO: Ahora llama al m√©todo que prioriza el hist√≥rico [5, 6]
        const valor = await db.getUltimaTasaBCV();
        return valor ? parseFloat(valor) : 0;
    } catch (error) {
        console.error('Error obteniendo tasa desde utils:', error);
        return null;
    }
}

export async function calcularEnDolares(bs, tasa = null) {
  try {
    if (!tasa) {
      tasa = await getTasaBCV();
    }

    if (!tasa || tasa <= 0) {
      console.warn('C√°lculo cancelado: Tasa inv√°lida');
      return null;
    }

    const dolares = parseFloat(bs) / parseFloat(tasa);
    return Math.round(dolares * 100) / 100;
  } catch (error) {
    console.error('Error calculando conversi√≥n:', error);
    return null;
  }
}

************************************************************

FILE: src/main.jsx
------------------------------
import React from "react";
import ReactDOM from "react-dom/client";
import { BrowserRouter } from "react-router-dom";
import App from "./App";
import "./index.css";

ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </React.StrictMode>
);

************************************************************

FILE: src/pages/About.jsx
------------------------------
export default function About() {
  return <h1>About Page</h1>;
}

************************************************************

FILE: src/pages/Admin.module.css
------------------------------
.adminContainer {
  padding: 20px;
  max-width: 700px;
  margin: 0 auto;
}

h2, h3 {
  text-align: center;
  color: #00BFFF;
}

/* AQUI AGREGAMOS COLOR NEGRO A TODO EL CONTENIDO DE LAS FILAS */
.item, 
.item p,
.item strong,
.info p {
  color: #000 !important;
}

.formBox {
  background: #fff;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  margin-bottom: 30px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.formBox input {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #bbb;
}

.saveBtn {
  background: #00BFFF;
  border: none;
  padding: 10px;
  color: #fff;
  border-radius: 8px;
  margin-top: 10px;
  cursor: pointer;
  width: 100%;
}

.cancelBtn {
  background: #ccc;
  border: none;
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
  width: 100%;
}

.list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.item {
  background: #fff;
  padding: 12px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  display: flex;
  gap: 12px;
  align-items: center;
}

.item img {
  width: 70px;
  height: 70px;
  object-fit: contain;
  border-radius: 8px;
}

.info {
  flex: 1;
}

.actions button {
  margin-left: 6px;
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  color: #000; /* aseguramos color visible */
}

.actions button:first-child {
  background: #FFB800;
}

.actions button:last-child {
  background: #FF5757;
  color: #fff;
}

/* ------------------- */
/*       MODAL         */
/* ------------------- */

.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.modalContent {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  color: #000; /* texto negro dentro del modal */
}

************************************************************

FILE: src/pages/DeliveryPage.jsx
------------------------------
// src/pages/DeliveryPage.jsx
import React from 'react';
import Delivery from '../components/Delivery';

const DeliveryPage = () => {
  return (
    <div style={styles.container}>
      <Delivery />
    </div>
  );
};

const styles = {
  container: {
    width: '100%',
    minHeight: '100vh',
    backgroundColor: '#f5f7fa'
  }
};

export default DeliveryPage;
************************************************************

FILE: src/pages/Estadisticas.jsx
------------------------------
/* src/pages/Estadisticas.jsx */
import { useState, useEffect } from 'react';
import { db } from '../lib/db/database'; // [3]
import { getTasaBCV } from '../lib/db/utils/tasaUtil'; // [4, 5]
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  Tooltip,
  ResponsiveContainer,
  CartesianGrid,
  Cell,
  LabelList
} from 'recharts'; // [5, 6]
import styles from './Estadisticas.module.css'; // [5, 7]

const Estadisticas = () => {
  const [datosBI, setDatosBI] = useState([]);
  const [tasa, setTasa] = useState(0);
  const [rango, setRango] = useState('7d');
  const [cargando, setCargando] = useState(true);
  const [metricas, setMetricas] = useState({ ventaTotalUsd: 0, utilidadTotalUsd: 0 });

  useEffect(() => {
    const cargarAnaliticaBI = async () => {
      setCargando(true);
      try {
        // 1. Obtenemos pedidos y tasa en paralelo para optimizar en Android [8, 9]
        const [pedidosRaw, valorTasa] = await Promise.all([
          db.getAll('pedidos'),
          getTasaBCV()
        ]);

        // 2. Filtramos solo pedidos 'Cerrados' (Ventas efectivas) [2]
        const pedidosCerrados = pedidosRaw.filter(p => p.estatus === 'Cerrado');
        
        // 3. Filtramos por el rango de tiempo seleccionado [9]
        const filtrados = filtrarPorRango(pedidosCerrados, rango);

        // 4. Procesamiento de datos para BI: Agregaci√≥n por producto
        const acumulado = {};
        let ventaSum = 0;
        let utilidadSum = 0;

        filtrados.forEach(pedido => {
          ventaSum += (pedido.total_usd || 0);
          
          // Iteramos los items (formato Array BI sugerido en fases anteriores)
          if (Array.isArray(pedido.items)) {
            pedido.items.forEach(item => {
              if (!acumulado[item.nombre]) {
                acumulado[item.nombre] = { name: item.nombre, utilidad: 0, cantidad: 0 };
              }
              acumulado[item.nombre].utilidad += (item.utilidadUsd || 0);
              acumulado[item.nombre].cantidad += (item.cantidad || 0);
              utilidadSum += (item.utilidadUsd || 0);
            });
          }
        });

        // 5. Preparar datos para el gr√°fico (Top 6 por utilidad) [10]
        const dataGrafico = Object.values(acumulado)
          .sort((a, b) => b.utilidad - a.utilidad)
          .slice(0, 6);

        setDatosBI(dataGrafico);
        setMetricas({ ventaTotalUsd: ventaSum, utilidadTotalUsd: utilidadSum });
        setTasa(valorTasa || 0);

      } catch (err) {
        console.error("Error cargando anal√≠tica BI:", err);
      } finally {
        setCargando(false);
      }
    };

    cargarAnaliticaBI();
  }, [rango]);

  const filtrarPorRango = (pedidos, tipo) => {
    const ahora = new Date();
    return pedidos.filter(p => {
      const fechaPedido = new Date(p.fecha_pedido);
      if (tipo === 'hoy') return fechaPedido.toDateString() === ahora.toDateString();
      if (tipo === '7d') {
        const limite = new Date();
        limite.setDate(ahora.getDate() - 7);
        return fechaPedido >= limite;
      }
      if (tipo === 'mes') {
        return fechaPedido.getMonth() === ahora.getMonth() && 
               fechaPedido.getFullYear() === ahora.getFullYear();
      }
      return true;
    });
  };

  if (cargando) return <div className={styles.loading}>Procesando Inteligencia de Negocio...</div>;

  return (
    <div className={styles.container}>
      <h1 className={styles.title}>üìä ANAL√çTICA FINANCIERA (BI)</h1>

      <div className={styles.mainCard}>
        <div className={styles.filterBar}>
          <label className={styles.filterLabel}>Periodo de An√°lisis:</label>
          <select 
            value={rango} 
            onChange={(e) => setRango(e.target.value)}
            className={styles.select}
          >
            <option value="hoy">Ventas de Hoy</option>
            <option value="7d">√öltimos 7 D√≠as</option>
            <option value="mes">Mes Actual</option>
          </select>
        </div>

        <div className={styles.ingresosContainer}>
          <div className={styles.ingresosCard}>
            <span className={styles.ingresosLabel}>VENTA TOTAL ($)</span>
            <span className={styles.ingresosValue}>${metricas.ventaTotalUsd.toFixed(2)}</span>
          </div>
          <div className={styles.ingresosCard} style={{ backgroundColor: '#e8f5e9' }}>
            <span className={styles.ingresosLabel} style={{ color: '#2e7d32' }}>UTILIDAD NETA ($)</span>
            <span className={styles.ingresosValue} style={{ color: '#2e7d32' }}>
              ${metricas.utilidadTotalUsd.toFixed(2)}
            </span>
          </div>
        </div>

        <div className={styles.chartWrapper}>
          <h3 className={styles.chartTitle}>TOP 6: RENTABILIDAD POR PRODUCTO</h3>
          <div style={{ width: '100%', height: 300 }}>
            <ResponsiveContainer>
              <BarChart data={datosBI} margin={{ top: 20, right: 30, left: 0, bottom: 70 }}>
                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                <XAxis 
                  dataKey="name" 
                  angle={-45} 
                  textAnchor="end" 
                  interval={0} 
                  fontSize={10}
                  stroke="#555"
                  height={80}
                />
                <YAxis hide />
                <Tooltip 
                  contentStyle={{ borderRadius: '10px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }}
                  formatter={(value) => [`$${value.toFixed(2)}`, 'Utilidad']}
                />
                <Bar dataKey="utilidad" fill="#00BFFF" radius={[11]} barSize={35}>
                  <LabelList 
                    dataKey="utilidad" 
                    position="top" 
                    formatter={(v) => `$${v.toFixed(2)}`}
                    style={{ fill: '#2c3e50', fontSize: 11, fontWeight: 'bold' }} 
                  />
                  {datosBI.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={index === 0 ? '#FFD700' : '#00BFFF'} />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>

        <div className={styles.ingresosContainer} style={{ marginTop: '20px' }}>
           <div className={styles.ingresosCard} style={{ gridColumn: 'span 2', background: '#fff3e0' }}>
            <span className={styles.ingresosLabel} style={{ color: '#ef6c00' }}>UTILIDAD ESTIMADA EN BOL√çVARES</span>
            <span className={styles.ingresosValue} style={{ color: '#ef6c00' }}>
              Bs. {(metricas.utilidadTotalUsd * tasa).toLocaleString('es-VE', { minimumFractionDigits: 2 })}
            </span>
            <small style={{ fontSize: '0.7rem', color: '#666' }}>Tasa: {tasa.toFixed(2)}</small>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Estadisticas;
************************************************************

FILE: src/pages/Estadisticas.module.css
------------------------------
.container {
    padding: 20px;
    padding-bottom: 120px;
    /* Cambio: Eliminado el fondo rojo de las fuentes [1] por un blanco profesional */
    background-color: #ffffff; 
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #333;
    font-family: system-ui, -apple-system, sans-serif;
}

/* T√≠tulo de la Anal√≠tica */
.title {
    font-size: 1.6rem;
    color: #2c3e50;
    font-weight: 800;
    margin-bottom: 25px;
    text-align: center;
    letter-spacing: -0.5px;
}

/* El componente principal presentado en una Card Profesional */
.mainCard {
    background-color: #ffffff;
    border-radius: 20px; /* Bordes redondeados solicitados */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Sombra profesional */
    padding: 25px;
    width: 100%;
    max-width: 500px; /* Optimizado para el dispositivo Android del host Vercel [2] */
    border: 1px solid #f0f0f0;
    box-sizing: border-box;
}

/* Barra de filtros */
.filterBar {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 25px;
}

.filterLabel {
    color: #546e7a;
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
}

/* Selector de rango de fechas */
.select {
    padding: 12px 15px;
    border-radius: 12px;
    border: 2px solid #eceff1;
    font-size: 1rem;
    background-color: #f8fafc;
    color: #263238; /* Asegura visibilidad del texto solicitado en fuentes [3, 4] */
    cursor: pointer;
    transition: all 0.3s ease;
}

.select:focus {
    outline: none;
    border-color: #00BFFF; /* Azul Natura */
}

/* Bloques de ingresos (USD y BS) */
.ingresosContainer {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 30px;
}

.ingresosCard {
    background: #f1f8ff;
    padding: 15px;
    border-radius: 15px;
    text-align: center;
    border: 1px solid #e1f5fe;
}

.ingresosValue {
    display: block;
    font-size: 1.2rem;
    font-weight: 800;
    color: #007bff;
}

.ingresosLabel {
    font-size: 0.7rem;
    color: #78909c;
    font-weight: 700;
    text-transform: uppercase;
}

/* Contenedor para el gr√°fico de Recharts [5] */
.chartWrapper {
    margin-top: 20px;
    padding: 15px;
    background: #fafafa;
    border-radius: 15px;
    border: 1px solid #f0f0f0;
}

.chartTitle {
    font-size: 0.9rem;
    color: #455a64;
    font-weight: 700;
    margin-bottom: 15px;
    text-align: center;
}

/* Estado de carga */
.loading {
    text-align: center;
    padding: 50px;
    color: #90a4ae;
    font-weight: 500;
}
************************************************************

FILE: src/pages/GruposPage.jsx
------------------------------
// src/pages/GruposPage.jsx
import React from 'react';
import GruposCRUD from '../components/GruposCRUD/GruposCRUD';

const GruposPage = () => {
  return (
    <div>
      <GruposCRUD />
    </div>
  );
};

export default GruposPage;
************************************************************

FILE: src/pages/Home.jsx
------------------------------
import { useState, useEffect } from 'react';
import { useNavigate } from "react-router-dom";
import { db } from '../lib/db/database.js'; // Acceso a dbTasaBCV [3]
import { getTasaBCV } from '../lib/db/utils/tasaUtil.js'; // Utilidad de tasa [3]
import styles from './Home.module.css';

function Home() {
  const [productos, setProductos] = useState([]);
  const [grupos, setGrupos] = useState([]);
  const [listaDeSeleccionados, setListaDeSeleccionados] = useState([]);
  const [tasa, setTasa] = useState(0);
  const [cargando, setCargando] = useState(true);
  const [filtroGrupo, setFiltroGrupo] = useState('todos');
  const navigate = useNavigate();

  // Carga inicial de datos desde IndexedDB [4]
  useEffect(() => {
    const cargarTodo = async () => {
      try {
        await db.init(); // Inicializa dbTasaBCV [4]
        const [p, g, t] = await Promise.all([
          db.getAll('productos'),
          db.getAll('grupos'),
          getTasaBCV()
        ]);
        setProductos(p);
        setGrupos(g);
        setTasa(t || 0);
      } catch (err) {
        console.error("Error initializing Home:", err);
      } finally {
        setCargando(false);
      }
    };
    cargarTodo();
  }, []);

  /**
   * FILTRADO ACTUALIZADO Y SEGURO:
   * 1. Filtra por grupo seleccionado.
   * 2. Valida visibilidad: Si el campo 'visible' es estrictamente 'false', se oculta.
   *    Si es 'true' o 'undefined' (registros antiguos), se muestra [2, 5].
   */
  const productosFiltrados = productos.filter(p => {
    const coincideGrupo = filtroGrupo === 'todos' || p.grupo === filtroGrupo;
    const esVisible = p.visible !== false; 
    return coincideGrupo && esVisible;
  });

  // Confirmaci√≥n para vaciar la lista [6]
  const handleVaciarLista = () => {
    if (listaDeSeleccionados.length === 0) return;
    const confirmar = window.confirm(
      `‚ö†Ô∏è ¬øEst√°s seguro de que deseas vaciar la lista?\n\nSe eliminar√°n los ${listaDeSeleccionados.length} helados seleccionados.`
    );
    if (confirmar) setListaDeSeleccionados([]);
  };

  // Procesamiento de venta y actualizaci√≥n de stock [6, 7]
  const handleGrabar = async () => {
    if (listaDeSeleccionados.length === 0) return;
    const confirmar = window.confirm(`¬øDesea procesar la venta de ${listaDeSeleccionados.length} helados?`);
    if (!confirmar) return;

    try {
      for (const item of listaDeSeleccionados) {
        const grupoInfo = grupos.find(g => g.nombre === item.grupo);
        const precioUsd = grupoInfo ? grupoInfo.precio : 0;

        // Registrar venta en IndexedDB [7]
        await db.add('ventas', {
          productoId: item.id,
          nombre: item.nombre,
          grupo: item.grupo,
          precioUsd: precioUsd,
          cantidad: 1,
          fecha: new Date().toISOString()
        });

        // Descontar inventario [7]
        await db.updateStock(item.id, -1);
      }

      // Refrescar lista de productos con stock actualizado [8]
      const productosActualizados = await db.getAll('productos');
      setProductos(productosActualizados);
      setListaDeSeleccionados([]);
      alert("‚úÖ Venta procesada con √©xito.");
    } catch (error) {
      alert("‚ùå Error al procesar la venta.");
    }
  };

  const seleccionarProducto = (producto) => {
    setListaDeSeleccionados(prev => [...prev, producto]);
  };

  const eliminarItem = (indexParaEliminar) => {
    setListaDeSeleccionados(prev => prev.filter((_, index) => index !== indexParaEliminar));
  };

  const calcularTotales = () => {
    let usd = 0;
    listaDeSeleccionados.forEach(item => {
      const grupoInfo = grupos.find(g => g.nombre === item.grupo);
      usd += grupoInfo ? grupoInfo.precio : 0;
    });
    return { usd, bs: usd * tasa };
  };

  const { usd, bs } = calcularTotales();

  if (cargando) return <div className={styles.loading}>Cargando tienda...</div>;

  return (
    <div className={styles.container}>
      {/* Selector de Grupos */}
      <div className={styles.filterBar}>
        <label htmlFor="filtro-home">Filtrar por Grupo:</label>
        <select 
          id="filtro-home" 
          value={filtroGrupo} 
          onChange={(e) => setFiltroGrupo(e.target.value)}
          className={styles.select}
        >
          <option value="todos">Todos los helados</option>
          {grupos.map(g => (
            <option key={g.id} value={g.nombre}>{g.nombre}</option>
          ))}
        </select>
      </div>

      {/* Grid de Productos [9] */}
      <div className={styles.grid}>
        {productosFiltrados.map(p => {
          const grupoInfo = grupos.find(g => g.nombre === p.grupo);
          const precio = grupoInfo ? grupoInfo.precio : 0;
          const esAgotado = p.stock === 0;
          const esBajoStock = p.stock > 0 && p.stock <= 5;

          return (
            <div 
              key={p.id} 
              className={`${styles.card} ${esAgotado ? styles.cardDisabled : ''}`}
              onClick={() => !esAgotado && seleccionarProducto(p)}
            >
              <div 
                className={styles.stockBadge}
                style={{ backgroundColor: esAgotado ? '#ff4d4d' : (esBajoStock ? '#ffa500' : '#28a745') }}
              >
                {p.stock}
              </div>

              {p.imagen ? (
                <img 
                  src={p.imagen} 
                  alt={p.nombre} 
                  className={styles.productImage}
                  onError={(e) => { e.target.style.display = 'none'; }}
                />
              ) : (
                <div className={styles.imagePlaceholder}>üì∑ {p.nombre}</div>
              )}

              <h3 className={styles.productTitle}>{p.nombre}</h3>
              <p className={styles.priceText}>
                ID: {p.id} - $: {precio.toFixed(2)} - Bs.: {(precio * tasa).toFixed(2)}
              </p>
            </div>
          );
        })}
      </div>

      {/* Panel inferior fijo [10, 11] */}
      <div className={styles.selectedContainer}>
        <div className={styles.selectedHeader}>
          <span>Items: <strong>{listaDeSeleccionados.length}</strong></span>
          <span>Tasa: <strong>{tasa.toFixed(2)}</strong></span>
        </div>
        
        <div className={styles.selectedList}>
          {listaDeSeleccionados.map((item, index) => (
            <div key={`${item.id}-${index}`} className={styles.selectedItem}>
              <span>#{item.id} - {item.nombre}</span>
              <button 
                className={styles.eliminarBtn}
                onClick={(e) => { e.stopPropagation(); eliminarItem(index); }}
              >
                ELIM
              </button>
            </div>
          ))}
        </div>

        <div className={styles.totalRow}>
          Total: ${usd.toFixed(2)} | Bs. {bs.toFixed(2)}
        </div>

        <div className={styles.actionButtons}>
          <button className={styles.vaciarBtn} onClick={handleVaciarLista}>
            Vaciar
          </button>
          <button 
            className={styles.grabarBtn} 
            onClick={handleGrabar}
            disabled={listaDeSeleccionados.length === 0}
          >
            Grabar
          </button>
        </div>
      </div>
    </div>
  );
}

export default Home;
************************************************************

FILE: src/pages/Home.module.css
------------------------------

.container {
  padding: 15px;
  padding-bottom: 280px; /* Espacio para el panel fijo inferior */
  background-color: #fafafa;
  min-height: 100vh;
  width: 100%;
  box-sizing: border-box;
  color: #333;
}

.filterBar {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 20px;
  padding: 0 5px;
  color: #2c3e50;
  font-weight: bold;
}

.selectedHeader {
  display: flex;
  justify-content: space-between;
  font-weight: bold;
  margin-bottom: 10px;
  color: #333;
}

.select {
  padding: 12px;
  border-radius: 8px;
  border: none;
  font-size: 18px;
  background-color: #00BFFF; /* Azul Natura */
  color: #fff;
  font-weight: bold;
  text-align: center;
  width: 100%;
  box-sizing: border-box;
}

.grid {
  display: grid;
  grid-template-columns: 1fr; /* Una sola columna para m√°xima visibilidad en m√≥vil */
  gap: 16px;
  width: 100%;
}

.card {
  position: relative;
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  padding: 15px;
  cursor: pointer;
  transition: transform 0.2s;
}

.card:active {
  transform: scale(0.98); /* Feedback t√°ctil para Android */
}

.stockBadge {
  position: absolute;
  top: -8px;
  right: -8px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 14px;
  border: 2px solid #fff;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  z-index: 10;
}

.cardDisabled {
  opacity: 0.6;
  filter: grayscale(1);
  cursor: not-allowed !important;
}

.productImage {
  width: 100%;
  height: auto;
  border-radius: 8px;
  margin-bottom: 10px;
}

.productTitle {
  font-size: 1.1rem;
  font-weight: bold;
  margin: 0 0 5px 0;
  color: #2c3e50;
}

.priceText {
  color: #28a745;
  font-weight: bold;
}

/* Panel de selecci√≥n fijo en la base */
.selectedContainer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: #fff;
  padding: 15px;
  border-top: 2px solid #00BFFF;
  box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
  z-index: 1000;
  width: 100%;
  box-sizing: border-box;
}

.selectedList {
  max-height: 120px;
  overflow-y: auto;
  margin-bottom: 10px;
}

.selectedItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 10px;
  background-color: #f8f9fa;
  margin-bottom: 5px;
  border-radius: 4px;
  color: #000;
}

.totalRow {
  font-size: 1.1rem;
  font-weight: bold;
  text-align: center;
  margin: 10px 0;
  color: #007bff;
}

.actionButtons {
  display: flex;    /* Coloca los botones en la misma l√≠nea */
  gap: 10px;        /* Espaciado entre botones */
}

.vaciarBtn, .grabarBtn {
  padding: 15px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
}

/* Actualizaci√≥n: Fondo rojo y ancho igualado (flex: 1) */
.vaciarBtn { 
  background-color: #f44336; 
  color: white; 
  flex: 1; 
}

/* Actualizaci√≥n: Fondo verde y ancho igualado (flex: 1) */
.grabarBtn { 
  background-color: #28a745; 
  color: white; 
  flex: 1; 
}

.grabarBtn:disabled { 
  background-color: #ccc; 
}
************************************************************

FILE: src/pages/Lista.jsx
------------------------------
import { useLocalStorageList } from "../hooks/useLocalStorageList";

function Lista() {
  const { data } = useLocalStorageList("productos", []);

  return (
    <div>
      <h2>Lista de Helados</h2>

      <div style={{ display: "flex", flexWrap: "wrap", gap: "1rem" }}>
        {data.map((producto) => (
          <div key={producto.id} style={{ width: "150px" }}>
            <img
              src={producto.imagen}
              alt={producto.nombre}
              style={{ width: "100%", borderRadius: "8px" }}
            />
            <p>{producto.nombre}</p>
            <small>{producto.grupo}</small>
          </div>
        ))}
      </div>
    </div>
  );
}

export default Lista;

************************************************************

FILE: src/pages/NotFound.jsx
------------------------------
export default function NotFound() {
  return <h1>404 - P√°gina no encontrada</h1>;
}

************************************************************

FILE: src/pages/Pedidos.jsx
------------------------------
// src/pages/Pedidos.jsx
import React from 'react';
import PedidosComponente from '../components/Pedidos';

const PedidosPage = () => {
  return (
    <main>
      <PedidosComponente />
    </main>
  );
};

export default PedidosPage;
************************************************************

FILE: src/pages/ProductosPage.jsx
------------------------------
// src/pages/ProductosPage.jsx
import React from 'react';
import ProductosCRUD from '../components/ProductosCRUD/ProductosCRUD';

const ProductosPage = () => {
  return (
    <div>
      <ProductosCRUD />
    </div>
  );
};

export default ProductosPage;
************************************************************

FILE: src/pages/TasaBCV.jsx
------------------------------
import { useState, useEffect } from 'react';
import { db } from "../lib/db/database"; 
import styles from './TasaBCV.module.css';

export default function TasaBCV() {
  const [historico, setHistorico] = useState([]);
  const [loading, setLoading] = useState(true);
  const [editandoId, setEditandoId] = useState(null);
  
  // Estado para el formulario (Add/Edit)
  const [formData, setFormData] = useState({
    fecha_tasa: new Date().toISOString().split('T'),
    tasa: ''
  });
  
  const [message, setMessage] = useState('');

  // 1. READ: Cargar historial al iniciar
  useEffect(() => {
    cargarHistorico();
  }, []);

  const cargarHistorico = async () => {
    try {
      setLoading(true);
      // Consulta directa a la tabla de historial
      const datos = await db.getAll('historico_tasas');
      // Ordenar por fecha descendente para mostrar lo m√°s nuevo arriba
      setHistorico(datos.sort((a, b) => new Date(b.fecha_tasa) - new Date(a.fecha_tasa)));
    } catch (err) {
      console.error("Error cargando historial:", err);
    } finally {
      setLoading(false);
    }
  };

  // 2. CREATE / UPDATE
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!formData.tasa || !formData.fecha_tasa) return;

    const dataToSave = {
      fecha_tasa: formData.fecha_tasa,
      tasa: parseFloat(formData.tasa)
    };

    try {
      if (editandoId) {
        // Operaci√≥n de actualizaci√≥n (Update)
        await db.put('historico_tasas', { ...dataToSave, id: editandoId });
        setMessage('‚úÖ Registro actualizado');
      } else {
        // Operaci√≥n de creaci√≥n (Create)
        await db.add('historico_tasas', dataToSave);
        setMessage('‚úÖ Nueva tasa agregada');
      }
      
      resetForm();
      cargarHistorico();
      setTimeout(() => setMessage(''), 3000);
    } catch (err) {
      setMessage('‚ùå Error al guardar');
    }
  };

  // 3. DELETE
  const handleEliminar = async (id) => {
    if (window.confirm("¬øDeseas eliminar este registro de forma permanente?")) {
      await db.del('historico_tasas', id);
      cargarHistorico();
    }
  };

  const startEdit = (reg) => {
    setEditandoId(reg.id);
    setFormData({ 
      fecha_tasa: reg.fecha_tasa, 
      tasa: reg.tasa.toString() 
    });
  };

  const resetForm = () => {
    setEditandoId(null);
    setFormData({ 
      fecha_tasa: new Date().toISOString().split('T'), 
      tasa: '' 
    });
  };

  if (loading) return <div className={styles.loading}>Cargando historial...</div>;

  return (
    <div className={styles.container}>
      {/* Encabezado con estilo GestionPedido */}
      <div className={styles.header}>
        <h2 className={styles.title}>üìà GESTI√ìN DE TASAS BCV</h2>
      </div>

      <div className={styles.content}>
        {/* Formulario CRUD */}
        <form onSubmit={handleSubmit}>
          <div className={styles.topRow}>
            <div className={styles.inputGroup}>
              <label className={styles.label}>Fecha de Tasa</label>
              <input 
                type="date" 
                value={formData.fecha_tasa} 
                onChange={(e) => setFormData({...formData, fecha_tasa: e.target.value})}
                className={styles.inputSmall}
              />
            </div>
            <div className={styles.inputGroup}>
              <label className={styles.label}>Valor Tasa (Bs.)</label>
              <input 
                type="number" 
                step="0.01" 
                value={formData.tasa} 
                onChange={(e) => setFormData({...formData, tasa: e.target.value})}
                placeholder="0.00"
                className={styles.inputSmall}
              />
            </div>
          </div>

          <div className={styles.footer}>
            <button type="submit" className={styles.grabarBtn}>
              {editandoId ? "ACTUALIZAR" : "GRABAR"}
            </button>
            {editandoId && (
              <button type="button" onClick={resetForm} className={styles.limpiarBtn}>
                CANCELAR
              </button>
            )}
          </div>
          {message && <div className={styles.infoBar}>{message}</div>}
        </form>

        {/* Listado de Datos con estilo Product List */}
        <div className={styles.productListContainer}>
          <div className={styles.productListHeader}>REGISTROS EN HISTORICO</div>
          <div className={styles.productList}>
            {historico.length === 0 ? (
              <div className={styles.productName} style={{ textAlign: 'center', padding: '20px' }}>
                No hay registros en el historial.
              </div>
            ) : (
              historico.map(reg => (
                <div key={reg.id} className={styles.productItem}>
                  <div className={styles.productName}>
                    <strong>{reg.fecha_tasa}</strong> ‚Äî Bs. {reg.tasa.toFixed(2)}
                  </div>
                  <div className={styles.quantityControl}>
                    <button 
                      onClick={() => startEdit(reg)} 
                      className={styles.qtyBtn}
                      title="Editar"
                    >
                      ‚úèÔ∏è
                    </button>
                    <button 
                      onClick={() => handleEliminar(reg.id)} 
                      className={styles.qtyBtn}
                      style={{ color: '#f44336' }}
                      title="Eliminar"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
************************************************************

FILE: src/pages/TasaBCV.module.css
------------------------------

.container {
    background-color: #fff;
    width: 95%;
    max-width: 500px;
    margin: 20px auto;
    padding: 15px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    font-family: system-ui, -apple-system, sans-serif;
}

.header {
    display: flex;
    justify-content: center;
    align-items: center;
    border-bottom: 2px solid #00BFFF;
    margin-bottom: 10px;
    padding-bottom: 5px;
}

.title {
    font-size: 16px;
    font-weight: bold;
    color: #000;
    text-transform: uppercase;
}

.content {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.topRow {
    display: flex;
    gap: 10px;
}

.inputGroup {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.label {
    font-size: 14px;
    font-weight: bold;
    color: #000;
    margin-bottom: 5px;
}

.inputSmall {
    padding: 10px;
    border-radius: 4px;
    width: 100%;
    box-sizing: border-box;
    font-size: 16px;
    background-color: #00BFFF; /* Azul Natura */
    color: white;
    font-weight: bold;
    text-align: center;
    border: 1px solid #aaa;
}

.inputSmall:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.3);
}

.footer {
    display: flex;
    gap: 8px;
    margin-top: 15px;
}

.grabarBtn, .limpiarBtn {
    flex: 1;
    padding: 14px;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    text-align: center;
}

.grabarBtn {
    background-color: #28a745;
    color: white;
}

.limpiarBtn {
    background-color: #f44336;
    color: white;
}

.infoBar {
    text-align: center;
    font-weight: bold;
    color: #000;
    font-size: 13px;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 4px;
    margin-top: 5px;
}

/* Estilos de la lista de registros (Estilo Product List) */

.productListContainer {
    border: 1px solid #aaa;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 20px;
}

.productListHeader {
    text-align: center;
    background-color: #00BFFF;
    color: white;
    padding: 8px;
    font-weight: bold;
    font-size: 14px;
}

.productList {
    max-height: 350px;
    overflow-y: auto;
    background-color: #fff;
}

.productItem {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
}

.productName {
    color: #000;
    font-size: 14px;
    flex: 1;
}

.quantityControl {
    display: flex;
    align-items: center;
    gap: 10px;
}

.qtyBtn {
    width: 36px;
    height: 36px;
    background-color: #eee;
    border: 1px solid #ccc;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 18px;
    transition: background-color 0.2s;
}

.qtyBtn:active {
    background-color: #ddd;
}

.loading {
    text-align: center;
    padding: 40px;
    color: #666;
    font-weight: bold;
}
************************************************************

FILE: vite.config.js
------------------------------
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [
    react({
      babel: {
        plugins: [['babel-plugin-react-compiler']],
      },
    }),
  ],
})



************************************************************